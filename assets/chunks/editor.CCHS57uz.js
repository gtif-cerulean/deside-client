function b(n){return!(n===null||typeof n!="object"||n.nodeType||n===n.window||n.constructor&&!f(n.constructor.prototype,"isPrototypeOf"))}function y(n){return b(n)?u({},n):Array.isArray(n)?n.map(y):n}function u(n,...t){return t.forEach(e=>{e&&Object.keys(e).forEach(i=>{e[i]&&b(e[i])?(f(n,i)||(n[i]={}),u(n[i],e[i])):Array.isArray(e[i])?n[i]=y(e[i]):n[i]=e[i]})}),n}function x(n,t){const e=document.createEvent("HTMLEvents");e.initEvent(t,!0,!0),n.dispatchEvent(e)}function w(n){return n&&(n.toString()==="[object ShadowRoot]"?n:w(n.parentNode))}function f(n,t){return n&&Object.prototype.hasOwnProperty.call(n,t)}const _=/^\s*(-|\+)?(\d+|(\d*(\.\d*)))([eE][+-]?\d+)?\s*$/;function j(n){if(typeof n>"u"||n===null)return!1;const t=n.match(_),e=parseFloat(n);return t!==null&&!isNaN(e)&&isFinite(e)}const k=/^\s*(-|\+)?(\d+)\s*$/;function A(n){if(typeof n>"u"||n===null)return!1;const t=n.match(k),e=parseInt(n);return t!==null&&!isNaN(e)&&isFinite(e)}function E(){let n=new Date().getTime();return typeof performance<"u"&&typeof performance.now=="function"&&(n+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=(n+Math.random()*16)%16|0;return n=Math.floor(n/16),(t==="x"?e:e&3|8).toString(16)})}function m(n){return n&&typeof n=="object"&&!Array.isArray(n)}function g(n,...t){if(!t.length)return n;const e=t.shift();if(m(n)&&m(e))for(const i in e)m(e[i])?(n[i]||Object.assign(n,{[i]:{}}),g(n[i],e[i])):Object.assign(n,{[i]:e[i]});return g(n,...t)}function C(n,t){return Object.keys(t).forEach(function(e){e in n&&(n[e]=t[e])}),n}class O{constructor(t,e){this.defaults=e,this.jsoneditor=t.jsoneditor,this.theme=this.jsoneditor.theme,this.template_engine=this.jsoneditor.template,this.iconlib=this.jsoneditor.iconlib,this.translate=this.jsoneditor.translate||this.defaults.translate,this.translateProperty=this.jsoneditor.translateProperty||this.defaults.translateProperty,this.original_schema=t.schema,this.schema=this.jsoneditor.expandSchema(this.original_schema),this.active=!0,this.isUiOnly=!1,this.options=u({},this.options||{},this.schema.options||{},t.schema.options||{},t),this.enforceConstEnabled=this.options.enforce_const??this.jsoneditor.options.enforce_const,this.formname=this.jsoneditor.options.form_name_root||"root",!t.path&&!this.schema.id&&(this.schema.id=this.formname),this.path=t.path||this.formname,this.formname=t.formname||this.path.replace(/\.([^.]+)/g,"[$1]"),this.parent=t.parent,this.key=this.parent!==void 0?this.path.split(".").slice(this.parent.path.split(".").length).join("."):this.path,this.link_watchers=[],this.watchLoop=!1,this.optInWidget=this.options.opt_in_widget??this.jsoneditor.options.opt_in_widget,t.container&&this.setContainer(t.container),this.registerDependencies()}onChildEditorChange(t,e){this.onChange(!0,!1,e)}notify(){this.path&&this.jsoneditor.notifyWatchers(this.path)}change(t){this.parent?this.parent.onChildEditorChange(this,t):this.jsoneditor&&this.jsoneditor.onChange(t)}onChange(t,e,i){this.notify(),e||this.watch_listener&&this.watch_listener(),t&&this.change(i)}register(){if(this.jsoneditor.registerEditor(this),this.input&&!this.label){const t=this.getTitle()||this.formname;this.input.setAttribute("aria-label",t)}this.onChange()}unregister(){this.jsoneditor&&this.jsoneditor.unregisterEditor(this)}getNumColumns(){return 12}isActive(){return this.active}activate(){this.active=!0,this.optInCheckbox.checked=!0,this.enable(),this.change()}deactivate(){this.isRequired()||(this.active=!1,this.optInCheckbox.checked=!1,this.disable(),this.change())}registerDependencies(){this.dependenciesFulfilled=!0;const t=this.options.dependencies;t&&Object.keys(t).forEach(e=>{let i;e.startsWith(this.jsoneditor.root.path)?i=e:(i=this.path.split("."),i[i.length-1]=e,i=i.join(".")),this.jsoneditor.watch(i,()=>{this.evaluateDependencies()})})}evaluateDependencies(){const t=this.container||this.control;if(!t||this.jsoneditor===null)return;const e=this.options.dependencies;if(!e)return;const i=this.dependenciesFulfilled;this.dependenciesFulfilled=!0,Object.keys(e).forEach(s=>{let r;s.startsWith(this.jsoneditor.root.path)?r=s:(r=this.path.split("."),r[r.length-1]=s,r=r.join("."));const l=e[s];this.checkDependency(r,l)}),this.dependenciesFulfilled!==i&&this.notify();let h=this.dependenciesFulfilled?"block":"none";this.options.hidden&&(h="none"),t.tagName==="TD"?Object.keys(t.childNodes).forEach(s=>t.childNodes[s].style.display=h):t.style.display=h}checkDependency(t,e){if(this.path===t||this.jsoneditor===null)return;const i=this.jsoneditor.getEditor(t),h=i?i.getValue():void 0;!i||!i.dependenciesFulfilled||!h?this.dependenciesFulfilled=!1:Array.isArray(e)?this.dependenciesFulfilled=e.some(s=>{if(JSON.stringify(h)===JSON.stringify(s))return!0}):typeof e=="object"?typeof h!="object"?this.dependenciesFulfilled=e===h:Object.keys(e).some(s=>{if(!f(e,s))return!1;if(!f(h,s)||e[s]!==h[s])return this.dependenciesFulfilled=!1,!0}):typeof e=="string"||typeof e=="number"?this.dependenciesFulfilled=this.dependenciesFulfilled&&h===e:typeof e=="boolean"&&(e?this.dependenciesFulfilled=this.dependenciesFulfilled&&(h||h.length>0):this.dependenciesFulfilled=this.dependenciesFulfilled&&(!h||h.length===0))}setContainer(t){this.container=t,this.setContainerAttributes(),this.schema.id&&this.container.setAttribute("data-schemaid",this.schema.id),this.schema.type&&typeof this.schema.type=="string"&&this.container.setAttribute("data-schematype",this.schema.type),this.container.setAttribute("data-schemapath",this.path)}setOptInCheckbox(){let t;this.optInWidget==="switch"?t=this.theme.getOptInSwitch(this.formname):t=this.theme.getOptInCheckbox(this.formname),this.optInCheckbox=t.checkbox,this.optInContainer=t.container,this.optInCheckbox.addEventListener("click",()=>{this.isActive()?this.deactivate():this.activate()});const e=this.jsoneditor.options.show_opt_in,i=typeof this.parent.options.show_opt_in<"u",h=i&&this.parent.options.show_opt_in===!0,s=i&&this.parent.options.show_opt_in===!1;(h||!s&&e||!i&&e)&&this.parent&&this.parent.schema.type==="object"&&!this.isRequired()&&this.header&&(this.header.insertBefore(this.optInContainer,this.header.firstChild),this.optInAppended=!0)}preBuild(){}build(){}postBuild(){this.setupWatchListeners(),this.addLinks(),this.register(),this.setValue(this.getDefault(),!0),this.updateHeaderText(),this.onWatchedFieldChange(),this.options.titleHidden&&(this.theme.visuallyHidden(this.label),this.theme.visuallyHidden(this.header)),this.enforceConstEnabled&&this.schema.const&&this.disable()}setupWatchListeners(){if(this.watched={},this.schema.vars&&(this.schema.watch=this.schema.vars),this.watched_values={},this.watch_listener=()=>{this.refreshWatchedFieldValues()&&this.onWatchedFieldChange()},f(this.schema,"watch")){let t,e,i,h,s;const r=this.container.getAttribute("data-schemapath");Object.keys(this.schema.watch).forEach(c=>{if(t=this.schema.watch[c],Array.isArray(t)){if(t.length<2)return;e=[t[0]].concat(t[1].split("."))}else e=t.split("."),this.theme.closest(this.container,`[data-schemaid="${e[0]}"]`)||e.unshift("#");if(i=e.shift(),i==="#"&&(i=this.jsoneditor.schema.id||this.jsoneditor.root.formname),h=this.theme.closest(this.container,`[data-schemaid="${i}"]`),!h)throw new Error(`Could not find ancestor node with id ${i}`);s=`${h.getAttribute("data-schemapath")}.${e.join(".")}`,r.startsWith(s)&&(this.watchLoop=!0),this.jsoneditor.watch(s,this.watch_listener),this.watched[c]=s})}this.schema.headerTemplate&&(this.header_template=this.jsoneditor.compileTemplate(this.schema.headerTemplate,this.template_engine))}addLinks(){if(!this.no_link_holder&&(this.link_holder=this.theme.getLinksHolder(),typeof this.description<"u"?this.description.parentNode.insertBefore(this.link_holder,this.description):this.container.appendChild(this.link_holder),this.schema.links))for(let t=0;t<this.schema.links.length;t++)this.addLink(this.getLink(this.schema.links[t]))}onMove(){}getButton(t,e,i,h=[]){const s=`json-editor-btn-${e}`;this.iconlib?e=this.iconlib.getIcon(e):e=null,t=this.translate(t,h),i=this.translate(i,h),!e&&i&&(t=i,i=null);const r=this.theme.getButton(t,e,i);return r.classList.add(s),r}setButtonText(t,e,i,h,s=[]){return this.iconlib?i=this.iconlib.getIcon(i):i=null,e=this.translate(e,s),h=this.translate(h,s),!i&&h&&(e=h,h=null),this.theme.setButtonText(t,e,i,h)}addLink(t){this.link_holder&&this.link_holder.appendChild(t)}getLink(t){let e,i;const s=(t.mediaType||"application/javascript").split("/")[0],r=this.jsoneditor.compileTemplate(t.href,this.template_engine),c=this.jsoneditor.compileTemplate(t.rel?t.rel:t.href,this.template_engine);let l=null;if(t.download&&(l=t.download),l&&l!==!0&&(l=this.jsoneditor.compileTemplate(l,this.template_engine)),s==="image"){e=this.theme.getBlockLinkHolder(),i=document.createElement("a"),i.setAttribute("target","_blank");const a=document.createElement("img");this.theme.createImageLink(e,i,a),this.link_watchers.push(o=>{const d=r(o),p=c(o);i.setAttribute("href",d),i.setAttribute("title",p||d),a.setAttribute("src",d)})}else if(["audio","video"].includes(s)){e=this.theme.getBlockLinkHolder(),i=this.theme.getBlockLink(),i.setAttribute("target","_blank");const a=document.createElement(s);a.setAttribute("controls","controls"),this.theme.createMediaLink(e,i,a),this.link_watchers.push(o=>{const d=r(o),p=c(o);i.setAttribute("href",d),i.textContent=p||d,a.setAttribute("src",d)})}else i=e=this.theme.getBlockLink(),e.setAttribute("target","_blank"),e.textContent=t.rel,e.style.display="none",this.link_watchers.push(a=>{const o=r(a),d=c(a);o&&(e.style.display=""),e.setAttribute("href",o),e.textContent=d||o});return l&&i&&(l===!0?i.setAttribute("download",""):this.link_watchers.push(a=>{i.setAttribute("download",l(a))})),t.class&&t.class.split(" ").forEach(o=>{i.classList.add(o)}),e}refreshWatchedFieldValues(){if(!this.watched_values)return;const t={};let e=!1;return this.watched&&Object.keys(this.watched).forEach(i=>{const h=this.jsoneditor.getEditor(this.watched[i]),s=h?h.getValue():null;this.watched_values[i]!==s&&(e=!0),t[i]=s}),t.self=this.getValue(),this.watched_values.self!==t.self&&(e=!0),this.watched_values=t,e}getWatchedFieldValues(){return this.watched_values}updateHeaderText(){if(this.header){const t=this.getHeaderText();if(this.header.children.length){for(let e=0;e<this.header.childNodes.length;e++)if(this.header.childNodes[e].nodeType===3){this.header.childNodes[e].nodeValue=this.cleanText(t);break}}else window.DOMPurify?this.header.innerHTML=window.DOMPurify.sanitize(t):this.header.textContent=this.cleanText(t)}}getHeaderText(t){return this.header_text?this.header_text:t?this.translateProperty(this.schema.title):this.getTitle()}getPathDepth(){return this.path.split(".").length}cleanText(t){const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText}onWatchedFieldChange(){let t;if(this.header_template){t=u(this.getWatchedFieldValues(),{key:this.key,i:this.key,i0:this.key*1,i1:this.key*1+1,title:this.getTitle()}),this.editors&&Object.keys(this.editors).length&&(t.properties={},Object.keys(this.editors).forEach(i=>{const h=this.editors[i];if(h.schema&&h.schema.enum&&h.schema.options&&h.schema.options.enum_titles){const s=h.schema.enum.indexOf(h.value),r=h.options.enum_titles[s];t.properties[i]={enumTitle:r}}}));const e=this.header_template(t);e!==this.header_text&&(this.header_text=e,this.updateHeaderText(),this.notify())}if(this.link_watchers.length){t=this.getWatchedFieldValues();for(let e=0;e<this.link_watchers.length;e++)this.link_watchers[e](t)}}setValue(t){t=this.applyConstFilter(t),this.value=t}applyConstFilter(t){return this.enforceConstEnabled&&typeof this.schema.const<"u"&&(t=this.schema.const),t}getValue(){if(this.dependenciesFulfilled)return this.value}refreshValue(){}getChildEditors(){return!1}destroy(){this.unregister(this),this.watched&&Object.values(this.watched).forEach(t=>this.jsoneditor.unwatch(t,this.watch_listener)),this.watched=null,this.watched_values=null,this.watch_listener=null,this.header_text=null,this.header_template=null,this.value=null,this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.jsoneditor=null,this.schema=null,this.path=null,this.key=null,this.parent=null}isDefaultRequired(){return this.isRequired()||!!this.jsoneditor.options.use_default_values}getDefault(){if(this.enforceConstEnabled&&this.schema.const)return this.schema.const;if(typeof this.schema.default<"u")return this.schema.default;if(typeof this.schema.enum<"u")return this.schema.enum[0];let t=this.schema.type||this.schema.oneOf;if(t&&Array.isArray(t)&&(t=t[0]),t&&typeof t=="object"&&(t=t.type),t&&Array.isArray(t)&&(t=t[0]),typeof t=="string"){if(t==="number")return this.isDefaultRequired()?0:void 0;if(t==="boolean")return this.isDefaultRequired()?!1:void 0;if(t==="integer")return this.isDefaultRequired()?0:void 0;if(t==="string")return this.isDefaultRequired()?"":void 0;if(t==="null")return null;if(t==="object")return{};if(t==="array")return[]}}getTitle(){return this.translateProperty(this.schema.title||this.key||this.formname)}enable(){this.disabled=!1}disable(){this.disabled=!0}isEnabled(){return!this.disabled}isRequired(){return typeof this.schema.required=="boolean"?this.schema.required:this.parent&&this.parent.schema&&Array.isArray(this.parent.schema.required)?this.parent.schema.required.includes(this.key):!!this.jsoneditor.options.required_by_default}getDisplayText(t){const e=[],i={};t.forEach(s=>{s.title&&(i[s.title]=i[s.title]||0,i[s.title]++),s.description&&(i[s.description]=i[s.description]||0,i[s.description]++),s.format&&(i[s.format]=i[s.format]||0,i[s.format]++),s.type&&(i[s.type]=i[s.type]||0,i[s.type]++)}),t.forEach(s=>{let r;typeof s=="string"?r=s:s.title&&i[s.title]<=1?r=s.title:s.format&&i[s.format]<=1?r=s.format:s.type&&i[s.type]<=1?r=s.type:s.description&&i[s.description]<=1?r=s.description:s.title?r=s.title:s.format?r=s.format:s.type?r=s.type:s.description?r=s.description:JSON.stringify(s).length<500?r=JSON.stringify(s):r="type",e.push(r)});const h={};return e.forEach((s,r)=>{h[s]=h[s]||0,h[s]++,i[s]>1&&(e[r]=`${s} ${h[s]}`)}),e}getValidId(t){return t=t===void 0?"":t.toString(),t.replace(/\s+/g,"-")}setInputAttributes(t,e){if(this.schema.options&&this.schema.options.inputAttributes){const i=this.schema.options.inputAttributes,h=["name","type"].concat(t),s=e||this.input;Object.keys(i).forEach(r=>{h.includes(r.toLowerCase())||s.setAttribute(r,i[r])})}}setContainerAttributes(){if(this.schema.options&&this.schema.options.containerAttributes){const t=this.schema.options.containerAttributes,e=["data-schemapath","data-schematype","data-schemaid"];Object.keys(t).forEach(i=>{e.includes(i.toLowerCase())||this.container.setAttribute(i,t[i])})}}expandCallbacks(t,e){const i=this.defaults.callbacks[t];return Object.entries(e).forEach(([h,s])=>{s===Object(s)?e[h]=this.expandCallbacks(t,s):typeof s=="string"&&typeof i=="object"&&typeof i[s]=="function"&&(e[h]=i[s].bind(null,this))}),e}showValidationErrors(t){}}export{O as A,A as a,w as b,u as e,E as g,f as h,j as i,g as m,C as o,x as t};
