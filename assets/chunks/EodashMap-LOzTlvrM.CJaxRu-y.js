const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/raw.D6pKN3lG.js","assets/chunks/basedecoder.DvumDe3Y.js","assets/chunks/lzw.oZZD6jgh.js","assets/chunks/jpeg.C0INXBWW.js","assets/chunks/deflate.Bdd8XQIN.js","assets/chunks/pako.esm.CPws4d4z.js","assets/chunks/packbits.DEOShcjz.js","assets/chunks/lerc.B6tymh4S.js","assets/chunks/commonjsHelpers.BosuxZz1.js","assets/chunks/main.BwbP6Nn-.js","assets/chunks/lit-element.Cu4xVypU.js","assets/chunks/getElement.D3H5zNCD.js","assets/chunks/Group.DmZitiGT.js","assets/chunks/GeoJSON.agKdh3Y4.js","assets/chunks/mustache.Cu93kZ_v.js","assets/chunks/framework.c24lRxR4.js","assets/chunks/eo-dash.BU7FIqgH.js","assets/chunks/theme.DvORrVRG.js","assets/chunks/webimage.D-DuHHsL.js"])))=>i.map(i=>d[i]);
var tu=Object.defineProperty;var ru=(n,e,t)=>e in n?tu(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var J=(n,e,t)=>ru(n,typeof e!="symbol"?e+"":e,t);import{g as nu,C as iu,S as Nr,V as Ki,a as Lr,T as po,F as Ai,R as Mt,b as Zr,I as Va,c as Nt,X as Hn,m as N,d as D,p as A,e as Sn,f as su,h as wt,i as G,j as E,w as X,k as oe,l as Ne,O as ur,r as xt,n as Dr,o as ja,q as F,s as Rn,t as vn,u as b,v as P,x as Wn,y as fe,z as Te,A as Pn,B as Xa,D as Ft,E as ou,G as Ji,H as ee,J as We,K as nt,L as au,M as Ha,N as lu,P as cu,Q as Qi,U as Ln,W as uu,Y as ui,Z as bt,_ as St,$ as Zn,a0 as he,a1 as es,a2 as Ze,a3 as ts,a4 as Wa,a5 as mo,a6 as zt,a7 as _o,a8 as qt,a9 as hu,aa as Ii,ab as Za,ac as rs,ad as Ur,ae as fu,af as du,ag as ie,ah as Ya,ai as Br,aj as Ae,ak as Rt,al as hr,am as gu,an as k,ao as pu,ap as mu,aq as _u,ar as yu,as as xu,at as bu,au as ns,av as Eu,aw as is,ax as An,ay as qa,az as mt,aA as Yr,aB as qr,aC as ss,aD as Gr,aE as Yn,aF as wu,aG as Tu,aH as hi,aI as qn,aJ as Ci,aK as Ka,aL as fr,aM as Ja,aN as In,aO as yo,aP as jt,aQ as os,aR as Su,aS as Qa,aT as Kn,aU as Ru,aV as as,aW as vu,aX as Pu,aY as Lu,aZ as el,a_ as Au,a$ as Iu,b0 as Cu,b1 as Fu,b2 as tl,b3 as Ou,b4 as rl,b5 as Mu,b6 as Nu,b7 as Du,b8 as nl,b9 as Uu,ba as Bu,bb as Gu}from"./main.BwbP6Nn-.js";import{m as zr,g as K,a as Cn,d as xo,e as En,F as Ye,P as it,L as ft,J as zu,t as Se,b as ku,c as Fi,l as $u,M as Kr,f as ls,h as Jn,i as Qn,j as cs,G as Vu,k as ju,n as Xu,o as Hu,p as kr,S as bo,q as Wu,r as us,s as be,u as hs,v as $r,w as dt,x as fs,y as Zu,z as Eo,A as Yu,B as il,R as qu,C as Ku,D as sl,E as Ju,H as ds,I as Qu,K as eh,N as Vr,O as th,Q as rh,T as wo,U as To,V as nh,W as So,X as ol}from"./GeoJSON.agKdh3Y4.js";import{s as ih,w as sh,a as oh,b as kt,e as jr,i as gs,c as Tt,d as ir,f as De,h as Fn,j as ue,k as sr,l as Qt,m as ah,n as On,o as al,p as qe,q as ps,r as ms,t as ne,D as ll,u as lh,v as ch,x as ei,y as Et,z as _s,A as cl,T as uh,E as Ie,B as hh,C as ul,F as vt,G as fh,H as dh,I as gh,J as ph,K as mh,L as Ro,M as hl,N as _h,O as yh}from"./getElement.D3H5zNCD.js";import{T as fl,W as xh,m as bh}from"./mustache.Cu93kZ_v.js";import{C as Eh,a as Oi,L as dl}from"./Group.DmZitiGT.js";import{g as gl}from"./commonjsHelpers.BosuxZz1.js";import{a1 as Lt,p as Er,ah as vo,h as Po,v as pl,c as wh,j as fi,N as Th,k as Lo,x as ml,q as Sh,o as Rh,P as Ao}from"./framework.c24lRxR4.js";import{S as vh,C as Ph,p as _l,q as yl,r as xl,I as bl,M as Lh,A as di,t as Ah,v as Ih,w as hn,s as Mi,a as Ni,k as Ch,j as Fh,d as Io,f as Co,l as Dt,x as Oh,h as Mh,n as Nh,y as Ar,z as Dh,E as Fo,B as Uh,D as Bh}from"./eo-dash.BU7FIqgH.js";function Gh(n){if(!(n.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const e=n.inversePixelTransform[0],t=n.inversePixelTransform[1],r=Math.sqrt(e*e+t*t),i=n.frameState,s=zr(n.inversePixelTransform.slice(),i.coordinateToPixelTransform),o=nu(i.viewState.resolution,r);let a;return new iu(n.context,r,i.extent,s,i.viewState.rotation,o,a)}function El(n,e,t){const r=[];let i=n(0),s=n(1),o=e(i),a=e(s);const l=[s,i],c=[a,o],u=[1,0],h={};let f=1e5,d,g,p,m,y,_;for(;--f>0&&u.length>0;)p=u.pop(),i=l.pop(),o=c.pop(),_=p.toString(),_ in h||(r.push(o[0],o[1]),h[_]=!0),m=u.pop(),s=l.pop(),a=c.pop(),y=(p+m)/2,d=n(y),g=e(d),ih(g[0],g[1],o[0],o[1],a[0],a[1])<t?(r.push(a[0],a[1]),_=m.toString(),h[_]=!0):(u.push(m,y,y,p),c.push(a,g,g,o),l.push(s,d,d,i));return r}function zh(n,e,t,r,i){const s=K("EPSG:4326");return El(function(o){return[n,e+(t-e)*o]},Cn(s,r),i)}function kh(n,e,t,r,i){const s=K("EPSG:4326");return El(function(o){return[e+(t-e)*o,n]},Cn(s,r),i)}const $h=new Nr({color:"rgba(0,0,0,0.2)"}),Vh=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600];class jh extends Ki{constructor(e){e=e||{};const t=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},e);delete t.maxLines,delete t.strokeStyle,delete t.targetSize,delete t.showLabels,delete t.lonLabelFormatter,delete t.latLabelFormatter,delete t.lonLabelPosition,delete t.latLabelPosition,delete t.lonLabelStyle,delete t.latLabelStyle,delete t.intervals,super(t),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=e.targetSize!==void 0?e.targetSize:100,this.maxLines_=e.maxLines!==void 0?e.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=e.strokeStyle!==void 0?e.strokeStyle:$h,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,e.showLabels&&(this.lonLabelFormatter_=e.lonLabelFormatter==null?xo.bind(this,"EW"):e.lonLabelFormatter,this.latLabelFormatter_=e.latLabelFormatter==null?xo.bind(this,"NS"):e.latLabelFormatter,this.lonLabelPosition_=e.lonLabelPosition==null?0:e.lonLabelPosition,this.latLabelPosition_=e.latLabelPosition==null?1:e.latLabelPosition,this.lonLabelStyleBase_=new Lr({text:e.lonLabelStyle!==void 0?e.lonLabelStyle.clone():new po({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new Ai({color:"rgba(0,0,0,1)"}),stroke:new Nr({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=r=>{const i=r.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(i),this.lonLabelStyleBase_},this.latLabelStyleBase_=new Lr({text:e.latLabelStyle!==void 0?e.latLabelStyle.clone():new po({font:"12px Calibri,sans-serif",textAlign:"right",fill:new Ai({color:"rgba(0,0,0,1)"}),stroke:new Nr({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=r=>{const i=r.get("graticule_label");return this.latLabelStyleBase_.getText().setText(i),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(Mt.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=e.intervals!==void 0?e.intervals:Vh,this.setSource(new Zr({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new Eh,overlaps:!1,useSpatialIndex:!1,wrapX:e.wrapX})),this.featurePool_=[],this.lineStyle_=new Lr({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(e,t){let r=e.slice();return this.projection_&&this.getSource().getWrapX()&&sh(r,this.projection_),this.loadedExtent_&&(oh(this.loadedExtent_,r,t)?r=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[r]}loaderFunction(e,t,r){this.loadedExtent_=e;const i=this.getSource(),s=this.getExtent()||[-1/0,-1/0,1/0,1/0],o=kt(s,e);if(this.renderedExtent_&&jr(this.renderedExtent_,o)&&this.renderedResolution_===t||(this.renderedExtent_=o,this.renderedResolution_=t,gs(o)))return;const a=Tt(o),l=t*t/4;(!this.projection_||!En(this.projection_,r))&&this.updateProjectionInfo_(r),this.createGraticule_(o,a,t,l);let u=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(u+=this.meridians_.length),this.parallelsLabels_&&(u+=this.parallels_.length);let h;for(;u>this.featurePool_.length;)h=new Ye,this.featurePool_.push(h);const f=i.getFeaturesCollection();f.clear();let d=0,g,p;for(g=0,p=this.meridians_.length;g<p;++g)h=this.featurePool_[d++],h.setGeometry(this.meridians_[g]),h.setStyle(this.lineStyle_),f.push(h);for(g=0,p=this.parallels_.length;g<p;++g)h=this.featurePool_[d++],h.setGeometry(this.parallels_[g]),h.setStyle(this.lineStyle_),f.push(h)}addMeridian_(e,t,r,i,s,o){const a=this.getMeridian_(e,t,r,i,o);if(ir(a.getExtent(),s)){if(this.meridiansLabels_){const l=this.lonLabelFormatter_(e);o in this.meridiansLabels_?this.meridiansLabels_[o].text=l:this.meridiansLabels_[o]={geom:new it([]),text:l}}this.meridians_[o++]=a}return o}addParallel_(e,t,r,i,s,o){const a=this.getParallel_(e,t,r,i,o);if(ir(a.getExtent(),s)){if(this.parallelsLabels_){const l=this.latLabelFormatter_(e);o in this.parallelsLabels_?this.parallelsLabels_[o].text=l:this.parallelsLabels_[o]={geom:new it([]),text:l}}this.parallels_[o++]=a}return o}drawLabels_(e){const t=e.frameState.viewState.rotation,r=e.frameState.viewState.resolution,i=e.frameState.size,s=e.frameState.extent,o=Tt(s);let a=s;if(t){const g=i[0]*r,p=i[1]*r;a=[o[0]-g/2,o[1]-p/2,o[0]+g/2,o[1]+p/2]}let l=0,c=0,u=this.latLabelPosition_<.5;const h=this.projection_.getExtent(),f=De(h);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Fn(h,s)){l=Math.floor((s[0]-h[0])/f),c=Math.ceil((s[2]-h[2])/f);const g=Math.abs(t)>Math.PI/2;u=u!==g}const d=Gh(e);for(let g=l;g<=c;++g){let p=this.meridians_.length+this.parallels_.length,m,y,_,x;if(this.meridiansLabels_)for(y=0,_=this.meridiansLabels_.length;y<_;++y){const w=this.meridians_[y];if(!t&&g===0)x=this.getMeridianPoint_(w,s,y);else{const S=w.clone();S.translate(g*f,0),S.rotate(-t,o),x=this.getMeridianPoint_(S,a,y),x.rotate(t,o)}m=this.featurePool_[p++],m.setGeometry(x),m.set("graticule_label",this.meridiansLabels_[y].text),d.drawFeature(m,this.lonLabelStyle_(m))}if(this.parallelsLabels_&&(g===l&&u||g===c&&!u))for(y=0,_=this.parallels_.length;y<_;++y){const w=this.parallels_[y];if(!t&&g===0)x=this.getParallelPoint_(w,s,y);else{const S=w.clone();S.translate(g*f,0),S.rotate(-t,o),x=this.getParallelPoint_(S,a,y),x.rotate(t,o)}m=this.featurePool_[p++],m.setGeometry(x),m.set("graticule_label",this.parallelsLabels_[y].text),d.drawFeature(m,this.latLabelStyle_(m))}}}createGraticule_(e,t,r,i){const s=this.getInterval_(r);if(s==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let o=!1;const a=this.projection_.getExtent(),l=De(a);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!Fn(a,e)&&(De(e)>=l?(e[0]=a[0],e[2]=a[2]):o=!0);const c=[ue(t[0],this.minX_,this.maxX_),ue(t[1],this.minY_,this.maxY_)],u=this.toLonLatTransform_(c);isNaN(u[1])&&(u[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let h=ue(u[0],this.minLon_,this.maxLon_),f=ue(u[1],this.minLat_,this.maxLat_);const d=this.maxLines_;let g,p,m,y,_=e;o||(_=[ue(e[0],this.minX_,this.maxX_),ue(e[1],this.minY_,this.maxY_),ue(e[2],this.minX_,this.maxX_),ue(e[3],this.minY_,this.maxY_)]);const x=sr(_,this.toLonLatTransform_,void 0,8);let w=x[3],S=x[2],T=x[1],R=x[0];if(o||(Qt(_,this.bottomLeft_)&&(R=this.minLon_,T=this.minLat_),Qt(_,this.bottomRight_)&&(S=this.maxLon_,T=this.minLat_),Qt(_,this.topLeft_)&&(R=this.minLon_,w=this.maxLat_),Qt(_,this.topRight_)&&(S=this.maxLon_,w=this.maxLat_),w=ue(w,f,this.maxLat_),S=ue(S,h,this.maxLon_),T=ue(T,this.minLat_,f),R=ue(R,this.minLon_,h)),h=Math.floor(h/s)*s,y=ue(h,this.minLon_,this.maxLon_),p=this.addMeridian_(y,T,w,i,e,0),g=0,o)for(;(y-=s)>=R&&g++<d;)p=this.addMeridian_(y,T,w,i,e,p);else for(;y!=this.minLon_&&g++<d;)y=Math.max(y-s,this.minLon_),p=this.addMeridian_(y,T,w,i,e,p);if(y=ue(h,this.minLon_,this.maxLon_),g=0,o)for(;(y+=s)<=S&&g++<d;)p=this.addMeridian_(y,T,w,i,e,p);else for(;y!=this.maxLon_&&g++<d;)y=Math.min(y+s,this.maxLon_),p=this.addMeridian_(y,T,w,i,e,p);for(this.meridians_.length=p,this.meridiansLabels_&&(this.meridiansLabels_.length=p),f=Math.floor(f/s)*s,m=ue(f,this.minLat_,this.maxLat_),p=this.addParallel_(m,R,S,i,e,0),g=0;m!=this.minLat_&&g++<d;)m=Math.max(m-s,this.minLat_),p=this.addParallel_(m,R,S,i,e,p);for(m=ue(f,this.minLat_,this.maxLat_),g=0;m!=this.maxLat_&&g++<d;)m=Math.min(m+s,this.maxLat_),p=this.addParallel_(m,R,S,i,e,p);this.parallels_.length=p,this.parallelsLabels_&&(this.parallelsLabels_.length=p)}getInterval_(e){const t=this.projectionCenterLonLat_[0],r=this.projectionCenterLonLat_[1];let i=-1;const s=Math.pow(this.targetSize_*e,2),o=[],a=[];for(let l=0,c=this.intervals_.length;l<c;++l){const u=ue(this.intervals_[l]/2,0,90),h=ue(r,-90+u,90-u);if(o[0]=t-u,o[1]=h-u,a[0]=t+u,a[1]=h+u,this.fromLonLatTransform_(o,o),this.fromLonLatTransform_(a,a),Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)<=s)break;i=this.intervals_[l]}return i}getMeridian_(e,t,r,i,s){const o=zh(e,t,r,this.projection_,i);let a=this.meridians_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):(a=new ft(o,"XY"),this.meridians_[s]=a),a}getMeridianPoint_(e,t,r){const i=e.getFlatCoordinates();let s=1,o=i.length-1;i[s]>i[o]&&(s=o,o=1);const a=Math.max(t[1],i[s]),l=Math.min(t[3],i[o]),c=ue(t[1]+Math.abs(t[1]-t[3])*this.lonLabelPosition_,a,l),h=[i[s-1]+(i[o-1]-i[s-1])*(c-i[s])/(i[o]-i[s]),c],f=this.meridiansLabels_[r].geom;return f.setCoordinates(h),f}getMeridians(){return this.meridians_}getParallel_(e,t,r,i,s){const o=kh(e,t,r,this.projection_,i);let a=this.parallels_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):a=new ft(o,"XY"),a}getParallelPoint_(e,t,r){const i=e.getFlatCoordinates();let s=0,o=i.length-2;i[s]>i[o]&&(s=o,o=0);const a=Math.max(t[0],i[s]),l=Math.min(t[2],i[o]),c=ue(t[0]+Math.abs(t[0]-t[2])*this.latLabelPosition_,a,l),u=i[s+1]+(i[o+1]-i[s+1])*(c-i[s])/(i[o]-i[s]),h=[c,u],f=this.parallelsLabels_[r].geom;return f.setCoordinates(h),f}getParallels(){return this.parallels_}updateProjectionInfo_(e){const t=K("EPSG:4326"),r=e.getWorldExtent();this.maxLat_=r[3],this.maxLon_=r[2],this.minLat_=r[1],this.minLon_=r[0];const i=Cn(e,t);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=i;else{const o=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(a,l,c){c=c||2;const u=i(a,l,c);for(let h=0,f=u.length;h<f;h+=c)u[h]<o&&(u[h]+=360);return u}}this.fromLonLatTransform_=Cn(t,e);const s=sr([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=s[0],this.maxX_=s[2],this.minY_=s[1],this.maxY_=s[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(Tt(e.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=e}}class ys extends Va{constructor(e,t,r,i,s){const o=s!==void 0?Nt.IDLE:Nt.LOADED;super(e,t,r,o),this.loader_=s!==void 0?s:null,this.canvas_=i,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=Nt.ERROR):this.state=Nt.LOADED,this.changed()}load(){this.state==Nt.IDLE&&(this.state=Nt.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}const Xh={Point:Yh,LineString:qh,Polygon:ef,MultiPoint:Jh,MultiLineString:Kh,MultiPolygon:Qh},Hh={Point:tf,LineString:rf,Polygon:nf,MultiPoint:of,MultiLineString:sf,MultiPolygon:af};class Wh extends zu{constructor(e){e=e||{},super(),this.geometryName_=e.geometryName}readFeatureFromObject(e,t,r){const i=e,s=Oo(i.geometry,t),o=new Ye;if(this.geometryName_&&o.setGeometryName(this.geometryName_),o.setGeometry(s),i.attributes){o.setProperties(i.attributes,!0);const a=i.attributes[r];a!==void 0&&o.setId(a)}return o}readFeaturesFromObject(e,t){if(t=t||{},e.features){const r=e,i=[],s=r.features;for(let o=0,a=s.length;o<a;++o)i.push(this.readFeatureFromObject(s[o],t,e.objectIdFieldName));return i}return[this.readFeatureFromObject(e,t)]}readGeometryFromObject(e,t){return Oo(e,t)}readProjectionFromObject(e){if(e.spatialReference&&e.spatialReference.wkid!==void 0){const r=e.spatialReference.wkid;return K("EPSG:"+r)}return null}writeGeometryObject(e,t){return Mo(e,this.adaptOptions(t))}writeFeatureObject(e,t){t=this.adaptOptions(t);const r={};if(!e.hasProperties())return r.attributes={},r;const i=e.getProperties(),s=e.getGeometry();if(s){r.geometry=Mo(s,t);const o=t&&(t.dataProjection||t.featureProjection);o&&(r.geometry.spatialReference={wkid:Number(K(o).getCode().split(":").pop())}),delete i[e.getGeometryName()]}return ah(i)?r.attributes={}:r.attributes=i,r}writeFeaturesObject(e,t){t=this.adaptOptions(t);const r=[];for(let i=0,s=e.length;i<s;++i)r.push(this.writeFeatureObject(e[i],t));return{features:r}}}function Oo(n,e){if(!n)return null;let t;if(typeof n.x=="number"&&typeof n.y=="number")t="Point";else if(n.points)t="MultiPoint";else if(n.paths)n.paths.length===1?t="LineString":t="MultiLineString";else if(n.rings){const i=n,s=dr(i),o=Zh(i.rings,s);o.length===1?(t="Polygon",n=Object.assign({},n,{rings:o[0]})):(t="MultiPolygon",n=Object.assign({},n,{rings:o}))}const r=Xh[t];return Se(r(n),!1,e)}function Zh(n,e){const t=[],r=[],i=[];let s,o;for(s=0,o=n.length;s<o;++s)t.length=0,ku(t,0,n[s],e.length),$u(t,0,t.length,e.length)?r.push([n[s]]):i.push(n[s]);for(;i.length;){const a=i.shift();let l=!1;for(s=r.length-1;s>=0;s--){const c=r[s][0];if(Fn(new Fi(c).getExtent(),new Fi(a).getExtent())){r[s].push(a),l=!0;break}}l||r.push([a.reverse()])}return r}function Yh(n){let e;return n.m!==void 0&&n.z!==void 0?e=new it([n.x,n.y,n.z,n.m],"XYZM"):n.z!==void 0?e=new it([n.x,n.y,n.z],"XYZ"):n.m!==void 0?e=new it([n.x,n.y,n.m],"XYM"):e=new it([n.x,n.y]),e}function qh(n){const e=dr(n);return new ft(n.paths[0],e)}function Kh(n){const e=dr(n);return new Kr(n.paths,e)}function dr(n){let e="XY";return n.hasZ===!0&&n.hasM===!0?e="XYZM":n.hasZ===!0?e="XYZ":n.hasM===!0&&(e="XYM"),e}function Jh(n){const e=dr(n);return new ls(n.points,e)}function Qh(n){const e=dr(n);return new Jn(n.rings,e)}function ef(n){const e=dr(n);return new Qn(n.rings,e)}function tf(n,e){const t=n.getCoordinates();let r;const i=n.getLayout();if(i==="XYZ")r={x:t[0],y:t[1],z:t[2]};else if(i==="XYM")r={x:t[0],y:t[1],m:t[2]};else if(i==="XYZM")r={x:t[0],y:t[1],z:t[2],m:t[3]};else if(i==="XY")r={x:t[0],y:t[1]};else throw new Error("Invalid geometry layout");return r}function Jr(n){const e=n.getLayout();return{hasZ:e==="XYZ"||e==="XYZM",hasM:e==="XYM"||e==="XYZM"}}function rf(n,e){const t=Jr(n);return{hasZ:t.hasZ,hasM:t.hasM,paths:[n.getCoordinates()]}}function nf(n,e){const t=Jr(n);return{hasZ:t.hasZ,hasM:t.hasM,rings:n.getCoordinates(!1)}}function sf(n,e){const t=Jr(n);return{hasZ:t.hasZ,hasM:t.hasM,paths:n.getCoordinates()}}function of(n,e){const t=Jr(n);return{hasZ:t.hasZ,hasM:t.hasM,points:n.getCoordinates()}}function af(n,e){const t=Jr(n),r=n.getCoordinates(!1),i=[];for(let s=0;s<r.length;s++)for(let o=r[s].length-1;o>=0;o--)i.push(r[s][o]);return{hasZ:t.hasZ,hasM:t.hasM,rings:i}}function Mo(n,e){const t=Hh[n.getType()];return t(Se(n,!0,e),e)}const ht="http://www.opengis.net/gml",lf=/^\s*$/;class O extends Hn{constructor(e){super(),e=e||{},this.featureType=e.featureType,this.featureNS=e.featureNS,this.srsName=e.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:N(this.readFeaturesInternal),featureMembers:D(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(e,t){const r=e.localName;let i=null;if(r=="FeatureCollection")i=A([],this.FEATURE_COLLECTION_PARSERS,e,t,this);else if(r=="featureMembers"||r=="featureMember"||r=="member"){const s=t[0];let o=s.featureType,a=s.featureNS;const l="p",c="p0";if(!o&&e.childNodes){o=[],a={};for(let f=0,d=e.childNodes.length;f<d;++f){const g=e.childNodes[f];if(g.nodeType===1){const p=g.nodeName.split(":").pop();if(!o.includes(p)){let m="",y=0;const _=g.namespaceURI;for(const x in a){if(a[x]===_){m=x;break}++y}m||(m=l+y,a[m]=_),o.push(m+":"+p)}}}r!="featureMember"&&(s.featureType=o,s.featureNS=a)}if(typeof a=="string"){const f=a;a={},a[c]=f}const u={},h=Array.isArray(o)?o:[o];for(const f in a){const d={};for(let g=0,p=h.length;g<p;++g)(h[g].includes(":")?h[g].split(":")[0]:c)===f&&(d[h[g].split(":").pop()]=r=="featureMembers"?N(this.readFeatureElement,this):D(this.readFeatureElement,this));u[a[f]]=d}r=="featureMember"||r=="member"?i=A(void 0,u,e,t):i=A([],u,e,t)}return i===null&&(i=[]),i}readGeometryOrExtent(e,t){const r=t[0];return r.srsName=e.firstElementChild.getAttribute("srsName"),r.srsDimension=e.firstElementChild.getAttribute("srsDimension"),A(null,this.GEOMETRY_PARSERS,e,t,this)}readExtentElement(e,t){const r=t[0],i=this.readGeometryOrExtent(e,t);return i?cs(i,r):void 0}readGeometryElement(e,t){const r=t[0],i=this.readGeometryOrExtent(e,t);return i?Se(i,!1,r):void 0}readFeatureElementInternal(e,t,r){let i;const s={};for(let l=e.firstElementChild;l;l=l.nextElementSibling){let c;const u=l.localName;l.childNodes.length===0||l.childNodes.length===1&&(l.firstChild.nodeType===3||l.firstChild.nodeType===4)?(c=Sn(l,!1),lf.test(c)&&(c=void 0)):(r&&(c=u==="boundedBy"?this.readExtentElement(l,t):this.readGeometryElement(l,t)),c?u!=="boundedBy"&&(i=u):c=this.readFeatureElementInternal(l,t,!1));const h=l.attributes.length;if(h>0&&!(c instanceof Vu)){c={_content_:c};for(let f=0;f<h;f++){const d=l.attributes[f].name;c[d]=l.attributes[f].value}}s[u]?(s[u]instanceof Array||(s[u]=[s[u]]),s[u].push(c)):s[u]=c}if(!r)return s;const o=new Ye(s);i&&o.setGeometryName(i);const a=e.getAttribute("fid")||su(e,this.namespace,"id");return a&&o.setId(a),o}readFeatureElement(e,t){return this.readFeatureElementInternal(e,t,!0)}readPoint(e,t){const r=this.readFlatCoordinatesFromNode(e,t);if(r)return new it(r,"XYZ")}readMultiPoint(e,t){const r=A([],this.MULTIPOINT_PARSERS,e,t,this);if(r)return new ls(r)}readMultiLineString(e,t){const r=A([],this.MULTILINESTRING_PARSERS,e,t,this);if(r)return new Kr(r)}readMultiPolygon(e,t){const r=A([],this.MULTIPOLYGON_PARSERS,e,t,this);if(r)return new Jn(r)}pointMemberParser(e,t){wt(this.POINTMEMBER_PARSERS,e,t,this)}lineStringMemberParser(e,t){wt(this.LINESTRINGMEMBER_PARSERS,e,t,this)}polygonMemberParser(e,t){wt(this.POLYGONMEMBER_PARSERS,e,t,this)}readLineString(e,t){const r=this.readFlatCoordinatesFromNode(e,t);if(r)return new ft(r,"XYZ")}readFlatLinearRing(e,t){const r=A(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this);if(r)return r}readLinearRing(e,t){const r=this.readFlatCoordinatesFromNode(e,t);if(r)return new Fi(r,"XYZ")}readPolygon(e,t){const r=A([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this);if(r&&r[0]){const i=r[0],s=[i.length];let o,a;for(o=1,a=r.length;o<a;++o)On(i,r[o]),s.push(i.length);return new Qn(i,"XYZ",s)}}readFlatCoordinatesFromNode(e,t){return A(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}readGeometryFromNode(e,t){const r=this.readGeometryElement(e,[this.getReadOptions(e,t||{})]);return r||null}readFeaturesFromNode(e,t){const r={featureType:this.featureType,featureNS:this.featureNS};return r&&Object.assign(r,this.getReadOptions(e,t)),this.readFeaturesInternal(e,[r])||[]}readProjectionFromNode(e){return K(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))}}O.prototype.namespace=ht;O.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};O.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};O.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};O.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:N(O.prototype.pointMemberParser),pointMembers:N(O.prototype.pointMemberParser)}};O.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:N(O.prototype.lineStringMemberParser),lineStringMembers:N(O.prototype.lineStringMemberParser)}};O.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:N(O.prototype.polygonMemberParser),polygonMembers:N(O.prototype.polygonMemberParser)}};O.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:N(O.prototype.readFlatCoordinatesFromNode)}};O.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:N(O.prototype.readLineString)}};O.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:N(O.prototype.readPolygon)}};O.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:D(O.prototype.readFlatLinearRing)}};const cf=ht+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",uf={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class V extends O{constructor(e){e=e||{},super(e),this.FEATURE_COLLECTION_PARSERS[ht].featureMember=N(this.readFeaturesInternal),this.schemaLocation=e.schemaLocation?e.schemaLocation:cf}readFlatCoordinates(e,t){const r=Sn(e,!1).replace(/^\s*|\s*$/g,""),s=t[0].srsName;let o="enu";if(s){const c=K(s);c&&(o=c.getAxisOrientation())}const a=r.trim().split(/\s+/),l=[];for(let c=0,u=a.length;c<u;c++){const h=a[c].split(/,+/),f=parseFloat(h[0]),d=parseFloat(h[1]),g=h.length===3?parseFloat(h[2]):0;o.startsWith("en")?l.push(f,d,g):l.push(d,f,g)}return l}readBox(e,t){const r=A([null],this.BOX_PARSERS_,e,t,this);return al(r[1][0],r[1][1],r[1][3],r[1][4])}innerBoundaryIsParser(e,t){const r=A(void 0,this.RING_PARSERS,e,t,this);r&&t[t.length-1].push(r)}outerBoundaryIsParser(e,t){const r=A(void 0,this.RING_PARSERS,e,t,this);if(r){const i=t[t.length-1];i[0]=r}}GEOMETRY_NODE_FACTORY_(e,t,r){const i=t[t.length-1],s=i.multiSurface,o=i.surface,a=i.multiCurve;return Array.isArray(e)?r="Envelope":(r=e.getType(),r==="MultiPolygon"&&s===!0?r="MultiSurface":r==="Polygon"&&o===!0?r="Surface":r==="MultiLineString"&&a===!0&&(r="MultiCurve")),G("http://www.opengis.net/gml",r)}writeFeatureElement(e,t,r){const i=t.getId();i&&e.setAttribute("fid",i);const s=r[r.length-1],o=s.featureNS,a=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],c=[];if(t.hasProperties()){const h=t.getProperties();for(const f in h){const d=h[f];d!=null&&(l.push(f),c.push(d),f==a||typeof d.getSimplifiedGeometry=="function"?f in s.serializers[o]||(s.serializers[o][f]=E(this.writeGeometryElement,this)):f in s.serializers[o]||(s.serializers[o][f]=E(X)))}}const u=Object.assign({},s);u.node=e,oe(u,s.serializers,Ne(void 0,o),c,r,l)}writeCurveOrLineString(e,t,r){const s=r[r.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,r)}else if(e.nodeName==="Curve"){const o=G(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,r)}}writeLineStringOrCurveMember(e,t,r){const i=this.GEOMETRY_NODE_FACTORY_(t,r);i&&(e.appendChild(i),this.writeCurveOrLineString(i,t,r))}writeMultiCurveOrLineString(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();oe({node:e,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,r,void 0,this)}writeGeometryElement(e,t,r){const i=r[r.length-1],s=Object.assign({},i);s.node=e;let o;Array.isArray(t)?o=cs(t,i):o=Se(t,!0,i),oe(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],r,void 0,this)}createCoordinatesNode_(e){const t=G(e,"coordinates");return t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," "),t}writeCoordinates_(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=t.getCoordinates(),l=a.length,c=new Array(l);for(let u=0;u<l;++u){const h=a[u];c[u]=this.getCoords_(h,o,s)}X(e,c.join(" "))}writeCurveSegments_(e,t,r){const i=G(e.namespaceURI,"LineStringSegment");e.appendChild(i),this.writeCurveOrLineString(i,t,r)}writeSurfaceOrPolygon(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();oe({node:e,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,r,void 0,this)}else if(e.nodeName==="Surface"){const a=G(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,r)}}RING_NODE_FACTORY_(e,t,r){const i=t[t.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),G(s.namespaceURI,o!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(e,t,r){const i=G(e.namespaceURI,"PolygonPatch");e.appendChild(i),this.writeSurfaceOrPolygon(i,t,r)}writeRing(e,t,r){const i=G(e.namespaceURI,"LinearRing");e.appendChild(i),this.writeLinearRing(i,t,r)}getCoords_(e,t,r){let s=(t?K(t).getAxisOrientation():"enu").startsWith("en")?e[0]+","+e[1]:e[1]+","+e[0];if(r){const o=e[2]||0;s+=","+o}return s}writePoint(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName;o&&e.setAttribute("srsName",o);const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a);const l=t.getCoordinates(),c=this.getCoords_(l,o,s);X(a,c)}writeMultiPoint(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName;o&&e.setAttribute("srsName",o);const a=t.getPoints();oe({node:e,hasZ:s,srsName:o},this.POINTMEMBER_SERIALIZERS,Ne("pointMember"),a,r,void 0,this)}writePointMember(e,t,r){const i=G(e.namespaceURI,"Point");e.appendChild(i),this.writePoint(i,t,r)}writeLinearRing(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,r)}writeMultiSurfaceOrPolygon(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();oe({node:e,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,r,void 0,this)}writeSurfaceOrPolygonMember(e,t,r){const i=this.GEOMETRY_NODE_FACTORY_(t,r);i&&(e.appendChild(i),this.writeSurfaceOrPolygon(i,t,r))}writeEnvelope(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];oe({node:e},this.ENVELOPE_SERIALIZERS,ur,a,r,o,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,r){const i=t[t.length-1].node;return G("http://www.opengis.net/gml",uf[i.nodeName])}}V.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:D(V.prototype.readFlatCoordinates)}};V.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:V.prototype.innerBoundaryIsParser,outerBoundaryIs:V.prototype.outerBoundaryIsParser}};V.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:N(V.prototype.readFlatCoordinates)}};V.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:D(O.prototype.readPoint),MultiPoint:D(O.prototype.readMultiPoint),LineString:D(O.prototype.readLineString),MultiLineString:D(O.prototype.readMultiLineString),LinearRing:D(O.prototype.readLinearRing),Polygon:D(O.prototype.readPolygon),MultiPolygon:D(O.prototype.readMultiPolygon),Box:D(V.prototype.readBox)}};V.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:E(V.prototype.writeCurveOrLineString),MultiCurve:E(V.prototype.writeMultiCurveOrLineString),Point:E(V.prototype.writePoint),MultiPoint:E(V.prototype.writeMultiPoint),LineString:E(V.prototype.writeCurveOrLineString),MultiLineString:E(V.prototype.writeMultiCurveOrLineString),LinearRing:E(V.prototype.writeLinearRing),Polygon:E(V.prototype.writeSurfaceOrPolygon),MultiPolygon:E(V.prototype.writeMultiSurfaceOrPolygon),Surface:E(V.prototype.writeSurfaceOrPolygon),MultiSurface:E(V.prototype.writeMultiSurfaceOrPolygon),Envelope:E(V.prototype.writeEnvelope)}};V.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:E(V.prototype.writeLineStringOrCurveMember),curveMember:E(V.prototype.writeLineStringOrCurveMember)}};V.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:E(V.prototype.writeRing),innerBoundaryIs:E(V.prototype.writeRing)}};V.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:E(V.prototype.writePointMember)}};V.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:E(V.prototype.writeSurfaceOrPolygonMember),polygonMember:E(V.prototype.writeSurfaceOrPolygonMember)}};V.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:E(X),upperCorner:E(X)}};const hf=ht+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",ff={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class v extends O{constructor(e){e=e||{},super(e),this.surface_=e.surface!==void 0?e.surface:!1,this.curve_=e.curve!==void 0?e.curve:!1,this.multiCurve_=e.multiCurve!==void 0?e.multiCurve:!0,this.multiSurface_=e.multiSurface!==void 0?e.multiSurface:!0,this.schemaLocation=e.schemaLocation?e.schemaLocation:hf,this.hasZ=e.hasZ!==void 0?e.hasZ:!1}readMultiCurve(e,t){const r=A([],this.MULTICURVE_PARSERS,e,t,this);if(r)return new Kr(r)}readFlatCurveRing(e,t){const r=A([],this.MULTICURVE_PARSERS,e,t,this),i=[];for(let s=0,o=r.length;s<o;++s)On(i,r[s].getFlatCoordinates());return i}readMultiSurface(e,t){const r=A([],this.MULTISURFACE_PARSERS,e,t,this);if(r)return new Jn(r)}curveMemberParser(e,t){wt(this.CURVEMEMBER_PARSERS,e,t,this)}surfaceMemberParser(e,t){wt(this.SURFACEMEMBER_PARSERS,e,t,this)}readPatch(e,t){return A([null],this.PATCHES_PARSERS,e,t,this)}readSegment(e,t){return A([],this.SEGMENTS_PARSERS,e,t,this)}readPolygonPatch(e,t){return A([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this)}readLineStringSegment(e,t){return A([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}interiorParser(e,t){const r=A(void 0,this.RING_PARSERS,e,t,this);r&&t[t.length-1].push(r)}exteriorParser(e,t){const r=A(void 0,this.RING_PARSERS,e,t,this);if(r){const i=t[t.length-1];i[0]=r}}readSurface(e,t){const r=A([null],this.SURFACE_PARSERS,e,t,this);if(r&&r[0]){const i=r[0],s=[i.length];let o,a;for(o=1,a=r.length;o<a;++o)On(i,r[o]),s.push(i.length);return new Qn(i,"XYZ",s)}}readCurve(e,t){const r=A([null],this.CURVE_PARSERS,e,t,this);if(r)return new ft(r,"XYZ")}readEnvelope(e,t){const r=A([null],this.ENVELOPE_PARSERS,e,t,this);return al(r[1][0],r[1][1],r[2][0],r[2][1])}readFlatPos(e,t){let r=Sn(e,!1);const i=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,s=[];let o;for(;o=i.exec(r);)s.push(parseFloat(o[1])),r=r.substr(o[0].length);if(r!=="")return;const l=t[0].srsName;if((l?K(l).getAxisOrientation():"enu")==="neu")for(let h=0,f=s.length;h<f;h+=3){const d=s[h],g=s[h+1];s[h]=g,s[h+1]=d}const u=s.length;if(u==2&&s.push(0),u!==0)return s}readFlatPosList(e,t){const r=Sn(e,!1).replace(/^\s*|\s*$/g,""),i=t[0],s=i.srsName,o=i.srsDimension,a=s?K(s).getAxisOrientation():"enu",l=r.split(/\s+/);let c=2;e.getAttribute("srsDimension")?c=xt(e.getAttribute("srsDimension")):e.getAttribute("dimension")?c=xt(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?c=xt(e.parentNode.getAttribute("srsDimension")):o&&(c=xt(o));const u=a.startsWith("en");let h,f,d;const g=[];for(let p=0,m=l.length;p<m;p+=c)h=parseFloat(l[p]),f=parseFloat(l[p+1]),d=c===3?parseFloat(l[p+2]):0,u?g.push(h,f,d):g.push(f,h,d);return g}writePos_(e,t,r){const i=r[r.length-1],s=i.hasZ,o=s?"3":"2";e.setAttribute("srsDimension",o);const a=i.srsName,l=a?K(a).getAxisOrientation():"enu",c=t.getCoordinates();let u=l.startsWith("en")?c[0]+" "+c[1]:c[1]+" "+c[0];if(s){const h=c[2]||0;u+=" "+h}X(e,u)}getCoords_(e,t,r){let s=(t?K(t).getAxisOrientation():"enu").startsWith("en")?e[0]+" "+e[1]:e[1]+" "+e[0];if(r){const o=e[2]||0;s+=" "+o}return s}writePosList_(e,t,r){const i=r[r.length-1],s=i.hasZ,o=s?"3":"2";e.setAttribute("srsDimension",o);const a=i.srsName,l=t.getCoordinates(),c=l.length,u=new Array(c);let h;for(let f=0;f<c;++f)h=l[f],u[f]=this.getCoords_(h,a,s);X(e,u.join(" "))}writePoint(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=G(e.namespaceURI,"pos");e.appendChild(o),this.writePos_(o,t,r)}writeEnvelope(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];oe({node:e},this.ENVELOPE_SERIALIZERS,ur,a,r,o,this)}writeLinearRing(e,t,r){const s=r[r.length-1].srsName;s&&e.setAttribute("srsName",s);const o=G(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,r)}RING_NODE_FACTORY_(e,t,r){const i=t[t.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),G(s.namespaceURI,o!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();oe({node:e,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,r,void 0,this)}else if(e.nodeName==="Surface"){const a=G(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,r)}}writeCurveOrLineString(e,t,r){const s=r[r.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=G(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,r)}else if(e.nodeName==="Curve"){const o=G(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,r)}}writeMultiSurfaceOrPolygon(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&e.setAttribute("srsName",o);const l=t.getPolygons();oe({node:e,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,r,void 0,this)}writeMultiPoint(e,t,r){const i=r[r.length-1],s=i.srsName,o=i.hasZ;s&&e.setAttribute("srsName",s);const a=t.getPoints();oe({node:e,hasZ:o,srsName:s},this.POINTMEMBER_SERIALIZERS,Ne("pointMember"),a,r,void 0,this)}writeMultiCurveOrLineString(e,t,r){const i=r[r.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&e.setAttribute("srsName",o);const l=t.getLineStrings();oe({node:e,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,r,void 0,this)}writeRing(e,t,r){const i=G(e.namespaceURI,"LinearRing");e.appendChild(i),this.writeLinearRing(i,t,r)}writeSurfaceOrPolygonMember(e,t,r){const i=this.GEOMETRY_NODE_FACTORY_(t,r);i&&(e.appendChild(i),this.writeSurfaceOrPolygon(i,t,r))}writePointMember(e,t,r){const i=G(e.namespaceURI,"Point");e.appendChild(i),this.writePoint(i,t,r)}writeLineStringOrCurveMember(e,t,r){const i=this.GEOMETRY_NODE_FACTORY_(t,r);i&&(e.appendChild(i),this.writeCurveOrLineString(i,t,r))}writeSurfacePatches_(e,t,r){const i=G(e.namespaceURI,"PolygonPatch");e.appendChild(i),this.writeSurfaceOrPolygon(i,t,r)}writeCurveSegments_(e,t,r){const i=G(e.namespaceURI,"LineStringSegment");e.appendChild(i),this.writeCurveOrLineString(i,t,r)}writeGeometryElement(e,t,r){const i=r[r.length-1],s=Object.assign({},i);s.node=e;let o;Array.isArray(t)?o=cs(t,i):o=Se(t,!0,i),oe(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],r,void 0,this)}writeFeatureElement(e,t,r){const i=t.getId();i&&e.setAttribute("fid",i);const s=r[r.length-1],o=s.featureNS,a=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const l=[],c=[];if(t.hasProperties()){const h=t.getProperties();for(const f in h){const d=h[f];d!=null&&(l.push(f),c.push(d),f==a||typeof d.getSimplifiedGeometry=="function"?f in s.serializers[o]||(s.serializers[o][f]=E(this.writeGeometryElement,this)):f in s.serializers[o]||(s.serializers[o][f]=E(X)))}}const u=Object.assign({},s);u.node=e,oe(u,s.serializers,Ne(void 0,o),c,r,l)}writeFeatureMembers_(e,t,r){const i=r[r.length-1],s=i.featureType,o=i.featureNS,a={};a[o]={},a[o][s]=E(this.writeFeatureElement,this);const l=Object.assign({},i);l.node=e,oe(l,a,Ne(s,o),t,r)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,r){const i=t[t.length-1].node;return G(this.namespace,ff[i.nodeName])}GEOMETRY_NODE_FACTORY_(e,t,r){const i=t[t.length-1],s=i.multiSurface,o=i.surface,a=i.curve,l=i.multiCurve;return Array.isArray(e)?r="Envelope":(r=e.getType(),r==="MultiPolygon"&&s===!0?r="MultiSurface":r==="Polygon"&&o===!0?r="Surface":r==="LineString"&&a===!0?r="Curve":r==="MultiLineString"&&l===!0&&(r="MultiCurve")),G(this.namespace,r)}writeGeometryNode(e,t){t=this.adaptOptions(t);const r=G(this.namespace,"geom"),i={node:r,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return t&&Object.assign(i,t),this.writeGeometryElement(r,e,[i]),r}writeFeaturesNode(e,t){t=this.adaptOptions(t);const r=G(this.namespace,"featureMembers");r.setAttributeNS(Dr,"xsi:schemaLocation",this.schemaLocation);const i={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return t&&Object.assign(i,t),this.writeFeatureMembers_(r,e,[i]),r}}v.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:D(v.prototype.readFlatPos),posList:D(v.prototype.readFlatPosList),coordinates:D(V.prototype.readFlatCoordinates)}};v.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:v.prototype.interiorParser,exterior:v.prototype.exteriorParser}};v.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:D(O.prototype.readPoint),MultiPoint:D(O.prototype.readMultiPoint),LineString:D(O.prototype.readLineString),MultiLineString:D(O.prototype.readMultiLineString),LinearRing:D(O.prototype.readLinearRing),Polygon:D(O.prototype.readPolygon),MultiPolygon:D(O.prototype.readMultiPolygon),Surface:D(v.prototype.readSurface),MultiSurface:D(v.prototype.readMultiSurface),Curve:D(v.prototype.readCurve),MultiCurve:D(v.prototype.readMultiCurve),Envelope:D(v.prototype.readEnvelope)}};v.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:N(v.prototype.curveMemberParser),curveMembers:N(v.prototype.curveMemberParser)}};v.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:N(v.prototype.surfaceMemberParser),surfaceMembers:N(v.prototype.surfaceMemberParser)}};v.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:N(O.prototype.readLineString),Curve:N(v.prototype.readCurve)}};v.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:N(O.prototype.readPolygon),Surface:N(v.prototype.readSurface)}};v.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:D(v.prototype.readPatch)}};v.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:D(v.prototype.readSegment)}};v.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:N(v.prototype.readFlatPosList),upperCorner:N(v.prototype.readFlatPosList)}};v.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:D(v.prototype.readPolygonPatch)}};v.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:ja(v.prototype.readLineStringSegment)}};O.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:D(O.prototype.readFlatLinearRing),Ring:D(v.prototype.readFlatCurveRing)}};v.prototype.writeFeatures;v.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:E(v.prototype.writeRing),interior:E(v.prototype.writeRing)}};v.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:E(X),upperCorner:E(X)}};v.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:E(v.prototype.writeSurfaceOrPolygonMember),polygonMember:E(v.prototype.writeSurfaceOrPolygonMember)}};v.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:E(v.prototype.writePointMember)}};v.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:E(v.prototype.writeLineStringOrCurveMember),curveMember:E(v.prototype.writeLineStringOrCurveMember)}};v.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:E(v.prototype.writeCurveOrLineString),MultiCurve:E(v.prototype.writeMultiCurveOrLineString),Point:E(v.prototype.writePoint),MultiPoint:E(v.prototype.writeMultiPoint),LineString:E(v.prototype.writeCurveOrLineString),MultiLineString:E(v.prototype.writeMultiCurveOrLineString),LinearRing:E(v.prototype.writeLinearRing),Polygon:E(v.prototype.writeSurfaceOrPolygon),MultiPolygon:E(v.prototype.writeMultiSurfaceOrPolygon),Surface:E(v.prototype.writeSurfaceOrPolygon),MultiSurface:E(v.prototype.writeMultiSurfaceOrPolygon),Envelope:E(v.prototype.writeEnvelope)}};const xs=v;xs.prototype.writeFeatures;xs.prototype.writeFeaturesNode;const ce=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],df="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",gf={rte:wl,trk:Tl,wpt:Sl},pf=F(ce,{rte:N(wl),trk:N(Tl),wpt:N(Sl)}),mf=F(ce,{text:b(P,"linkText"),type:b(P,"linkType")}),_f=F(ce,{name:b(P),email:jf,link:Qr}),yf=F(ce,{name:b(P),desc:b(P),author:b(kf),copyright:b($f),link:Qr,time:b(Wn),keywords:b(P),bounds:Vf,extensions:ti}),xf=F(ce,{year:b(fe),license:b(P)}),bf=F(ce,{rte:E(Zf),trk:E(Yf),wpt:E(Kf)});class Ef extends Hn{constructor(e){super(),e=e||{},this.dataProjection=K("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let t=0,r=e.length;t<r;++t){const i=e[t];if(this.readExtensions_){const s=i.get("extensionsNode_")||null;this.readExtensions_(i,s)}i.set("extensionsNode_",void 0)}}readMetadata(e){return e?typeof e=="string"?this.readMetadataFromDocument(Rn(e)):vn(e)?this.readMetadataFromDocument(e):this.readMetadataFromNode(e):null}readMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType===Node.ELEMENT_NODE){const r=this.readMetadataFromNode(t);if(r)return r}return null}readMetadataFromNode(e){if(!ce.includes(e.namespaceURI))return null;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(ce.includes(t.namespaceURI)&&t.localName==="metadata")return A({},yf,t,[]);return null}readFeatureFromNode(e,t){if(!ce.includes(e.namespaceURI))return null;const r=gf[e.localName];if(!r)return null;const i=r(e,[this.getReadOptions(e,t)]);return i?(this.handleReadExtensions_([i]),i):null}readFeaturesFromNode(e,t){if(!ce.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const r=A([],pf,e,[this.getReadOptions(e,t)]);return r?(this.handleReadExtensions_(r),r):[]}return[]}writeFeaturesNode(e,t){t=this.adaptOptions(t);const r=G("http://www.topografix.com/GPX/1/1","gpx");return r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",Dr),r.setAttributeNS(Dr,"xsi:schemaLocation",df),r.setAttribute("version","1.1"),r.setAttribute("creator","OpenLayers"),oe({node:r},bf,zf,e,[t]),r}}const wf=F(ce,{name:b(P),cmt:b(P),desc:b(P),src:b(P),link:Qr,number:b(fe),extensions:ti,type:b(P),rtept:Xf}),Tf=F(ce,{ele:b(Te),time:b(Wn)}),Sf=F(ce,{name:b(P),cmt:b(P),desc:b(P),src:b(P),link:Qr,number:b(fe),type:b(P),extensions:ti,trkseg:Wf}),Rf=F(ce,{trkpt:Hf}),vf=F(ce,{ele:b(Te),time:b(Wn)}),Pf=F(ce,{ele:b(Te),time:b(Wn),magvar:b(Te),geoidheight:b(Te),name:b(P),cmt:b(P),desc:b(P),src:b(P),link:Qr,sym:b(P),type:b(P),fix:b(P),sat:b(fe),hdop:b(Te),vdop:b(Te),pdop:b(Te),ageofdgpsdata:b(Te),dgpsid:b(fe),extensions:ti}),Lf=["text","type"],Af=F(ce,{text:E(X),type:E(X)}),If=F(ce,["name","cmt","desc","src","link","number","type","rtept"]),Cf=F(ce,{name:E(X),cmt:E(X),desc:E(X),src:E(X),link:E(ws),number:E(Pn),type:E(X),rtept:Xa(E(Ts))}),Ff=F(ce,["ele","time"]),Of=F(ce,["name","cmt","desc","src","link","number","type","trkseg"]),Mf=F(ce,{name:E(X),cmt:E(X),desc:E(X),src:E(X),link:E(ws),number:E(Pn),type:E(X),trkseg:Xa(E(qf))}),Nf=Ne("trkpt"),Df=F(ce,{trkpt:E(Ts)}),Uf=F(ce,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),Bf=F(ce,{ele:E(Ft),time:E(ou),magvar:E(Ft),geoidheight:E(Ft),name:E(X),cmt:E(X),desc:E(X),src:E(X),link:E(ws),sym:E(X),type:E(X),fix:E(X),sat:E(Pn),hdop:E(Ft),vdop:E(Ft),pdop:E(Ft),ageofdgpsdata:E(Ft),dgpsid:E(Pn)}),Gf={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function zf(n,e,t){const r=n.getGeometry();if(r){const i=Gf[r.getType()];if(i){const s=e[e.length-1].node;return G(s.namespaceURI,i)}}}function bs(n,e,t,r){return n.push(parseFloat(t.getAttribute("lon")),parseFloat(t.getAttribute("lat"))),"ele"in r?(n.push(r.ele),delete r.ele,e.hasZ=!0):n.push(0),"time"in r?(n.push(r.time),delete r.time,e.hasM=!0):n.push(0),n}function Es(n,e,t){let r="XY",i=2;if(n.hasZ&&n.hasM?(r="XYZM",i=4):n.hasZ?(r="XYZ",i=3):n.hasM&&(r="XYM",i=3),i!==4){for(let s=0,o=e.length/4;s<o;s++)e[s*i]=e[s*4],e[s*i+1]=e[s*4+1],n.hasZ&&(e[s*i+2]=e[s*4+2]),n.hasM&&(e[s*i+2]=e[s*4+3]);if(e.length=e.length/4*i,t)for(let s=0,o=t.length;s<o;s++)t[s]=t[s]/4*i}return r}function kf(n,e){const t=A({},_f,n,e);if(t)return t}function $f(n,e){const t=A({},xf,n,e);if(t){const r=n.getAttribute("author");return r!==null&&(t.author=r),t}}function Vf(n,e){const t=e[e.length-1],r=n.getAttribute("minlat"),i=n.getAttribute("minlon"),s=n.getAttribute("maxlat"),o=n.getAttribute("maxlon");i!==null&&r!==null&&o!==null&&s!==null&&(t.bounds=[[parseFloat(i),parseFloat(r)],[parseFloat(o),parseFloat(s)]])}function jf(n,e){const t=e[e.length-1],r=n.getAttribute("id"),i=n.getAttribute("domain");r!==null&&i!==null&&(t.email=`${r}@${i}`)}function Qr(n,e){const t=e[e.length-1],r=n.getAttribute("href");r!==null&&(t.link=r),wt(mf,n,e)}function ti(n,e){const t=e[e.length-1];t.extensionsNode_=n}function Xf(n,e){const t=A({},Tf,n,e);if(t){const r=e[e.length-1],i=r.flatCoordinates,s=r.layoutOptions;bs(i,s,n,t)}}function Hf(n,e){const t=A({},vf,n,e);if(t){const r=e[e.length-1],i=r.flatCoordinates,s=r.layoutOptions;bs(i,s,n,t)}}function Wf(n,e){const t=e[e.length-1];wt(Rf,n,e);const r=t.flatCoordinates;t.ends.push(r.length)}function wl(n,e){const t=e[0],r=A({flatCoordinates:[],layoutOptions:{}},wf,n,e);if(!r)return;const i=r.flatCoordinates;delete r.flatCoordinates;const s=r.layoutOptions;delete r.layoutOptions;const o=Es(s,i),a=new ft(i,o);Se(a,!1,t);const l=new Ye(a);return l.setProperties(r,!0),l}function Tl(n,e){const t=e[0],r=A({flatCoordinates:[],ends:[],layoutOptions:{}},Sf,n,e);if(!r)return;const i=r.flatCoordinates;delete r.flatCoordinates;const s=r.ends;delete r.ends;const o=r.layoutOptions;delete r.layoutOptions;const a=Es(o,i,s),l=new Kr(i,a,s);Se(l,!1,t);const c=new Ye(l);return c.setProperties(r,!0),c}function Sl(n,e){const t=e[0],r=A({},Pf,n,e);if(!r)return;const i={},s=bs([],i,n,r),o=Es(i,s),a=new it(s,o);Se(a,!1,t);const l=new Ye(a);return l.setProperties(r,!0),l}function ws(n,e,t){n.setAttribute("href",e);const i=t[t.length-1].properties,s=[i.linkText,i.linkType];oe({node:n},Af,ur,s,t,Lf)}function Ts(n,e,t){const r=t[t.length-1],s=r.node.namespaceURI,o=r.properties;switch(n.setAttributeNS(null,"lat",String(e[1])),n.setAttributeNS(null,"lon",String(e[0])),r.geometryLayout){case"XYZM":e[3]!==0&&(o.time=e[3]);case"XYZ":e[2]!==0&&(o.ele=e[2]);break;case"XYM":e[2]!==0&&(o.time=e[2]);break}const l=n.nodeName=="rtept"?Ff[s]:Uf[s],c=Ji(o,l);oe({node:n,properties:o},Bf,ur,c,t,l)}function Zf(n,e,t){const r=t[0],i=e.getProperties(),s={node:n};s.properties=i;const o=e.getGeometry();if(o.getType()=="LineString"){const u=Se(o,!0,r);s.geometryLayout=u.getLayout(),i.rtept=u.getCoordinates()}const a=t[t.length-1].node,l=If[a.namespaceURI],c=Ji(i,l);oe(s,Cf,ur,c,t,l)}function Yf(n,e,t){const r=t[0],i=e.getProperties(),s={node:n};s.properties=i;const o=e.getGeometry();if(o.getType()=="MultiLineString"){const u=Se(o,!0,r);i.trkseg=u.getLineStrings()}const a=t[t.length-1].node,l=Of[a.namespaceURI],c=Ji(i,l);oe(s,Mf,ur,c,t,l)}function qf(n,e,t){const r={node:n};r.geometryLayout=e.getLayout(),r.properties={},oe(r,Df,Nf,e.getCoordinates(),t)}function Kf(n,e,t){const r=t[0],i=t[t.length-1];i.properties=e.getProperties();const s=e.getGeometry();if(s.getType()=="Point"){const o=Se(s,!0,r);i.geometryLayout=o.getLayout(),Ts(n,o.getCoordinates(),t)}}const Jf=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,Qf=/^H.([A-Z]{3}).*?:(.*)/,ed=/^HFDTE(\d{2})(\d{2})(\d{2})/,td=/^HFDTEDATE:(\d{2})(\d{2})(\d{2}),(\d{2})/,rd=/\r\n|\r|\n/;class nd extends fl{constructor(e){super(),e=e||{},this.dataProjection=K("EPSG:4326"),this.altitudeMode_=e.altitudeMode?e.altitudeMode:"none",this.lad_=!1,this.lod_=!1,this.ladStart_=0,this.ladStop_=0,this.lodStart_=0,this.lodStop_=0}readFeatureFromText(e,t){const r=this.altitudeMode_,i=e.split(rd),s={},o=[];let a=2e3,l=0,c=1,u=-1,h,f;for(h=0,f=i.length;h<f;++h){const m=i[h];let y;if(m.charAt(0)=="B"){if(y=Jf.exec(m),y){const _=parseInt(y[1],10),x=parseInt(y[2],10),w=parseInt(y[3],10);let S=parseInt(y[4],10)+parseInt(y[5],10)/6e4;this.lad_&&(S+=parseInt(m.slice(this.ladStart_,this.ladStop_),10)/6e4/10**(this.ladStop_-this.ladStart_)),y[6]=="S"&&(S=-S);let T=parseInt(y[7],10)+parseInt(y[8],10)/6e4;if(this.lod_&&(T+=parseInt(m.slice(this.lodStart_,this.lodStop_),10)/6e4/10**(this.lodStop_-this.lodStart_)),y[9]=="W"&&(T=-T),o.push(T,S),r!="none"){let L;r=="gps"?L=parseInt(y[11],10):r=="barometric"?L=parseInt(y[12],10):L=0,o.push(L)}let R=Date.UTC(a,l,c,_,x,w);R<u&&(R=Date.UTC(a,l,c+1,_,x,w)),o.push(R/1e3),u=R}}else if(m.charAt(0)=="H")y=td.exec(m),y?(c=parseInt(y[1],10),l=parseInt(y[2],10)-1,a=2e3+parseInt(y[3],10)):(y=ed.exec(m),y?(c=parseInt(y[1],10),l=parseInt(y[2],10)-1,a=2e3+parseInt(y[3],10)):(y=Qf.exec(m),y&&(s[y[1]]=y[2].trim())));else if(m.charAt(0)=="I"){const _=parseInt(m.slice(1,3),10);for(let x=0;x<_;x++){const w=m.slice(7+x*7,10+x*7);if(w==="LAD"||w==="LOD"){const S=parseInt(m.slice(3+x*7,5+x*7),10)-1,T=parseInt(m.slice(5+x*7,7+x*7),10);w==="LAD"?(this.lad_=!0,this.ladStart_=S,this.ladStop_=T):w==="LOD"&&(this.lod_=!0,this.lodStart_=S,this.lodStop_=T)}}}}if(o.length===0)return null;const d=r=="none"?"XYM":"XYZM",g=new ft(o,d),p=new Ye(Se(g,!1,t));return p.setProperties(s,!0),p}readFeaturesFromText(e,t){const r=this.readFeatureFromText(e,t);return r?[r]:[]}}const pe={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},$t={};$t[pe.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}};$t[pe.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}};$t[pe.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}};$t.none={none:{supports:[],formats:[],qualities:[]}};const id=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,No=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,sd=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function od(n){let e=n.getComplianceLevelSupportedFeatures();return e===void 0&&(e=$t[pe.VERSION1].level0),{url:n.imageInfo["@id"]===void 0?void 0:n.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:e.supports,formats:[...e.formats,n.imageInfo.formats===void 0?[]:n.imageInfo.formats],qualities:[...e.qualities,n.imageInfo.qualities===void 0?[]:n.imageInfo.qualities],resolutions:n.imageInfo.scale_factors,tileSize:n.imageInfo.tile_width!==void 0?n.imageInfo.tile_height!==void 0?[n.imageInfo.tile_width,n.imageInfo.tile_height]:[n.imageInfo.tile_width,n.imageInfo.tile_width]:n.imageInfo.tile_height!=null?[n.imageInfo.tile_height,n.imageInfo.tile_height]:void 0}}function ad(n){const e=n.getComplianceLevelSupportedFeatures(),t=Array.isArray(n.imageInfo.profile)&&n.imageInfo.profile.length>1,r=t&&n.imageInfo.profile[1].supports?n.imageInfo.profile[1].supports:[],i=t&&n.imageInfo.profile[1].formats?n.imageInfo.profile[1].formats:[],s=t&&n.imageInfo.profile[1].qualities?n.imageInfo.profile[1].qualities:[];return{url:n.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:n.imageInfo.sizes===void 0?void 0:n.imageInfo.sizes.map(function(o){return[o.width,o.height]}),tileSize:n.imageInfo.tiles===void 0?void 0:[n.imageInfo.tiles.map(function(o){return o.width})[0],n.imageInfo.tiles.map(function(o){return o.height===void 0?o.width:o.height})[0]],resolutions:n.imageInfo.tiles===void 0?void 0:n.imageInfo.tiles.map(function(o){return o.scaleFactors})[0],supports:[...e.supports,...r],formats:[...e.formats,...i],qualities:[...e.qualities,...s]}}function ld(n){const e=n.getComplianceLevelSupportedFeatures(),t=n.imageInfo.extraFormats===void 0?e.formats:[...e.formats,...n.imageInfo.extraFormats],r=n.imageInfo.preferredFormats!==void 0&&Array.isArray(n.imageInfo.preferredFormats)&&n.imageInfo.preferredFormats.length>0?n.imageInfo.preferredFormats.filter(function(i){return["jpg","png","gif"].includes(i)}).reduce(function(i,s){return i===void 0&&t.includes(s)?s:i},void 0):void 0;return{url:n.imageInfo.id,sizes:n.imageInfo.sizes===void 0?void 0:n.imageInfo.sizes.map(function(i){return[i.width,i.height]}),tileSize:n.imageInfo.tiles===void 0?void 0:[n.imageInfo.tiles.map(function(i){return i.width})[0],n.imageInfo.tiles.map(function(i){return i.height})[0]],resolutions:n.imageInfo.tiles===void 0?void 0:n.imageInfo.tiles.map(function(i){return i.scaleFactors})[0],supports:n.imageInfo.extraFeatures===void 0?e.supports:[...e.supports,...n.imageInfo.extraFeatures],formats:t,qualities:n.imageInfo.extraQualities===void 0?e.qualities:[...e.qualities,...n.imageInfo.extraQualities],preferredFormat:r}}const ri={};ri[pe.VERSION1]=od;ri[pe.VERSION2]=ad;ri[pe.VERSION3]=ld;class cd{constructor(e){this.setImageInfo(e)}setImageInfo(e){typeof e=="string"?this.imageInfo=JSON.parse(e):this.imageInfo=e}getImageApiVersion(){if(this.imageInfo===void 0)return;let e=this.imageInfo["@context"]||"ol-no-context";typeof e=="string"&&(e=[e]);for(let t=0;t<e.length;t++)switch(e[t]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return pe.VERSION1;case"http://iiif.io/api/image/2/context.json":return pe.VERSION2;case"http://iiif.io/api/image/3/context.json":return pe.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(pe.VERSION1)&&this.imageInfo.identifier)return pe.VERSION1;break}qe(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(e){if(!(this.imageInfo===void 0||this.imageInfo.profile===void 0))switch(e===void 0&&(e=this.getImageApiVersion()),e){case pe.VERSION1:if(id.test(this.imageInfo.profile))return this.imageInfo.profile;break;case pe.VERSION3:if(sd.test(this.imageInfo.profile))return this.imageInfo.profile;break;case pe.VERSION2:if(typeof this.imageInfo.profile=="string"&&No.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&No.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break}}getComplianceLevelFromProfile(e){const t=this.getComplianceLevelEntryFromProfile(e);if(t===void 0)return;const r=t.match(/level[0-2](?:\.json)?$/g);return Array.isArray(r)?r[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;const e=this.getImageApiVersion(),t=this.getComplianceLevelFromProfile(e);return t===void 0?$t.none.none:$t[e][t]}getTileSourceOptions(e){const t=e||{},r=this.getImageApiVersion();if(r===void 0)return;const i=r===void 0?void 0:ri[r](this);if(i!==void 0)return{url:i.url,version:r,size:[this.imageInfo.width,this.imageInfo.height],sizes:i.sizes,format:t.format!==void 0&&i.formats.includes(t.format)?t.format:i.preferredFormat!==void 0?i.preferredFormat:"jpg",supports:i.supports,quality:t.quality&&i.qualities.includes(t.quality)?t.quality:i.qualities.includes("native")?"native":"default",resolutions:Array.isArray(i.resolutions)?i.resolutions.sort(function(s,o){return o-s}):void 0,tileSize:i.tileSize}}}class Ss{read(e){if(!e)return null;if(typeof e=="string"){const t=Rn(e);return this.readFromDocument(t)}return vn(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){ps()}}const ud="http://www.w3.org/1999/xlink";function gr(n){return n.getAttributeNS(ud,"href")}const Ce=[null,"http://www.opengis.net/ows/1.1"],hd=F(Ce,{ServiceIdentification:b(Nd),ServiceProvider:b(Ud),OperationsMetadata:b(Od)});class Rl extends Ss{constructor(){super()}readFromNode(e){const t=A({},hd,e,[]);return t||null}}const fd=F(Ce,{DeliveryPoint:b(P),City:b(P),AdministrativeArea:b(P),PostalCode:b(P),Country:b(P),ElectronicMailAddress:b(P)}),dd=F(Ce,{Value:ee(Bd)}),gd=F(Ce,{AllowedValues:b(vd)}),pd=F(Ce,{Phone:b(Md),Address:b(Rd)}),md=F(Ce,{HTTP:b(Cd)}),_d=F(Ce,{Get:ee(Id),Post:void 0}),yd=F(Ce,{DCP:b(Ad)}),xd=F(Ce,{Operation:Fd}),bd=F(Ce,{Voice:b(P),Facsimile:b(P)}),Ed=F(Ce,{Constraint:ee(Pd)}),wd=F(Ce,{IndividualName:b(P),PositionName:b(P),ContactInfo:b(Ld)}),Td=F(Ce,{Abstract:b(P),AccessConstraints:b(P),Fees:b(P),Title:b(P),ServiceTypeVersion:b(P),ServiceType:b(P)}),Sd=F(Ce,{ProviderName:b(P),ProviderSite:b(gr),ServiceContact:b(Dd)});function Rd(n,e){return A({},fd,n,e)}function vd(n,e){return A({},dd,n,e)}function Pd(n,e){const t=n.getAttribute("name");if(t)return A({name:t},gd,n,e)}function Ld(n,e){return A({},pd,n,e)}function Ad(n,e){return A({},md,n,e)}function Id(n,e){const t=gr(n);if(t)return A({href:t},Ed,n,e)}function Cd(n,e){return A({},_d,n,e)}function Fd(n,e){const t=n.getAttribute("name"),r=A({},yd,n,e);if(!r)return;const i=e[e.length-1];i[t]=r}function Od(n,e){return A({},xd,n,e)}function Md(n,e){return A({},bd,n,e)}function Nd(n,e){return A({},Td,n,e)}function Dd(n,e){return A({},wd,n,e)}function Ud(n,e){return A({},Sd,n,e)}function Bd(n,e){return P(n)}function Do(n,e,t,r,i,s){i!==void 0?(i=i,s=s!==void 0?s:0):(i=[],s=0);let o=e;for(;o<t;){const a=n[o++];i[s++]=n[o++],i[s++]=a;for(let l=2;l<r;++l)i[s++]=n[o++]}return i.length=s,i}class Gd extends fl{constructor(e){super(),e=e||{},this.dataProjection=K("EPSG:4326"),this.factor_=e.factor?e.factor:1e5,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY"}readFeatureFromText(e,t){const r=this.readGeometryFromText(e,t);return new Ye(r)}readFeaturesFromText(e,t){return[this.readFeatureFromText(e,t)]}readGeometryFromText(e,t){const r=ju(this.geometryLayout_),i=kd(e,r,this.factor_);Do(i,0,i.length,r,i);const s=Xu(i,0,i.length,r),o=new ft(s,this.geometryLayout_);return Se(o,!1,this.adaptOptions(t))}writeFeatureText(e,t){const r=e.getGeometry();if(r)return this.writeGeometryText(r,t);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(e,t){return this.writeFeatureText(e[0],t)}writeGeometryText(e,t){e=Se(e,!0,this.adaptOptions(t));const r=e.getFlatCoordinates(),i=e.getStride();return Do(r,0,r.length,i,r),zd(r,i,this.factor_)}}function zd(n,e,t){t=t||1e5;let r;const i=new Array(e);for(r=0;r<e;++r)i[r]=0;for(let s=0,o=n.length;s<o;)for(r=0;r<e;++r,++s){const a=n[s],l=a-i[r];i[r]=a,n[s]=l}return $d(n,t)}function kd(n,e,t){t=t||1e5;let r;const i=new Array(e);for(r=0;r<e;++r)i[r]=0;const s=Vd(n,t);for(let o=0,a=s.length;o<a;)for(r=0;r<e;++r,++o)i[r]+=s[o],s[o]=i[r];return s}function $d(n,e){e=e||1e5;for(let t=0,r=n.length;t<r;++t)n[t]=Math.round(n[t]*e);return jd(n)}function Vd(n,e){e=e||1e5;const t=Xd(n);for(let r=0,i=t.length;r<i;++r)t[r]/=e;return t}function jd(n){for(let e=0,t=n.length;e<t;++e){const r=n[e];n[e]=r<0?~(r<<1):r<<1}return Hd(n)}function Xd(n){const e=Wd(n);for(let t=0,r=e.length;t<r;++t){const i=e[t];e[t]=i&1?~(i>>1):i>>1}return e}function Hd(n){let e="";for(let t=0,r=n.length;t<r;++t)e+=Zd(n[t]);return e}function Wd(n){const e=[];let t=0,r=0;for(let i=0,s=n.length;i<s;++i){const o=n.charCodeAt(i)-63;t|=(o&31)<<r,o<32?(e.push(t),t=0,r=0):r+=5}return e}function Zd(n){let e,t="";for(;n>=32;)e=(32|n&31)+63,t+=String.fromCharCode(e),n>>=5;return e=n+63,t+=String.fromCharCode(e),t}class Z extends v{constructor(e){e=e||{},super(e),this.schemaLocation=e.schemaLocation?e.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(e,t,r){const i=r[r.length-1];r[r.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},i),super.writeGeometryElement(e,t,r)}}Z.prototype.namespace="http://www.opengis.net/gml/3.2";Z.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:D(v.prototype.readFlatPos),posList:D(v.prototype.readFlatPosList),coordinates:D(V.prototype.readFlatCoordinates)}};Z.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:v.prototype.interiorParser,exterior:v.prototype.exteriorParser}};Z.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:D(O.prototype.readPoint),MultiPoint:D(O.prototype.readMultiPoint),LineString:D(O.prototype.readLineString),MultiLineString:D(O.prototype.readMultiLineString),LinearRing:D(O.prototype.readLinearRing),Polygon:D(O.prototype.readPolygon),MultiPolygon:D(O.prototype.readMultiPolygon),Surface:D(Z.prototype.readSurface),MultiSurface:D(v.prototype.readMultiSurface),Curve:D(Z.prototype.readCurve),MultiCurve:D(v.prototype.readMultiCurve),Envelope:D(Z.prototype.readEnvelope)}};Z.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:N(v.prototype.curveMemberParser),curveMembers:N(v.prototype.curveMemberParser)}};Z.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:N(v.prototype.surfaceMemberParser),surfaceMembers:N(v.prototype.surfaceMemberParser)}};Z.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:N(O.prototype.readLineString),Curve:N(v.prototype.readCurve)}};Z.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:N(O.prototype.readPolygon),Surface:N(v.prototype.readSurface)}};Z.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:D(v.prototype.readPatch)}};Z.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:D(v.prototype.readSegment)}};Z.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:N(v.prototype.readFlatPosList),upperCorner:N(v.prototype.readFlatPosList)}};Z.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:D(v.prototype.readPolygonPatch)}};Z.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:ja(v.prototype.readLineStringSegment)}};Z.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:N(O.prototype.pointMemberParser),pointMembers:N(O.prototype.pointMemberParser)}};Z.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:N(O.prototype.lineStringMemberParser),lineStringMembers:N(O.prototype.lineStringMemberParser)}};Z.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:N(O.prototype.polygonMemberParser),polygonMembers:N(O.prototype.polygonMemberParser)}};Z.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:N(O.prototype.readFlatCoordinatesFromNode)}};Z.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:N(O.prototype.readLineString)}};Z.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:N(O.prototype.readPolygon)}};Z.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:D(O.prototype.readFlatLinearRing),Ring:D(Z.prototype.readFlatCurveRing)}};Z.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:E(v.prototype.writeRing),interior:E(v.prototype.writeRing)}};Z.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:E(X),upperCorner:E(X)}};Z.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:E(v.prototype.writeSurfaceOrPolygonMember),polygonMember:E(v.prototype.writeSurfaceOrPolygonMember)}};Z.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:E(v.prototype.writePointMember)}};Z.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:E(v.prototype.writeLineStringOrCurveMember),curveMember:E(v.prototype.writeLineStringOrCurveMember)}};Z.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:E(v.prototype.writeCurveOrLineString),MultiCurve:E(v.prototype.writeMultiCurveOrLineString),Point:E(Z.prototype.writePoint),MultiPoint:E(v.prototype.writeMultiPoint),LineString:E(v.prototype.writeCurveOrLineString),MultiLineString:E(v.prototype.writeMultiCurveOrLineString),LinearRing:E(v.prototype.writeLinearRing),Polygon:E(v.prototype.writeSurfaceOrPolygon),MultiPolygon:E(v.prototype.writeMultiSurfaceOrPolygon),Surface:E(v.prototype.writeSurfaceOrPolygon),MultiSurface:E(v.prototype.writeMultiSurfaceOrPolygon),Envelope:E(v.prototype.writeEnvelope)}};class vl{constructor(e){this.tagName_=e}getTagName(){return this.tagName_}}class Yd extends vl{constructor(e,t){super(e),this.conditions=t,qe(this.conditions.length>=2,"At least 2 conditions are required")}}class qd extends Yd{constructor(e){super("And",Array.prototype.slice.call(arguments))}}class Kd extends vl{constructor(e,t,r){if(super("BBOX"),this.geometryName=e,this.extent=t,t.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=r}}function Jd(n){const e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(qd,e))}function Qd(n,e,t){return new Kd(n,e,t)}const Uo={"http://www.opengis.net/gml":{boundedBy:b(O.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:N(O.prototype.readFeaturesInternal)}},eg={"http://www.opengis.net/wfs":{totalInserted:b(fe),totalUpdated:b(fe),totalDeleted:b(fe)},"http://www.opengis.net/wfs/2.0":{totalInserted:b(fe),totalUpdated:b(fe),totalDeleted:b(fe)}},tg={"http://www.opengis.net/wfs":{TransactionSummary:b(Go,"transactionSummary"),InsertResults:b(ko,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:b(Go,"transactionSummary"),InsertResults:b(ko,"insertIds")}},rg={"http://www.opengis.net/wfs":{PropertyName:E(X)},"http://www.opengis.net/wfs/2.0":{PropertyName:E(X)}},Pl={"http://www.opengis.net/wfs":{Insert:E($o),Update:E(jo),Delete:E(Vo),Property:E(Xo),Native:E(Ho)},"http://www.opengis.net/wfs/2.0":{Insert:E($o),Update:E(jo),Delete:E(Vo),Property:E(Xo),Native:E(Ho)}},Ll="feature",Rs="http://www.w3.org/2000/xmlns/",vs={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},Di={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},Ps={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},Bo={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},Ls={"2.0.0":Z,"1.1.0":v,"1.0.0":V},ng="1.1.0";class ig extends Hn{constructor(e){super(),e=e||{},this.version_=e.version?e.version:ng,this.featureType_=e.featureType,this.featureNS_=e.featureNS,this.gmlFormat_=e.gmlFormat?e.gmlFormat:new Ls[this.version_],this.schemaLocation_=e.schemaLocation?e.schemaLocation:Bo[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(e){this.featureType_=e}readFeaturesFromNode(e,t){const r={node:e};Object.assign(r,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(r,this.getReadOptions(e,t||{}));const i=[r];let s;this.version_==="2.0.0"?s=Uo:s=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let o=A([],s,e,i,this.gmlFormat_);return o||(o=[]),o}readTransactionResponse(e){if(e){if(typeof e=="string"){const t=Rn(e);return this.readTransactionResponseFromDocument(t)}return vn(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}}readFeatureCollectionMetadata(e){if(e){if(typeof e=="string"){const t=Rn(e);return this.readFeatureCollectionMetadataFromDocument(t)}return vn(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}}readFeatureCollectionMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)}readFeatureCollectionMetadataFromNode(e){const t={},r=xt(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=r,A(t,Uo,e,[],this.gmlFormat_)}readTransactionResponseFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)}readTransactionResponseFromNode(e){return A({},tg,e,[])}writeGetFeature(e){const t=G(Di[this.version_],"GetFeature");t.setAttribute("service","WFS"),t.setAttribute("version",this.version_),e.handle&&t.setAttribute("handle",e.handle),e.outputFormat&&t.setAttribute("outputFormat",e.outputFormat),e.maxFeatures!==void 0&&t.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&t.setAttribute("resultType",e.resultType),e.startIndex!==void 0&&t.setAttribute("startIndex",String(e.startIndex)),e.count!==void 0&&t.setAttribute("count",String(e.count)),e.viewParams!==void 0&&t.setAttribute("viewParams",e.viewParams),t.setAttributeNS(Dr,"xsi:schemaLocation",this.schemaLocation_);const r={node:t};if(Object.assign(r,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),qe(Array.isArray(e.featureTypes),"`options.featureTypes` must be an Array"),typeof e.featureTypes[0]=="string"){let i=e.filter;e.bbox&&(qe(e.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),i=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,i)),Object.assign(r,{geometryName:e.geometryName,filter:i}),ra(t,e.featureTypes,[r])}else e.featureTypes.forEach(i=>{const s=this.combineBboxAndFilter(i.geometryName,i.bbox,e.srsName,e.filter);Object.assign(r,{geometryName:i.geometryName,filter:s}),ra(t,[i.name],[r])});return t}combineBboxAndFilter(e,t,r,i){const s=Qd(e,t,r);return i?Jd(i,s):s}writeTransaction(e,t,r,i){const s=[],o=i.version?i.version:this.version_,a=G(Di[o],"Transaction");a.setAttribute("service","WFS"),a.setAttribute("version",o);let l;i&&(l=i.gmlOptions?i.gmlOptions:{},i.handle&&a.setAttribute("handle",i.handle)),a.setAttributeNS(Dr,"xsi:schemaLocation",Bo[o]);const c=sg(a,l,o,i);return e&&fn("Insert",e,s,c),t&&fn("Update",t,s,c),r&&fn("Delete",r,s,c),i.nativeElements&&fn("Native",i.nativeElements,s,c),a}readProjectionFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null}readProjectionFromNode(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild){e=e.firstElementChild.firstElementChild;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(!(t.childNodes.length===0||t.childNodes.length===1&&t.firstChild.nodeType===3)){const r=[{}];return this.gmlFormat_.readGeometryElement(t,r),K(r.pop().srsName)}}return null}}function sg(n,e,t,r){const i=r.featurePrefix?r.featurePrefix:Ll;let s;return t==="1.0.0"?s=2:t==="1.1.0"?s=3:t==="2.0.0"&&(s=3.2),Object.assign({node:n},{version:t,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:i,gmlVersion:s,hasZ:r.hasZ,srsName:r.srsName},e)}function fn(n,e,t,r){oe(r,Pl,Ne(n),e,t)}function Go(n,e){return A({},eg,n,e)}const og={"http://www.opengis.net/ogc":{FeatureId:N(function(n,e){return n.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:N(function(n,e){return n.getAttribute("fid")})}};function zo(n,e){wt(og,n,e)}const ag={"http://www.opengis.net/wfs":{Feature:zo},"http://www.opengis.net/wfs/2.0":{Feature:zo}};function ko(n,e){return A([],ag,n,e)}function $o(n,e,t){const r=t[t.length-1],i=r.featureType,s=r.featureNS,o=r.gmlVersion,a=G(s,i);n.appendChild(a),o===2?V.prototype.writeFeatureElement(a,e,t):o===3?v.prototype.writeFeatureElement(a,e,t):Z.prototype.writeFeatureElement(a,e,t)}function Al(n,e,t){const i=t[t.length-1].version,s=vs[i],o=G(s,"Filter"),a=G(s,"FeatureId");o.appendChild(a),a.setAttribute("fid",e),n.appendChild(o)}function As(n,e){n=n||Ll;const t=n+":";return e.startsWith(t)?e:t+e}function Vo(n,e,t){const r=t[t.length-1];qe(e.getId()!==void 0,"Features must have an id set");const i=r.featureType,s=r.featurePrefix,o=r.featureNS,a=As(s,i);n.setAttribute("typeName",a),n.setAttributeNS(Rs,"xmlns:"+s,o);const l=e.getId();l!==void 0&&Al(n,l,t)}function jo(n,e,t){const r=t[t.length-1];qe(e.getId()!==void 0,"Features must have an id set");const i=r.version,s=r.featureType,o=r.featurePrefix,a=r.featureNS,l=As(o,s),c=e.getGeometryName();n.setAttribute("typeName",l),n.setAttributeNS(Rs,"xmlns:"+o,a);const u=e.getId();if(u!==void 0){const h=e.getKeys(),f=[];for(let d=0,g=h.length;d<g;d++){const p=e.get(h[d]);if(p!==void 0){let m=h[d];p&&typeof p.getSimplifiedGeometry=="function"&&(m=c),f.push({name:m,value:p})}}oe({version:i,gmlVersion:r.gmlVersion,node:n,hasZ:r.hasZ,srsName:r.srsName},Pl,Ne("Property"),f,t),Al(n,u,t)}}function Xo(n,e,t){const r=t[t.length-1],i=r.version,s=Di[i],a=G(s,i==="2.0.0"?"ValueReference":"Name"),l=r.gmlVersion;if(n.appendChild(a),X(a,e.name),e.value!==void 0&&e.value!==null){const c=G(s,"Value");n.appendChild(c),e.value&&typeof e.value.getSimplifiedGeometry=="function"?l===2?V.prototype.writeGeometryElement(c,e.value,t):l===3?v.prototype.writeGeometryElement(c,e.value,t):Z.prototype.writeGeometryElement(c,e.value,t):X(c,e.value)}}function Ho(n,e,t){e.vendorId&&n.setAttribute("vendorId",e.vendorId),e.safeToIgnore!==void 0&&n.setAttribute("safeToIgnore",String(e.safeToIgnore)),e.value!==void 0&&X(n,e.value)}const ni={"http://www.opengis.net/wfs":{Query:E(Wo)},"http://www.opengis.net/wfs/2.0":{Query:E(Wo)},"http://www.opengis.net/ogc":{During:E(qo),And:E(dn),Or:E(dn),Not:E(Ko),BBOX:E(Zo),Contains:E(_t),Intersects:E(_t),Within:E(_t),DWithin:E(Yo),PropertyIsEqualTo:E(Be),PropertyIsNotEqualTo:E(Be),PropertyIsLessThan:E(Be),PropertyIsLessThanOrEqualTo:E(Be),PropertyIsGreaterThan:E(Be),PropertyIsGreaterThanOrEqualTo:E(Be),PropertyIsNull:E(Jo),PropertyIsBetween:E(Qo),PropertyIsLike:E(ea)},"http://www.opengis.net/fes/2.0":{During:E(qo),And:E(dn),Or:E(dn),Not:E(Ko),BBOX:E(Zo),Contains:E(_t),Disjoint:E(_t),Intersects:E(_t),ResourceId:E(cg),Within:E(_t),DWithin:E(Yo),PropertyIsEqualTo:E(Be),PropertyIsNotEqualTo:E(Be),PropertyIsLessThan:E(Be),PropertyIsLessThanOrEqualTo:E(Be),PropertyIsGreaterThan:E(Be),PropertyIsGreaterThanOrEqualTo:E(Be),PropertyIsNull:E(Jo),PropertyIsBetween:E(Qo),PropertyIsLike:E(ea)}};function Wo(n,e,t){const r=t[t.length-1],i=r.version,s=r.featurePrefix,o=r.featureNS,a=r.propertyNames,l=r.srsName;let c;s?c=As(s,e):c=e;let u;i==="2.0.0"?u="typeNames":u="typeName",n.setAttribute(u,c),l&&n.setAttribute("srsName",l),o&&n.setAttributeNS(Rs,"xmlns:"+s,o);const h=Object.assign({},r);h.node=n,oe(h,rg,Ne("PropertyName"),a,t);const f=r.filter;if(f){const d=G(ii(i),"Filter");n.appendChild(d),lg(d,f,t)}}function lg(n,e,t){const r=t[t.length-1],i={node:n};Object.assign(i,{context:r}),oe(i,ni,Ne(e.getTagName()),[e],t)}function Zo(n,e,t){const r=t[t.length-1],s=r.context.version;r.srsName=e.srsName;const o=Ls[s];pr(s,n,e.geometryName),o.prototype.writeGeometryElement(n,e.extent,t)}function cg(n,e,t){n.setAttribute("rid",e.rid)}function _t(n,e,t){const r=t[t.length-1],s=r.context.version;r.srsName=e.srsName;const o=Ls[s];pr(s,n,e.geometryName),o.prototype.writeGeometryElement(n,e.geometry,t)}function Yo(n,e,t){const s=t[t.length-1].context.version;_t(n,e,t);const o=G(ii(s),"Distance");X(o,e.distance.toString()),s==="2.0.0"?o.setAttribute("uom",e.unit):o.setAttribute("units",e.unit),n.appendChild(o)}function qo(n,e,t){const s=t[t.length-1].context.version;Mn(Ps[s],"ValueReference",n,e.propertyName);const o=G(ht,"TimePeriod");n.appendChild(o);const a=G(ht,"begin");o.appendChild(a),ta(a,e.begin);const l=G(ht,"end");o.appendChild(l),ta(l,e.end)}function dn(n,e,t){const i=t[t.length-1].context,s={node:n};Object.assign(s,{context:i});const o=e.conditions;for(let a=0,l=o.length;a<l;++a){const c=o[a];oe(s,ni,Ne(c.getTagName()),[c],t)}}function Ko(n,e,t){const i=t[t.length-1].context,s={node:n};Object.assign(s,{context:i});const o=e.condition;oe(s,ni,Ne(o.getTagName()),[o],t)}function Be(n,e,t){const s=t[t.length-1].context.version;e.matchCase!==void 0&&n.setAttribute("matchCase",e.matchCase.toString()),pr(s,n,e.propertyName),Nn(s,n,""+e.expression)}function Jo(n,e,t){const s=t[t.length-1].context.version;pr(s,n,e.propertyName)}function Qo(n,e,t){const s=t[t.length-1].context.version,o=ii(s);pr(s,n,e.propertyName);const a=G(o,"LowerBoundary");n.appendChild(a),Nn(s,a,""+e.lowerBoundary);const l=G(o,"UpperBoundary");n.appendChild(l),Nn(s,l,""+e.upperBoundary)}function ea(n,e,t){const s=t[t.length-1].context.version;n.setAttribute("wildCard",e.wildCard),n.setAttribute("singleChar",e.singleChar),n.setAttribute("escapeChar",e.escapeChar),e.matchCase!==void 0&&n.setAttribute("matchCase",e.matchCase.toString()),pr(s,n,e.propertyName),Nn(s,n,""+e.pattern)}function Mn(n,e,t,r){const i=G(n,e);X(i,r),t.appendChild(i)}function Nn(n,e,t){Mn(ii(n),"Literal",e,t)}function pr(n,e,t){n==="2.0.0"?Mn(Ps[n],"ValueReference",e,t):Mn(vs[n],"PropertyName",e,t)}function ta(n,e){const t=G(ht,"TimeInstant");n.appendChild(t);const r=G(ht,"timePosition");t.appendChild(r),X(r,e)}function ra(n,e,t){const r=t[t.length-1],i=Object.assign({},r);i.node=n,oe(i,ni,Ne("Query"),e,t)}function ii(n){let e;return n==="2.0.0"?e=Ps[n]:e=vs[n],e}const re={POINT:1,LINE_STRING:2,POLYGON:3,MULTI_POINT:4,MULTI_LINE_STRING:5,MULTI_POLYGON:6,GEOMETRY_COLLECTION:7,POLYHEDRAL_SURFACE:15,TIN:16,TRIANGLE:17};class na{constructor(e){this.view_=e,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(e){return this.view_.getUint32((this.pos_+=4)-4,e!==void 0?e:this.isLittleEndian_)}readDouble(e){return this.view_.getFloat64((this.pos_+=8)-8,e!==void 0?e:this.isLittleEndian_)}readPoint(){const e=[];return e.push(this.readDouble()),e.push(this.readDouble()),this.hasZ_&&e.push(this.readDouble()),this.hasM_&&e.push(this.readDouble()),e}readLineString(){const e=this.readUint32(),t=[];for(let r=0;r<e;r++)t.push(this.readPoint());return t}readPolygon(){const e=this.readUint32(),t=[];for(let r=0;r<e;r++)t.push(this.readLineString());return t}readWkbHeader(e){const r=this.readUint8()>0,i=this.readUint32(r),s=Math.floor((i&268435455)/1e3),o=!!(i&2147483648)||s===1||s===3,a=!!(i&1073741824)||s===2||s===3,l=!!(i&536870912),c=(i&268435455)%1e3,u=["XY",o?"Z":"",a?"M":""].join(""),h=l?this.readUint32(r):null;if(e!==void 0&&e!==c)throw new Error("Unexpected WKB geometry type "+c);if(this.initialized_){if(this.isLittleEndian_!==r)throw new Error("Inconsistent endian");if(this.layout_!==u)throw new Error("Inconsistent geometry layout");if(h&&this.srid_!==h)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=r,this.hasZ_=o,this.hasM_=a,this.layout_=u,this.srid_=h,this.initialized_=!0;return c}readWkbPayload(e){switch(e){case re.POINT:return this.readPoint();case re.LINE_STRING:return this.readLineString();case re.POLYGON:case re.TRIANGLE:return this.readPolygon();case re.MULTI_POINT:return this.readMultiPoint();case re.MULTI_LINE_STRING:return this.readMultiLineString();case re.MULTI_POLYGON:case re.POLYHEDRAL_SURFACE:case re.TIN:return this.readMultiPolygon();case re.GEOMETRY_COLLECTION:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+e+" is found")}}readWkbBlock(e){return this.readWkbPayload(this.readWkbHeader(e))}readWkbCollection(e,t){const r=this.readUint32(),i=[];for(let s=0;s<r;s++){const o=e.call(this,t);o&&i.push(o)}return i}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,re.POINT)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,re.LINE_STRING)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,re.POLYGON)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const e=this.readWkbHeader(),t=this.readWkbPayload(e);switch(e){case re.POINT:return new it(t,this.layout_);case re.LINE_STRING:return new ft(t,this.layout_);case re.POLYGON:case re.TRIANGLE:return new Qn(t,this.layout_);case re.MULTI_POINT:return new ls(t,this.layout_);case re.MULTI_LINE_STRING:return new Kr(t,this.layout_);case re.MULTI_POLYGON:case re.POLYHEDRAL_SURFACE:case re.TIN:return new Jn(t,this.layout_);case re.GEOMETRY_COLLECTION:return new kr(t);default:return null}}getSrid(){return this.srid_}}class ug{constructor(e){e=e||{},this.layout_=e.layout,this.isLittleEndian_=e.littleEndian!==!1,this.isEWKB_=e.ewkb!==!1,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},e.nodata)}writeUint8(e){this.writeQueue_.push([1,e])}writeUint32(e){this.writeQueue_.push([4,e])}writeDouble(e){this.writeQueue_.push([8,e])}writePoint(e,t){const r=Object.assign.apply(null,t.split("").map((i,s)=>({[i]:e[s]})));for(const i of this.layout_)this.writeDouble(i in r?r[i]:this.nodata_[i])}writeLineString(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writePoint(e[r],t)}writePolygon(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeLineString(e[r],t)}writeWkbHeader(e,t){e%=1e3,this.layout_.includes("Z")&&(e+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(e+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(t)&&(e|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(e),this.isEWKB_&&Number.isInteger(t)&&this.writeUint32(t)}writeMultiPoint(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeWkbHeader(1),this.writePoint(e[r],t)}writeMultiLineString(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeWkbHeader(2),this.writeLineString(e[r],t)}writeMultiPolygon(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeWkbHeader(3),this.writePolygon(e[r],t)}writeGeometryCollection(e){this.writeUint32(e.length);for(let t=0;t<e.length;t++)this.writeGeometry(e[t])}findMinimumLayout(e,t="XYZM"){const r=(i,s)=>i===s?i:i==="XYZM"?s:s==="XYZM"?i:"XY";if(e instanceof bo)return r(e.getLayout(),t);if(e instanceof kr){const i=e.getGeometriesArray();for(let s=0;s<i.length&&t!=="XY";s++)t=this.findMinimumLayout(i[s],t)}return t}writeGeometry(e,t){const r={Point:re.POINT,LineString:re.LINE_STRING,Polygon:re.POLYGON,MultiPoint:re.MULTI_POINT,MultiLineString:re.MULTI_LINE_STRING,MultiPolygon:re.MULTI_POLYGON,GeometryCollection:re.GEOMETRY_COLLECTION},i=e.getType(),s=r[i];if(!s)throw new Error("GeometryType "+i+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(e)),this.writeWkbHeader(s,t),e instanceof bo?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[i].call(this,e.getCoordinates(),e.getLayout()):e instanceof kr&&this.writeGeometryCollection(e.getGeometriesArray())}getBuffer(){const e=this.writeQueue_.reduce((s,o)=>s+o[0],0),t=new ArrayBuffer(e),r=new DataView(t);let i=0;return this.writeQueue_.forEach(s=>{switch(s[0]){case 1:r.setUint8(i,s[1]);break;case 4:r.setUint32(i,s[1],this.isLittleEndian_);break;case 8:r.setFloat64(i,s[1],this.isLittleEndian_);break}i+=s[0]}),t}}class hg extends Hu{constructor(e){super(),e=e||{},this.splitCollection=!!e.splitCollection,this.viewCache_=null,this.hex_=e.hex!==!1,this.littleEndian_=e.littleEndian!==!1,this.ewkb_=e.ewkb!==!1,this.layout_=e.geometryLayout,this.nodataZ_=e.nodataZ||0,this.nodataM_=e.nodataM||0,this.srid_=e.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(e,t){return new Ye({geometry:this.readGeometry(e,t)})}readFeatures(e,t){let r=[];const i=this.readGeometry(e,t);return this.splitCollection&&i instanceof kr?r=i.getGeometriesArray():r=[i],r.map(s=>new Ye({geometry:s}))}readGeometry(e,t){const r=ia(e);if(!r)return null;const s=new na(r).readGeometry();return this.viewCache_=r,t=this.getReadOptions(e,t),this.viewCache_=null,Se(s,!1,t)}readProjection(e){const t=this.viewCache_||ia(e);if(!t)return;const r=new na(t);return r.readWkbHeader(),r.getSrid()&&K("EPSG:"+r.getSrid())||void 0}writeFeature(e,t){return this.writeGeometry(e.getGeometry(),t)}writeFeatures(e,t){return this.writeGeometry(new kr(e.map(r=>r.getGeometry())),t)}writeGeometry(e,t){t=this.adaptOptions(t);const r=new ug({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let i=Number.isInteger(this.srid_)?Number(this.srid_):null;if(this.srid_!==!1&&!Number.isInteger(this.srid_)){const o=t.dataProjection&&K(t.dataProjection);if(o){const a=o.getCode();a.startsWith("EPSG:")&&(i=Number(a.substring(5)))}}r.writeGeometry(Se(e,!0,t),i);const s=r.getBuffer();return this.hex_?fg(s):s}}function fg(n){const e=new Uint8Array(n);return Array.from(e.values()).map(t=>(t<16?"0":"")+Number(t).toString(16).toUpperCase()).join("")}function dg(n){const e=new Uint8Array(n.length/2);for(let t=0;t<n.length/2;t++)e[t]=parseInt(n.substr(t*2,2),16);return new DataView(e.buffer)}function ia(n){return typeof n=="string"?dg(n):ArrayBuffer.isView(n)?n instanceof DataView?n:new DataView(n.buffer,n.byteOffset,n.byteLength):n instanceof ArrayBuffer?new DataView(n):null}const me=[null,"http://www.opengis.net/wms"];function mr(n){return Wu(n[0].version,"1.3")>=0}const gg=F(me,{Service:b(Ug),Capability:b(Dg)}),Il={Request:b(Hg),Exception:b(kg),Layer:b($g)},pg=F(me,{...Il,UserDefinedSymbolization:b(Mg)}),mg=F(me,Il);class _g extends Ss{constructor(){super(),this.version=void 0}readFromNode(e){this.version=e.getAttribute("version").trim();const t=A({version:this.version},gg,e,[]);return t||null}}const Cl={Name:b(P),Title:b(P),Abstract:b(P),KeywordList:b(Ul),OnlineResource:b(gr),ContactInformation:b(Bg),Fees:b(P),AccessConstraints:b(P)},yg=F(me,Cl),xg=F(me,{...Cl,LayerLimit:b(fe),MaxWidth:b(fe),MaxHeight:b(fe)}),bg=F(me,{ContactPersonPrimary:b(Gg),ContactPosition:b(P),ContactAddress:b(zg),ContactVoiceTelephone:b(P),ContactFacsimileTelephone:b(P),ContactElectronicMailAddress:b(P)}),Eg=F(me,{ContactPerson:b(P),ContactOrganization:b(P)}),wg=F(me,{AddressType:b(P),Address:b(P),City:b(P),StateOrProvince:b(P),PostCode:b(P),Country:b(P)}),Tg=F(me,{Format:N(P)}),Fl={Name:b(P),Title:b(P),Abstract:b(P),KeywordList:b(Ul),BoundingBox:ee(Nl),Dimension:ee(Vg),Attribution:b(Og),AuthorityURL:ee(Yg),Identifier:ee(P),MetadataURL:ee(qg),DataURL:ee(gt),FeatureListURL:ee(gt),Style:ee(Kg),Layer:ee(si)},Ol=F(me,{...Fl,SRS:ee(P),Extent:b(jg),ScaleHint:ee(Xg),LatLonBoundingBox:b((n,e)=>Nl(n,e,!1)),Layer:ee(si)}),Ml=F(me,{...Fl,CRS:ee(P),EX_GeographicBoundingBox:b(Ng),MinScaleDenominator:b(Te),MaxScaleDenominator:b(Te),Layer:ee(si)}),Sg=F(me,{Title:b(P),OnlineResource:b(gr),LogoURL:b(Dl)}),Rg=F(me,{westBoundLongitude:b(Te),eastBoundLongitude:b(Te),southBoundLatitude:b(Te),northBoundLatitude:b(Te)}),vg=F(me,{GetCapabilities:b(gi),GetMap:b(gi),GetFeatureInfo:b(gi)}),Pg=F(me,{Format:ee(P),DCPType:ee(Wg)}),Lg=F(me,{HTTP:b(Zg)}),Ag=F(me,{Get:b(gt),Post:b(gt)}),Ig=F(me,{Name:b(P),Title:b(P),Abstract:b(P),LegendURL:ee(Dl),StyleSheetURL:b(gt),StyleURL:b(gt)}),Cg=F(me,{Format:b(P),OnlineResource:b(gr)}),Fg=F(me,{Keyword:N(P)});function Og(n,e){return A({},Sg,n,e)}function Mg(n,e){return{SupportSLD:!!We(n.getAttribute("UserDefinedSymbolization")),UserLayer:!!We(n.getAttribute("UserLayer")),UserStyle:!!We(n.getAttribute("UserStyle")),RemoteWFS:!!We(n.getAttribute("RemoteWFS"))}}function Nl(n,e,t=!0){const r=[nt(n.getAttribute("minx")),nt(n.getAttribute("miny")),nt(n.getAttribute("maxx")),nt(n.getAttribute("maxy"))],i=[nt(n.getAttribute("resx")),nt(n.getAttribute("resy"))],s={extent:r,res:i};return t&&(mr(e)?s.crs=n.getAttribute("CRS"):s.srs=n.getAttribute("SRS")),s}function Ng(n,e){const t=A({},Rg,n,e);if(!t)return;const r=t.westBoundLongitude,i=t.southBoundLatitude,s=t.eastBoundLongitude,o=t.northBoundLatitude;if(!(r===void 0||i===void 0||s===void 0||o===void 0))return[r,i,s,o]}function Dg(n,e){return A({},mr(e)?mg:pg,n,e)}function Ug(n,e){return A({},mr(e)?xg:yg,n,e)}function Bg(n,e){return A({},bg,n,e)}function Gg(n,e){return A({},Eg,n,e)}function zg(n,e){return A({},wg,n,e)}function kg(n,e){return A([],Tg,n,e)}function $g(n,e){const t=A({},mr(e)?Ml:Ol,n,e);return t.Layer===void 0?Object.assign(t,si(n,e)):t}function si(n,e){const t=mr(e),r=e[e.length-1],i=A({},t?Ml:Ol,n,e);if(!i)return;let s=We(n.getAttribute("queryable"));s===void 0&&(s=r.queryable),i.queryable=s!==void 0?s:!1;let o=xt(n.getAttribute("cascaded"));o===void 0&&(o=r.cascaded),i.cascaded=o;let a=We(n.getAttribute("opaque"));a===void 0&&(a=r.opaque),i.opaque=a!==void 0?a:!1;let l=We(n.getAttribute("noSubsets"));l===void 0&&(l=r.noSubsets),i.noSubsets=l!==void 0?l:!1;let c=nt(n.getAttribute("fixedWidth"));c||(c=r.fixedWidth),i.fixedWidth=c;let u=nt(n.getAttribute("fixedHeight"));u||(u=r.fixedHeight),i.fixedHeight=u;const h=["Style","AuthorityURL"];t?h.push("CRS"):h.push("SRS","Dimension"),h.forEach(function(d){if(d in r){const g=i[d]||[];i[d]=g.concat(r[d])}});const f=["BoundingBox","Attribution"];return t?f.push("Dimension","EX_GeographicBoundingBox","MinScaleDenominator","MaxScaleDenominator"):f.push("LatLonBoundingBox","ScaleHint","Extent"),f.forEach(function(d){if(!(d in i)){const g=r[d];i[d]=g}}),i}function Vg(n,e){const t={name:n.getAttribute("name"),units:n.getAttribute("units"),unitSymbol:n.getAttribute("unitSymbol")};return mr(e)&&Object.assign(t,{default:n.getAttribute("default"),multipleValues:We(n.getAttribute("multipleValues")),nearestValue:We(n.getAttribute("nearestValue")),current:We(n.getAttribute("current")),values:P(n)}),t}function jg(n,e){return{name:n.getAttribute("name"),default:n.getAttribute("default"),nearestValue:We(n.getAttribute("nearestValue"))}}function Xg(n,e){return{min:nt(n.getAttribute("min")),max:nt(n.getAttribute("max"))}}function gt(n,e){return A({},Cg,n,e)}function Hg(n,e){return A({},vg,n,e)}function Wg(n,e){return A({},Lg,n,e)}function Zg(n,e){return A({},Ag,n,e)}function gi(n,e){return A({},Pg,n,e)}function Dl(n,e){const t=gt(n,e);if(t){const r=[xt(n.getAttribute("width")),xt(n.getAttribute("height"))];return t.size=r,t}}function Yg(n,e){const t=gt(n,e);if(t)return t.name=n.getAttribute("name"),t}function qg(n,e){const t=gt(n,e);if(t)return t.type=n.getAttribute("type"),t}function Kg(n,e){return A({},Ig,n,e)}function Ul(n,e){return A([],Fg,n,e)}const Jg="_feature",Qg="_layer";class ep extends Hn{constructor(e){super(),e=e||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new V,this.layers_=e.layers?e.layers:null}getLayers(){return this.layers_}setLayers(e){this.layers_=e}readFeatures_(e,t){e.setAttribute("namespaceURI",this.featureNS_);const r=e.localName;let i=[];if(e.childNodes.length===0)return i;if(r=="msGMLOutput")for(let s=0,o=e.childNodes.length;s<o;s++){const a=e.childNodes[s];if(a.nodeType!==Node.ELEMENT_NODE)continue;const l=a,c=t[0],u=Qg,h=l.localName.replace(u,"");if(this.layers_&&!this.layers_.includes(h))continue;const f=h+Jg;c.featureType=f,c.featureNS=this.featureNS_;const d={};d[f]=N(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const g=F([c.featureNS,null],d);l.setAttribute("namespaceURI",this.featureNS_);const p=A([],g,l,t,this.gmlFormat_);p&&On(i,p)}if(r=="FeatureCollection"){const s=A([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);s&&(i=s)}return i}readFeaturesFromNode(e,t){const r={};return t&&Object.assign(r,this.getReadOptions(e,t)),this.readFeatures_(e,[r])}}const st=[null,"http://www.opengis.net/wmts/1.0"],_r=[null,"http://www.opengis.net/ows/1.1"],tp=F(st,{Contents:b(hp)});let Is=class extends Ss{constructor(){super(),this.owsParser_=new Rl}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let r=this.owsParser_.readFromNode(e);return r?(r.version=t,r=A(r,tp,e,[]),r||null):null}};const rp=F(st,{Layer:ee(fp),TileMatrixSet:ee(dp)}),np=F(st,{Style:ee(gp),Format:ee(P),TileMatrixSetLink:ee(pp),Dimension:ee(mp),ResourceURL:ee(_p)},F(_r,{Title:b(P),Abstract:b(P),WGS84BoundingBox:b(Gl),BoundingBox:ee(yp),Identifier:b(P)})),ip=F(st,{LegendURL:ee(xp)},F(_r,{Title:b(P),Identifier:b(P)})),sp=F(st,{TileMatrixSet:b(P),TileMatrixSetLimits:b(Ep)}),op=F(st,{TileMatrixLimits:N(wp)}),ap=F(st,{TileMatrix:b(P),MinTileRow:b(fe),MaxTileRow:b(fe),MinTileCol:b(fe),MaxTileCol:b(fe)}),lp=F(st,{Default:b(P),Value:ee(P)},F(_r,{Identifier:b(P)})),Bl=F(_r,{LowerCorner:N(Ui),UpperCorner:N(Ui)}),cp=F(st,{WellKnownScaleSet:b(P),TileMatrix:ee(bp)},F(_r,{SupportedCRS:b(P),Identifier:b(P),BoundingBox:b(Gl)})),up=F(st,{TopLeftCorner:b(Ui),ScaleDenominator:b(Te),TileWidth:b(fe),TileHeight:b(fe),MatrixWidth:b(fe),MatrixHeight:b(fe)},F(_r,{Identifier:b(P)}));function hp(n,e){return A({},rp,n,e)}function fp(n,e){return A({},np,n,e)}function dp(n,e){return A({},cp,n,e)}function gp(n,e){const t=A({},ip,n,e);if(!t)return;const r=n.getAttribute("isDefault")==="true";return t.isDefault=r,t}function pp(n,e){return A({},sp,n,e)}function mp(n,e){return A({},lp,n,e)}function _p(n,e){const t=n.getAttribute("format"),r=n.getAttribute("template"),i=n.getAttribute("resourceType"),s={};return t&&(s.format=t),r&&(s.template=r),i&&(s.resourceType=i),s}function Gl(n,e){const t=A([],Bl,n,e);if(t.length==2)return ms(t)}function yp(n,e){const t=n.getAttribute("crs"),r=A([],Bl,n,e);if(r.length==2)return{extent:ms(r),crs:t}}function xp(n,e){const t={};return t.format=n.getAttribute("format"),t.href=gr(n),t}function Ui(n,e){const t=P(n).split(/\s+/);if(!t||t.length!=2)return;const r=+t[0],i=+t[1];if(!(isNaN(r)||isNaN(i)))return[r,i]}function bp(n,e){return A({},up,n,e)}function Ep(n,e){return A([],op,n,e)}function wp(n,e){return A({},ap,n,e)}const Tp=Object.freeze(Object.defineProperty({__proto__:null,EsriJSON:Wh,GML:xs,GPX:Ef,GeoJSON:us,IGC:nd,IIIFInfo:cd,KML:au,MVT:Ha,OWS:Rl,Polyline:Gd,TopoJSON:lu,WFS:ig,WKB:hg,WKT:xh,WMSCapabilities:_g,WMSGetFeatureInfo:ep,WMTSCapabilities:Is},Symbol.toStringTag,{value:"Module"})),en=34962,tn=34963,Sp=35040,Cs=35044,Xr=35048,Rp=5121,vp=5123,Pp=5125,zl=5126,sa=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function Lp(n,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!cu},e);const t=sa.length;for(let r=0;r<t;++r)try{const i=n.getContext(sa[r],e);if(i)return i}catch{}return null}const Ap={STATIC_DRAW:Cs,STREAM_DRAW:Sp,DYNAMIC_DRAW:Xr};class or{constructor(e,t){this.array_=null,this.type_=e,qe(e===en||e===tn,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=t!==void 0?t:Ap.STATIC_DRAW}ofSize(e){return this.array_=new(gn(this.type_))(e),this}fromArray(e){return this.array_=gn(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(gn(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}setArray(e){const t=gn(this.type_);if(!(e instanceof t))throw new Error(`Expected ${t}`);this.array_=e}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function gn(n){switch(n){case en:return Float32Array;case tn:return Uint32Array;default:return Float32Array}}const pn={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},Ip=`
  precision mediump float;

  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;

  uniform vec2 u_screenSize;

  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,Cp=`
  precision mediump float;

  uniform sampler2D u_image;
  uniform float u_opacity;

  varying vec2 v_texCoord;

  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class oa{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const r=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,e.vertexShader||Ip),t.compileShader(r);const i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,e.fragmentShader||Cp),t.compileShader(i),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,r),t.attachShader(this.renderTargetProgram_,i),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(o=>{this.uniforms_.push({value:e.uniforms[o],location:t.getUniformLocation(this.renderTargetProgram_,o)})})}getRenderTargetTexture(){return this.renderTargetTexture_}getGL(){return this.gl_}init(e){const t=this.getGL(),r=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,r[0],r[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==r[0]||this.renderTargetTextureSize_[1]!==r[1]){this.renderTargetTextureSize_=r;const i=0,s=t.RGBA,o=0,a=t.RGBA,l=t.UNSIGNED_BYTE,c=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,i,s,r[0],r[1],o,a,l,c),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,r[0],r[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,r,i){const s=this.getGL(),o=e.size;if(s.bindFramebuffer(s.FRAMEBUFFER,t?t.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!t){const l=ne(s.canvas);if(!e.renderTargets[l]){const c=s.getContextAttributes();c&&c.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),e.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=e.layerStatesArray[e.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),r&&r(s,e),s.drawArrays(s.TRIANGLES,0,6),i&&i(s,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let r,i=1;this.uniforms_.forEach(function(s){if(r=typeof s.value=="function"?s.value(e):s.value,r instanceof HTMLCanvasElement||r instanceof ImageData)s.texture||(s.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${i}`]),t.bindTexture(t.TEXTURE_2D,s.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),r instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,r.width,r.height,0,t.UNSIGNED_BYTE,new Uint8Array(r.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.uniform1i(s.location,i++);else if(Array.isArray(r))switch(r.length){case 2:t.uniform2f(s.location,r[0],r[1]);return;case 3:t.uniform3f(s.location,r[0],r[1],r[2]);return;case 4:t.uniform4f(s.location,r[0],r[1],r[2],r[3]);return;default:return}else typeof r=="number"&&t.uniform1f(s.location,r)})}}const rt={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},de={UNSIGNED_BYTE:Rp,UNSIGNED_SHORT:vp,UNSIGNED_INT:Pp,FLOAT:zl},Dn={};function aa(n){return"shared/"+n}let la=0;function Fp(){const n="unique/"+la;return la+=1,n}function Op(n){let e=Dn[n];if(!e){const t=document.createElement("canvas");t.width=1,t.height=1,t.style.position="absolute",t.style.left="0",e={users:0,context:Lp(t)},Dn[n]=e}return e.users+=1,e.context}function Mp(n){const e=Dn[n];if(!e||(e.users-=1,e.users>0))return;const t=e.context,r=t.getExtension("WEBGL_lose_context");r&&r.loseContext();const i=t.canvas;i.width=1,i.height=1,delete Dn[n]}class Np extends ll{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?aa(e.canvasCacheKey):Fp(),this.gl_=Op(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(pn.LOST,this.boundHandleWebGLContextLost_),t.addEventListener(pn.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=be(),this.offsetScaleMatrix_=be(),this.tmpMat4_=Qi(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(r=>new oa({webGlContext:this.gl_,scaleRatio:r.scaleRatio,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,uniforms:r.uniforms})):[new oa({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===aa(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const t=this.gl_,r=ne(e);let i=this.bufferCache_[r];if(!i){const s=t.createBuffer();i={buffer:e,webGlBuffer:s},this.bufferCache_[r]=i}t.bindBuffer(e.getType(),i.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=ne(e);delete this.bufferCache_[t]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(pn.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(pn.RESTORED,this.boundHandleWebGLContextRestored_),Mp(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,r){const i=this.gl_,s=this.getCanvas(),o=e.size,a=e.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(e);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,t?i.ZERO:i.ONE_MINUS_SRC_ALPHA),r?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}bindFrameBuffer(e,t){const r=this.getGL();r.bindFramebuffer(r.FRAMEBUFFER,e),t&&r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0)}bindInitialFrameBuffer(){const e=this.getGL(),t=this.postProcessPasses_[0].getFrameBuffer();e.bindFramebuffer(e.FRAMEBUFFER,t);const r=this.postProcessPasses_[0].getRenderTargetTexture();e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0)}bindTexture(e,t,r){const i=this.gl_;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,e),i.uniform1i(this.getUniformLocation(r),t)}bindAttribute(e,t,r){const i=this.getGL();this.bindBuffer(e);const s=this.getAttributeLocation(t);i.enableVertexAttribArray(s),i.vertexAttribPointer(s,r,i.FLOAT,!1,0,0)}prepareDrawToRenderTarget(e,t,r,i){const s=this.gl_,o=t.getSize();s.bindFramebuffer(s.FRAMEBUFFER,t.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,t.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,t.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,r?s.ZERO:s.ONE_MINUS_SRC_ALPHA),i?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(e,t){const r=this.gl_;this.getExtension("OES_element_index_uint");const i=r.UNSIGNED_INT,s=4,o=t-e,a=e*s;r.drawElements(r.TRIANGLES,o,i,a)}finalizeDraw(e,t,r){for(let i=0,s=this.postProcessPasses_.length;i<s;i++)i===s-1?this.postProcessPasses_[i].apply(e,null,t,r):this.postProcessPasses_[i].apply(e,this.postProcessPasses_[i+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,r=e.viewState.rotation,i=e.pixelRatio;this.setUniformFloatValue(rt.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(rt.ZOOM,e.viewState.zoom),this.setUniformFloatValue(rt.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(rt.PIXEL_RATIO,i),this.setUniformFloatVec2(rt.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(rt.ROTATION,r)}applyHitDetectionUniform(e){const t=this.getUniformLocation(rt.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(rt.PIXEL_RATIO,.5)}applyUniforms(e){const t=this.gl_;let r,i=0;this.uniforms_.forEach(s=>{if(r=typeof s.value=="function"?s.value(e):s.value,r instanceof HTMLCanvasElement||r instanceof HTMLImageElement||r instanceof ImageData||r instanceof WebGLTexture){r instanceof WebGLTexture&&!s.texture?(s.prevValue=void 0,s.texture=r):s.texture||(s.prevValue=void 0,s.texture=t.createTexture()),this.bindTexture(s.texture,i,s.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const o=!(r instanceof HTMLImageElement)||r.complete;!(r instanceof WebGLTexture)&&o&&s.prevValue!==r&&(s.prevValue=r,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)),i++}else if(Array.isArray(r)&&r.length===6)this.setUniformMatrixValue(s.name,Ln(this.tmpMat4_,r));else if(Array.isArray(r)&&r.length<=4)switch(r.length){case 2:t.uniform2f(this.getUniformLocation(s.name),r[0],r[1]);return;case 3:t.uniform3f(this.getUniformLocation(s.name),r[0],r[1],r[2]);return;case 4:t.uniform4f(this.getUniformLocation(s.name),r[0],r[1],r[2],r[3]);return;default:return}else typeof r=="number"&&t.uniform1f(this.getUniformLocation(s.name),r)})}useProgram(e,t){this.gl_.useProgram(e),this.currentProgram_=e,t&&(this.applyFrameState(t),this.applyUniforms(t))}compileShader(e,t){const r=this.gl_,i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}getProgram(e,t){const r=this.gl_,i=this.compileShader(e,r.FRAGMENT_SHADER),s=this.compileShader(t,r.VERTEX_SHADER),o=r.createProgram();if(r.attachShader(o,i),r.attachShader(o,s),r.linkProgram(o),!r.getShaderParameter(i,r.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${r.getShaderInfoLog(i)}`;throw new Error(a)}if(r.deleteShader(i),!r.getShaderParameter(s,r.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${r.getShaderInfoLog(s)}`;throw new Error(a)}if(r.deleteShader(s),!r.getProgramParameter(o,r.LINK_STATUS)){const a=`GL program linking failed: ${r.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(e){const t=ne(this.currentProgram_);return this.uniformLocationsByProgram_[t]===void 0&&(this.uniformLocationsByProgram_[t]={}),this.uniformLocationsByProgram_[t][e]===void 0&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=ne(this.currentProgram_);return this.attribLocationsByProgram_[t]===void 0&&(this.attribLocationsByProgram_[t]={}),this.attribLocationsByProgram_[t][e]===void 0&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const r=e.size,i=e.viewState.rotation,s=e.viewState.resolution,o=e.viewState.center;return hs(t,0,0,2/(s*r[0]),2/(s*r[1]),-i,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}enableAttributeArray_(e,t,r,i,s){const o=this.getAttributeLocation(e);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,t,r,!1,i,s))}enableAttributes(e){const t=Dp(e);let r=0;for(let i=0;i<e.length;i++){const s=e[i];this.enableAttributeArray_(s.name,s.size,s.type||zl,t,r),r+=s.size*kl(s.type)}}handleWebGLContextLost(e){lh(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,r,i){const s=this.gl_;r=r||s.createTexture();const o=i?s.NEAREST:s.LINEAR;s.bindTexture(s.TEXTURE_2D,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);const a=0,l=s.RGBA,c=0,u=s.RGBA,h=s.UNSIGNED_BYTE;return t instanceof Uint8Array?s.texImage2D(s.TEXTURE_2D,a,l,e[0],e[1],c,u,h,t):t?s.texImage2D(s.TEXTURE_2D,a,l,u,h,t):s.texImage2D(s.TEXTURE_2D,a,l,e[0],e[1],c,u,h,null),r}}function Dp(n){let e=0;for(let t=0;t<n.length;t++){const r=n[t];e+=r.size*kl(r.type)}return e}function kl(n){switch(n){case de.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case de.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case de.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case de.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class rn extends uu{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=be(),this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,this.onMapChanged_=()=>{this.clearCache(),this.removeHelper()},e.addChangeListener(Oi.MAP,this.onMapChanged_),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(Mt.PRECOMPOSE)){const i=new ui(Mt.PRECOMPOSE,void 0,t,e);r.dispatchEvent(i)}}dispatchPostComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(Mt.POSTCOMPOSE)){const i=new ui(Mt.POSTCOMPOSE,void 0,t,e);r.dispatchEvent(i)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t=!0,r=-1,i;for(let o=0,a=e.layerStatesArray.length;o<a;o++){const l=e.layerStatesArray[o].layer,c=l.getRenderer();if(!(c instanceof rn)){t=!0;continue}const u=l.getClassName();if((t||u!==i)&&(r+=1,t=!1),i=u,c===this)break}const s="map/"+e.mapId+"/group/"+r;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new Np({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}clearCache(){}disposeInternal(){var e;this.clearCache(),this.removeHelper(),(e=this.getLayer())==null||e.removeChangeListener(Oi.MAP,this.onMapChanged_),super.disposeInternal()}dispatchRenderEvent_(e,t,r){const i=this.getLayer();if(i.hasListener(e)){hs(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);const s=new ui(e,this.inversePixelTransform_,r,t);i.dispatchEvent(s)}}preRender(e,t){this.dispatchRenderEvent_(Mt.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(Mt.POSTRENDER,e,t)}}const Ke=new Uint8Array(4);class $l{constructor(e,t){this.helper_=e;const r=e.getGL();this.texture_=r.createTexture(),this.framebuffer_=r.createFramebuffer(),this.depthbuffer_=r.createRenderbuffer(),this.size_=t||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(e){ch(e,this.size_)||(this.size_[0]=e[0],this.size_[1]=e[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const e=this.size_,t=this.helper_.getGL();t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.readPixels(0,0,e[0],e[1],t.RGBA,t.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(e,t){if(e<0||t<0||e>this.size_[0]||t>=this.size_[1])return Ke[0]=0,Ke[1]=0,Ke[2]=0,Ke[3]=0,Ke;this.readAll();const r=Math.floor(e)+(this.size_[1]-Math.floor(t)-1)*this.size_[0];return Ke[0]=this.data_[r*4],Ke[1]=this.data_[r*4+1],Ke[2]=this.data_[r*4+2],Ke[3]=this.data_[r*4+3],Ke}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const e=this.size_,t=this.helper_.getGL();this.texture_=this.helper_.createTexture(e,null,this.texture_),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.viewport(0,0,e[0],e[1]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture_,0),t.bindRenderbuffer(t.RENDERBUFFER,this.depthbuffer_),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e[0],e[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(e[0]*e[1]*4)}}const Ir={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"},ca=.985;function Vl(n,e){e=e||[];const t=256,r=t-1;return e[0]=Math.floor(n/t/t/t)/r,e[1]=Math.floor(n/t/t)%t/r,e[2]=Math.floor(n/t)%t/r,e[3]=n%t/r,e}function jl(n){let e=0;const t=256,r=t-1;return e+=Math.round(n[0]*t*t*t*r),e+=Math.round(n[1]*t*t*r),e+=Math.round(n[2]*t*r),e+=Math.round(n[3]*r),e}function Xl(){const n='const t="GENERATE_POLYGON_BUFFERS",e="GENERATE_POINT_BUFFERS",n="GENERATE_LINE_STRING_BUFFERS";function r(t,e){const n=e[0],r=e[1];return e[0]=t[0]*n+t[2]*r+t[4],e[1]=t[1]*n+t[3]*r+t[5],e}function x(t,e){const n=(r=e)[0]*r[3]-r[1]*r[2];var r;!function(t,e){if(!t)throw new Error(e)}(0!==n,"Transformation matrix cannot be inverted");const x=e[0],o=e[1],u=e[2],i=e[3],f=e[4],s=e[5];return t[0]=i/n,t[1]=-o/n,t[2]=-u/n,t[3]=x/n,t[4]=(u*s-i*f)/n,t[5]=-(x*s-o*f)/n,t}function o(t,e,n=2){const r=e&&e.length,x=r?e[0]*n:t.length;let o=u(t,0,x,n,!0);const i=[];if(!o||o.next===o.prev)return i;let s,l,c;if(r&&(o=function(t,e,n,r){const x=[];for(let n=0,o=e.length;n<o;n++){const i=u(t,e[n]*r,n<o-1?e[n+1]*r:t.length,r,!1);i===i.next&&(i.steiner=!0),x.push(g(i))}x.sort(y);for(let t=0;t<x.length;t++)n=h(x[t],n);return n}(t,e,o,n)),t.length>80*n){s=1/0,l=1/0;let e=-1/0,r=-1/0;for(let o=n;o<x;o+=n){const n=t[o],x=t[o+1];n<s&&(s=n),x<l&&(l=x),n>e&&(e=n),x>r&&(r=x)}c=Math.max(e-s,r-l),c=0!==c?32767/c:0}return f(o,i,n,s,l,c,0),i}function u(t,e,n,r,x){let o;if(x===function(t,e,n,r){let x=0;for(let o=e,u=n-r;o<n;o+=r)x+=(t[u]-t[o])*(t[o+1]+t[u+1]),u=o;return x}(t,e,n,r)>0)for(let x=e;x<n;x+=r)o=z(x/r|0,t[x],t[x+1],o);else for(let x=n-r;x>=e;x-=r)o=z(x/r|0,t[x],t[x+1],o);return o&&M(o,o.next)&&(F(o),o=o.next),o}function i(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!M(r,r.next)&&0!==d(r.prev,r,r.next))r=r.next;else{if(F(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function f(t,e,n,r,x,o,u){if(!t)return;!u&&o&&function(t,e,n,r){let x=t;do{0===x.z&&(x.z=v(x.x,x.y,e,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==t);x.prevZ.nextZ=null,x.prevZ=null,function(t){let e,n=1;do{let r,x=t;t=null;let o=null;for(e=0;x;){e++;let u=x,i=0;for(let t=0;t<n&&(i++,u=u.nextZ,u);t++);let f=n;for(;i>0||f>0&&u;)0!==i&&(0===f||!u||x.z<=u.z)?(r=x,x=x.nextZ,i--):(r=u,u=u.nextZ,f--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;x=u}o.nextZ=null,n*=2}while(e>1)}(x)}(t,r,x,o);let y=t;for(;t.prev!==t.next;){const h=t.prev,p=t.next;if(o?l(t,r,x,o):s(t))e.push(h.i,t.i,p.i),F(t),t=p.next,y=p.next;else if((t=p)===y){u?1===u?f(t=c(i(t),e),e,n,r,x,o,2):2===u&&a(t,e,n,r,x,o):f(i(t),e,n,r,x,o,1);break}}}function s(t){const e=t.prev,n=t,r=t.next;if(d(e,n,r)>=0)return!1;const x=e.x,o=n.x,u=r.x,i=e.y,f=n.y,s=r.y,l=x<o?x<u?x:u:o<u?o:u,c=i<f?i<s?i:s:f<s?f:s,a=x>o?x>u?x:u:o>u?o:u,y=i>f?i>s?i:s:f>s?f:s;let h=r.next;for(;h!==e;){if(h.x>=l&&h.x<=a&&h.y>=c&&h.y<=y&&b(x,i,o,f,u,s,h.x,h.y)&&d(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function l(t,e,n,r){const x=t.prev,o=t,u=t.next;if(d(x,o,u)>=0)return!1;const i=x.x,f=o.x,s=u.x,l=x.y,c=o.y,a=u.y,y=i<f?i<s?i:s:f<s?f:s,h=l<c?l<a?l:a:c<a?c:a,p=i>f?i>s?i:s:f>s?f:s,g=l>c?l>a?l:a:c>a?c:a,Z=v(y,h,e,n,r),M=v(p,g,e,n,r);let w=t.prevZ,m=t.nextZ;for(;w&&w.z>=Z&&m&&m.z<=M;){if(w.x>=y&&w.x<=p&&w.y>=h&&w.y<=g&&w!==x&&w!==u&&b(i,l,f,c,s,a,w.x,w.y)&&d(w.prev,w,w.next)>=0)return!1;if(w=w.prevZ,m.x>=y&&m.x<=p&&m.y>=h&&m.y<=g&&m!==x&&m!==u&&b(i,l,f,c,s,a,m.x,m.y)&&d(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;w&&w.z>=Z;){if(w.x>=y&&w.x<=p&&w.y>=h&&w.y<=g&&w!==x&&w!==u&&b(i,l,f,c,s,a,w.x,w.y)&&d(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;m&&m.z<=M;){if(m.x>=y&&m.x<=p&&m.y>=h&&m.y<=g&&m!==x&&m!==u&&b(i,l,f,c,s,a,m.x,m.y)&&d(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function c(t,e){let n=t;do{const r=n.prev,x=n.next.next;!M(r,x)&&w(r,n,n.next,x)&&E(r,x)&&E(x,r)&&(e.push(r.i,n.i,x.i),F(n),F(n.next),n=t=x),n=n.next}while(n!==t);return i(n)}function a(t,e,n,r,x,o){let u=t;do{let t=u.next.next;for(;t!==u.prev;){if(u.i!==t.i&&Z(u,t)){let s=I(u,t);return u=i(u,u.next),s=i(s,s.next),f(u,e,n,r,x,o,0),void f(s,e,n,r,x,o,0)}t=t.next}u=u.next}while(u!==t)}function y(t,e){return t.x-e.x}function h(t,e){const n=function(t,e){let n=e;const r=t.x,x=t.y;let o,u=-1/0;do{if(x<=n.y&&x>=n.next.y&&n.next.y!==n.y){const t=n.x+(x-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>u&&(u=t,o=n.x<n.next.x?n:n.next,t===r))return o}n=n.next}while(n!==e);if(!o)return null;const i=o,f=o.x,s=o.y;let l=1/0;n=o;do{if(r>=n.x&&n.x>=f&&r!==n.x&&b(x<s?r:u,x,f,s,x<s?u:r,x,n.x,n.y)){const e=Math.abs(x-n.y)/(r-n.x);E(n,t)&&(e<l||e===l&&(n.x>o.x||n.x===o.x&&p(o,n)))&&(o=n,l=e)}n=n.next}while(n!==i);return o}(t,e);if(!n)return e;const r=I(n,t);return i(r,r.next),i(n,n.next)}function p(t,e){return d(t.prev,t,e.prev)<0&&d(e.next,t,t.next)<0}function v(t,e,n,r,x){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function g(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function b(t,e,n,r,x,o,u,i){return(x-u)*(e-i)>=(t-u)*(o-i)&&(t-u)*(r-i)>=(n-u)*(e-i)&&(n-u)*(o-i)>=(x-u)*(r-i)}function Z(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&w(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(E(t,e)&&E(e,t)&&function(t,e){let n=t,r=!1;const x=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&x<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(d(t.prev,t,e.prev)||d(t,e.prev,e))||M(t,e)&&d(t.prev,t,t.next)>0&&d(e.prev,e,e.next)>0)}function d(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function M(t,e){return t.x===e.x&&t.y===e.y}function w(t,e,n,r){const x=A(d(t,e,n)),o=A(d(t,e,r)),u=A(d(n,r,t)),i=A(d(n,r,e));return x!==o&&u!==i||(!(0!==x||!m(t,n,e))||(!(0!==o||!m(t,r,e))||(!(0!==u||!m(n,t,r))||!(0!==i||!m(n,e,r)))))}function m(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function A(t){return t>0?1:t<0?-1:0}function E(t,e){return d(t.prev,t,t.next)<0?d(t,e,t.next)>=0&&d(t,t.prev,e)>=0:d(t,e,t.prev)<0||d(t,t.next,e)<0}function I(t,e){const n=P(t.i,t.x,t.y),r=P(e.i,e.x,e.y),x=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=x,x.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function z(t,e,n,r){const x=P(t,e,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function F(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function P(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}new Array(6);const B=[],N={vertexPosition:0,indexPosition:0};function R(t,e,n,r,x){t[e+0]=n,t[e+1]=r,t[e+2]=x}function S(t,e,n,r,x,o){const u=3+x,i=t[e+0],f=t[e+1],s=B;s.length=x;for(let n=0;n<s.length;n++)s[n]=t[e+2+n];let l=o?o.vertexPosition:0,c=o?o.indexPosition:0;const a=l/u;return R(n,l,i,f,0),s.length&&n.set(s,l+3),l+=u,R(n,l,i,f,1),s.length&&n.set(s,l+3),l+=u,R(n,l,i,f,2),s.length&&n.set(s,l+3),l+=u,R(n,l,i,f,3),s.length&&n.set(s,l+3),l+=u,r[c++]=a,r[c++]=a+1,r[c++]=a+3,r[c++]=a+1,r[c++]=a+2,r[c++]=a+3,N.vertexPosition=l,N.indexPosition=c,N}function T(t,e,n,x,o,u,i,f,s,l,c){const a=10+f.length,y=u.length/a,h=[t[e+0],t[e+1]],p=[t[n],t[n+1]],v=t[e+2],g=t[n+2],b=r(s,[...h]),Z=r(s,[...p]);function d(t,e,n){const r=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),x=[(e[0]-t[0])/r,(e[1]-t[1])/r],o=[-x[1],x[0]],u=Math.sqrt((n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1])),i=[(n[0]-t[0])/u,(n[1]-t[1])/u],f=0===r||0===u?0:Math.acos((s=i[0]*x[0]+i[1]*x[1],l=-1,c=1,Math.min(Math.max(s,l),c)));var s,l,c;return i[0]*o[0]+i[1]*o[1]>0?f:2*Math.PI-f}let M=-1,w=-1,m=c;const A=null!==o;if(null!==x){M=d(b,Z,r(s,[...[t[x],t[x+1]]])),Math.cos(M)<=.985&&(m+=Math.tan((M-Math.PI)/2))}if(A){w=d(Z,b,r(s,[...[t[o],t[o+1]]])),Math.cos(w)<=.985&&(m+=Math.tan((Math.PI-w)/2))}function E(t,e){return 0===e?1e4*t:Math.sign(e)*(1e4*t+Math.abs(e))}return u.push(h[0],h[1],v,p[0],p[1],g,M,w,l,E(0,c)),u.push(...f),u.push(h[0],h[1],v,p[0],p[1],g,M,w,l,E(1,c)),u.push(...f),u.push(h[0],h[1],v,p[0],p[1],g,M,w,l,E(2,c)),u.push(...f),u.push(h[0],h[1],v,p[0],p[1],g,M,w,l,E(3,c)),u.push(...f),i.push(y,y+1,y+2,y+1,y+3,y+2),{length:l+Math.sqrt((Z[0]-b[0])*(Z[0]-b[0])+(Z[1]-b[1])*(Z[1]-b[1])),angle:m}}function _(t,e,n,r,x){const u=2+x;let i=e;const f=t.slice(i,i+x);i+=x;const s=t[i++];let l=0;const c=new Array(s-1);for(let e=0;e<s;e++)l+=t[i++],e<s-1&&(c[e]=l);const a=t.slice(i,i+2*l),y=o(a,c,2);for(let t=0;t<y.length;t++)r.push(y[t]+n.length/u);for(let t=0;t<a.length;t+=2)n.push(a[t],a[t+1],...f);return i+2*l}const O=self;O.onmessage=r=>{const o=r.data;switch(o.type){case e:{const t=3,e=2,n=o.customAttributesSize,r=e+n,x=new Float32Array(o.renderInstructions),u=x.length/r,i=4*u*(n+t),f=new Uint32Array(6*u),s=new Float32Array(i);let l;for(let t=0;t<x.length;t+=r)l=S(x,t,s,f,n,l);const c=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:x.buffer},o);O.postMessage(c,[s.buffer,f.buffer,x.buffer]);break}case n:{const t=[],e=[],n=o.customAttributesSize,r=3,u=new Float32Array(o.renderInstructions);let i=0;const f=[1,0,0,1,0,0];let s,l;for(x(f,o.renderInstructionsTransform);i<u.length;){l=Array.from(u.slice(i,i+n)),i+=n,s=u[i++];const x=i,o=i+(s-1)*r,c=u[x]===u[o]&&u[x+1]===u[o+1];let a=0,y=0;for(let n=0;n<s-1;n++){let h=null;n>0?h=i+(n-1)*r:c&&(h=o-r);let p=null;n<s-2?p=i+(n+2)*r:c&&(p=x+r);const v=T(u,i+n*r,i+(n+1)*r,h,p,t,e,l,f,a,y);a=v.length,y=v.angle}i+=s*r}const c=Uint32Array.from(e),a=Float32Array.from(t),y=Object.assign({vertexBuffer:a.buffer,indexBuffer:c.buffer,renderInstructions:u.buffer},o);O.postMessage(y,[a.buffer,c.buffer,u.buffer]);break}case t:{const t=[],e=[],n=o.customAttributesSize,r=new Float32Array(o.renderInstructions);let x=0;for(;x<r.length;)x=_(r,x,t,e,n);const u=Uint32Array.from(e),i=Float32Array.from(t),f=Object.assign({vertexBuffer:i.buffer,indexBuffer:u.buffer,renderInstructions:r.buffer},o);O.postMessage(f,[i.buffer,u.buffer,r.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(n,"binary").toString("base64"):URL.createObjectURL(new Blob([n],{type:"application/javascript"})))}function Hl(n,e){const t=n.viewState.projection,i=e.getSource().getWrapX()&&t.canWrapX(),s=t.getExtent(),o=n.extent,a=i?De(s):null,l=i?Math.ceil((o[2]-s[2])/a)+1:1;return[i?Math.floor((o[0]-s[0])/a):0,l,a]}class Wl extends rn{constructor(e,t){const r=t.uniforms||{},i=be();r[rt.PROJECTION_MATRIX]=i,super(e,{uniforms:r,postProcesses:t.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new or(en,Xr),this.indicesBuffer_=new or(tn,Xr),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.program_,this.hitDetectionEnabled_=t.hitDetectionEnabled??!0;const s=t.attributes?t.attributes.map(function(a){return{name:"a_"+a.name,size:1,type:de.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:de.FLOAT},{name:"a_index",size:1,type:de.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_hitColor",size:4,type:de.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:de.FLOAT})),this.attributes.push(...s),this.customAttributes=t.attributes?t.attributes:[],this.previousExtent_=ei(),this.currentTransform_=i,this.renderTransform_=be(),this.invertRenderTransform_=be(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=Xl(),this.worker_.addEventListener("message",a=>{const l=a.data;if(l.type===Ir.GENERATE_POINT_BUFFERS){const c=l.projectionTransform;this.verticesBuffer_.fromArrayBuffer(l.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(l.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=c,$r(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(a.data.renderInstructions),l.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const o=this.getLayer().getSource();this.sourceListenKeys_=[Et(o,bt.ADDFEATURE,this.handleSourceFeatureAdded_,this),Et(o,bt.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),Et(o,bt.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),Et(o,bt.CLEAR,this.handleSourceFeatureClear_,this)],o.forEachFeature(a=>{this.featureCache_[ne(a)]={feature:a,properties:a.getProperties(),geometry:a.getGeometry()},this.featureCount_++})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new $l(this.helper)),this.verticesBuffer_.getArray()&&this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.getArray()&&this.helper.flushBufferData(this.indicesBuffer_)}handleSourceFeatureAdded_(e){const t=e.feature;this.featureCache_[ne(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(e){const t=e.feature;this.featureCache_[ne(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()}}handleSourceFeatureDelete_(e){const t=e.feature;delete this.featureCache_[ne(t)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[r,i,s]=Hl(e,this.getLayer());return this.renderWorlds(e,!1,r,i,s),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,r,i,s),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),this.helper.getCanvas()}prepareFrameInternal(e){const t=this.getLayer(),r=t.getSource(),i=e.viewState,s=!e.viewHints[St.ANIMATING]&&!e.viewHints[St.INTERACTING],o=!jr(this.previousExtent_,e.extent),a=this.sourceRevision_<r.getRevision();if(a&&(this.sourceRevision_=r.getRevision()),s&&(o||a)){const l=i.projection,c=i.resolution,u=t instanceof Zn?t.getRenderBuffer():0,h=_s(e.extent,u*c);r.loadFeatures(h,c,l),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(e){const t=be();this.helper.makeProjectionTransform(e,t);const i=(this.hitDetectionEnabled_?7:2)+this.customAttributes.length,s=i*this.featureCount_;(!this.renderInstructions_||this.renderInstructions_.length!==s)&&(this.renderInstructions_=new Float32Array(s));let o,a;const l=[],c=[];let u=-1;for(const f in this.featureCache_)if(o=this.featureCache_[f],a=o.geometry,!(!a||a.getType()!=="Point")){if(l[0]=a.getFlatCoordinates()[0],l[1]=a.getFlatCoordinates()[1],dt(t,l),this.renderInstructions_[++u]=l[0],this.renderInstructions_[++u]=l[1],this.hitDetectionEnabled_){const d=Vl(u+5,c);this.renderInstructions_[++u]=d[0],this.renderInstructions_[++u]=d[1],this.renderInstructions_[++u]=d[2],this.renderInstructions_[++u]=d[3],this.renderInstructions_[++u]=Number(f)}for(let d=0;d<this.customAttributes.length;d++){const g=this.customAttributes[d].callback(o.feature,o.properties);this.renderInstructions_[++u]=g}}const h={id:++this.lastSentId,type:Ir.GENERATE_POINT_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesSize:i-2};h.projectionTransform=t,this.ready=!1,this.worker_.postMessage(h,[this.renderInstructions_.buffer]),this.renderInstructions_=null}forEachFeatureAtCoordinate(e,t,r,i,s){if(qe(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const o=dt(t.coordinateToPixelTransform,e.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],c=jl(l),u=this.renderInstructions_[c],h=Math.floor(u).toString(),d=this.getLayer().getSource().getFeatureByUid(h);if(d)return i(d,this.getLayer(),null)}renderWorlds(e,t,r,i,s){let o=r;this.helper.useProgram(this.program_,e),t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(e,this.currentTransform_),fs(this.currentTransform_,o*s,0),zr(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.applyHitDetectionUniform(t);const a=this.indicesBuffer_.getSize();this.helper.drawElements(0,a)}while(++o<i)}disposeInternal(){this.worker_.terminate(),this.sourceListenKeys_.forEach(function(e){cl(e)}),this.sourceListenKeys_=null,super.disposeInternal()}renderDeclutter(){}}class Up{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}delete(e){this.texture_&&e.deleteTexture(this.texture_),this.texture_=null}}class Bp extends uh{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter=e.gutter||0,this.helper=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(Ie.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===he.LOADED,this.loaded)this.uploadTile();else{if(e instanceof es){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(Ie.CHANGE,this.handleTileChange_)}}uploadTile(){ps()}setReady(){this.ready=!0,this.dispatchEvent(Ie.CHANGE)}handleTileChange_(){this.tile.getState()===he.LOADED&&(this.loaded=!0,this.uploadTile())}setHelper(e){this.helper=e,this.helper&&this.loaded&&this.uploadTile()}disposeInternal(){this.setHelper(null),this.tile.removeEventListener(Ie.CHANGE,this.handleTileChange_)}}function Zl(n,e,t){const r=t?n.LINEAR:n.NEAREST;n.bindTexture(n.TEXTURE_2D,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,r)}function Gp(n,e,t,r){Zl(n,e,r),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)}function ua(n,e,t,r,i,s){const o=n.getGL();let a,l;t instanceof Float32Array?(a=o.FLOAT,n.getExtension("OES_texture_float"),l=n.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),Zl(o,e,s&&l);const c=t.byteLength/r[1];let u=1;c%8===0?u=8:c%4===0?u=4:c%2===0&&(u=2);let h;switch(i){case 1:{h=o.LUMINANCE;break}case 2:{h=o.LUMINANCE_ALPHA;break}case 3:{h=o.RGB;break}case 4:{h=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${i}`)}const f=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,u),o.texImage2D(o.TEXTURE_2D,0,h,r[0],r[1],0,h,a,t),o.pixelStorei(o.UNPACK_ALIGNMENT,f)}let Kt=null;function zp(){Kt=zt(1,1,void 0,{willReadFrequently:!0})}class kp extends Bp{constructor(e){super(e),this.textures=[],this.renderSize_=Ze(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new or(en,Cs);t.fromArray([0,1,1,1,1,0,0,0]),this.helper.flushBufferData(t),this.coords=t,this.setTile(e.tile)}setHelper(e){var r;const t=(r=this.helper)==null?void 0:r.getGL();if(t){this.helper.deleteBuffer(this.coords);for(let i=0;i<this.textures.length;++i)t.deleteTexture(this.textures[i])}super.setHelper(e),e&&e.flushBufferData(this.coords)}uploadTile(){const e=this.helper,t=e.getGL(),r=this.tile;this.textures.length=0;let i;r instanceof es||r instanceof ts?i=r.getImage():i=r.getData();const s=mo(i);if(s){const _=t.createTexture();this.textures.push(_),this.bandCount=4,Gp(t,_,s,r.interpolate),this.setReady();return}i=_o(i);const o=r.getSize(),a=[o[0]+2*this.gutter,o[1]+2*this.gutter],l=i instanceof Float32Array,c=a[0]*a[1],u=l?Float32Array:Uint8Array,h=u.BYTES_PER_ELEMENT,f=i.byteLength/a[1];this.bandCount=Math.floor(f/h/a[0]);const d=Math.ceil(this.bandCount/4);if(d===1){const _=t.createTexture();this.textures.push(_),ua(e,_,i,a,this.bandCount,r.interpolate),this.setReady();return}const g=new Array(d);for(let _=0;_<d;++_){const x=t.createTexture();this.textures.push(x);const w=_<d-1?4:(this.bandCount-1)%4+1;g[_]=new u(c*w)}let p=0,m=0;const y=a[0]*this.bandCount;for(let _=0;_<a[1];++_){for(let x=0;x<y;++x){const w=i[m+x],S=Math.floor(p/this.bandCount),T=x%this.bandCount,R=Math.floor(T/4),L=g[R],I=L.length/c,C=T%4;L[S*I+C]=w,++p}m+=f/h}for(let _=0;_<d;++_){const x=this.textures[_],w=g[_],S=w.length/c;ua(e,x,w,a,S,r.interpolate)}this.setReady()}getImagePixelData_(e,t,r){const i=this.gutter,s=this.renderSize_[0],o=this.renderSize_[1];Kt||zp(),Kt.clearRect(0,0,1,1);const a=e.width,l=e.height,c=a-2*i,u=l-2*i,h=i+Math.floor(c*(t/s)),f=i+Math.floor(u*(r/o));let d;try{Kt.drawImage(e,h,f,1,1,0,0,1,1),d=Kt.getImageData(0,0,1,1).data}catch{return Kt=null,null}return d}getArrayPixelData_(e,t,r,i){const s=this.gutter,o=this.renderSize_[0],a=this.renderSize_[1],l=t[0],c=t[1],u=l+2*s,h=c+2*s,f=s+Math.floor(l*(r/o)),d=s+Math.floor(c*(i/a));if(e instanceof DataView){const p=e.byteLength/(u*h),m=p*(d*u+f),y=e.buffer.slice(m,m+p);return new DataView(y)}const g=this.bandCount*(d*u+f);return e.slice(g,g+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof Wa){const r=this.tile.getData(),i=_o(r);if(i){const s=this.tile.getSize();return this.getArrayPixelData_(i,s,e,t)}return this.getImagePixelData_(mo(r),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}}const $p={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"};function ha(n){return 1/(n+2)}function Vp(){return{tileIds:new Set,representationsByZ:{}}}function fa(n,e){return n.tileIds.has(ne(e))}function da(n,e,t){const r=n.representationsByZ;t in r||(r[t]=new Set),r[t].add(e),n.tileIds.add(ne(e.tile))}function pi(n,e){const t=n.layerStatesArray[n.layerIndex];t.extent&&(e=kt(e,il(t.extent,n.viewState.projection)));const r=t.layer.getRenderSource();if(!r.getWrapX()){const i=r.getTileGridForProjection(n.viewState.projection).getExtent();i&&(e=kt(e,i))}return e}function Bi(n,e){return`${n.getKey()},${n.getRevision()},${qt(e)}`}class jp extends rn{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=be(),this.tempMat4=Qi(),this.tempTileRange_=new hu(0,0,0,0),this.tempTileCoord_=Ii(0,0,0),this.tempSize_=[0,0];const r=t.cacheSize!==void 0?t.cacheSize:512;this.tileRepresentationCache=new Za(r),this.frameState=null,this.renderedProjection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}prepareFrameInternal(e){this.renderedProjection_?e.viewState.projection!==this.renderedProjection_&&(this.clearCache(),this.renderedProjection_=e.viewState.projection):this.renderedProjection_=e.viewState.projection;const r=this.getLayer().getRenderSource();return!r||gs(pi(e,e.extent))?!1:r.getState()==="ready"}createTileRepresentation(e){return ps()}enqueueTiles(e,t,r,i,s){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),c=l.getTileGridForProjection(o.projection),u=l.getGutterForProjection(o.projection),h=ne(l);h in e.wantedTiles||(e.wantedTiles[h]={});const f=e.wantedTiles[h],d=this.tileRepresentationCache,g=a.getMapInternal(),p=Math.max(r-s,c.getMinZoom(),c.getZForResolution(Math.min(a.getMaxResolution(),g?g.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):c.getResolution(0)),l.zDirection));for(let m=r;m>=p;--m){const y=c.getTileRangeForExtentAndZ(t,m,this.tempTileRange_),_=c.getResolution(m);for(let x=y.minX;x<=y.maxX;++x)for(let w=y.minY;w<=y.maxY;++w){const S=Ii(m,x,w,this.tempTileCoord_),T=Bi(l,S);let R,L;if(d.containsKey(T)&&(R=d.get(T),L=R.tile),(!R||R.tile.key!==l.getKey())&&(L=l.getTile(m,x,w,e.pixelRatio,o.projection),!L)||fa(i,L))continue;R?R.setTile(L):(R=this.createTileRepresentation({tile:L,grid:c,helper:this.helper,gutter:u}),d.set(T,R)),da(i,R,m);const I=L.getKey();f[I]=!0,L.getState()===he.IDLE&&(e.tileQueue.isKeyQueued(I)||e.tileQueue.enqueue([L,h,c.getTileCoordCenter(S),_]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,t,r,i,s,o,a,l,c,u,h){}renderTileMask(e,t,r,i){}drawTile_(e,t,r,i,s,o,a){if(!t.ready)return;const c=t.tile.tileCoord,u=qt(c),h=u in o?o[u]:1,f=a.getResolution(r),d=Ze(a.getTileSize(r),this.tempSize_),g=a.getOrigin(r),p=a.getTileCoordExtent(c),m=h<1?-1:ha(r);h<1&&(e.animate=!0);const y=e.viewState,_=y.center[0],x=y.center[1],w=d[0]+2*i,S=d[1]+2*i,T=w/S,R=(_-g[0])/(d[0]*f),L=(g[1]-x)/(d[1]*f),I=y.resolution/f,C=c[1],j=c[2];Zu(this.tileTransform_),Eo(this.tileTransform_,2/(e.size[0]*I/w),-2/(e.size[1]*I/w)),Yu(this.tileTransform_,y.rotation),Eo(this.tileTransform_,1,1/T),fs(this.tileTransform_,(d[0]*(C-R)-i)/w,(d[1]*(j-L)-i)/S),this.renderTile(t,this.tileTransform_,e,s,f,d,g,p,m,i,h)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const r=e.viewState,i=this.getLayer(),s=i.getRenderSource(),o=s.getTileGridForProjection(r.projection),a=s.getGutterForProjection(r.projection),l=pi(e,e.extent),c=o.getZForResolution(r.resolution,s.zDirection),u=Vp(),h=i.getPreload();if(e.nextExtent){const x=o.getZForResolution(r.nextResolution,s.zDirection),w=pi(e,e.nextExtent);this.enqueueTiles(e,w,x,u,h)}this.enqueueTiles(e,l,c,u,0),h>0&&setTimeout(()=>{this.enqueueTiles(e,l,c-1,u,h-1)},0);const f={};let d=!1;const g=u.representationsByZ;if(c in g){const x=ne(this),w=e.time;for(const S of g[c]){const T=S.tile;if((T instanceof ts||T instanceof rs)&&T.getState()===he.EMPTY)continue;const R=T.tileCoord;if(S.ready){const C=T.getAlpha(x,w);if(C===1){T.endTransition(x);continue}d=!0;const j=qt(R);f[j]=C}if(this.renderComplete=!1,this.findAltTiles_(o,R,c+1,u))continue;const I=o.getMinZoom();for(let C=c-1;C>=I&&!this.findAltTiles_(o,R,C,u);--C);}}const p=Object.keys(g).map(Number).sort(hh);if(this.beforeTilesMaskRender(e))for(let x=0,w=p.length;x<w;++x){const S=p[x];for(const T of g[S]){const R=T.tile.tileCoord;if(qt(R)in f)continue;const I=o.getTileCoordExtent(R);this.renderTileMask(T,S,I,ha(S))}}this.beforeTilesRender(e,d);for(let x=0,w=p.length;x<w;++x){const S=p[x];for(const T of g[S]){const R=T.tile.tileCoord;qt(R)in f||this.drawTile_(e,T,S,a,l,f,o)}}if(c in g)for(const x of g[c]){const w=x.tile.tileCoord;qt(w)in f&&this.drawTile_(e,x,c,a,l,f,o)}this.beforeFinalize(e),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const y=this.helper.getCanvas(),_=this.tileRepresentationCache;for(;_.canExpireCache();)_.pop().dispose();return this.postRender(t,e),y}beforeFinalize(e){}findAltTiles_(e,t,r,i){const s=e.getTileRangeForTileCoordAndZ(t,r,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let c=s.minX;c<=s.maxX;++c)for(let u=s.minY;u<=s.maxY;++u){const h=Bi(l,[r,c,u]);let f=!1;if(a.containsKey(h)){const d=a.get(h);d.ready&&!fa(i,d.tile)&&(da(i,d,r),f=!0)}f||(o=!1)}return o}clearCache(){super.clearCache();const e=this.tileRepresentationCache;e.forEach(t=>t.dispose()),e.clear()}afterHelperCreated(){super.afterHelperCreated(),this.tileRepresentationCache.forEach(e=>e.setHelper(this.helper))}disposeInternal(){super.disposeInternal(),delete this.frameState}}const B={...$p,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},wn={TEXTURE_COORD:"a_textureCoord"},Xp=[{name:wn.TEXTURE_COORD,size:2,type:de.FLOAT}];class Hp extends jp{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new or(tn,Cs),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){if(super.reset(e),this.helper){const t=this.helper.getGL();for(const r of this.paletteTextures_)r.delete(t)}if(this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_);const t=this.helper.getGL();for(const r of this.paletteTextures_)r.getTexture(t)}}afterHelperCreated(){super.afterHelperCreated();const e=this.helper.getGL();for(const t of this.paletteTextures_)t.getTexture(e);this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}removeHelper(){if(this.helper){const e=this.helper.getGL();for(const t of this.paletteTextures_)t.delete(e)}super.removeHelper()}createTileRepresentation(e){return new kp(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,r,i,s,o,a,l,c,u,h){const f=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(Xp);let d=0;for(;d<e.textures.length;){const T=`${B.TILE_TEXTURE_ARRAY}[${d}]`;this.helper.bindTexture(e.textures[d],d,T),++d}for(let T=0;T<this.paletteTextures_.length;++T){const R=this.paletteTextures_[T],L=R.getTexture(f);this.helper.bindTexture(L,d,R.name),++d}const g=r.viewState,p=o[0]+2*u,m=o[1]+2*u,_=e.tile.tileCoord,x=_[1],w=_[2];this.helper.setUniformMatrixValue(B.TILE_TRANSFORM,Ln(this.tempMat4,t)),this.helper.setUniformFloatValue(B.TRANSITION_ALPHA,h),this.helper.setUniformFloatValue(B.DEPTH,c);let S=i;u>0&&(S=l,kt(S,i,S)),this.helper.setUniformFloatVec4(B.RENDER_EXTENT,S),this.helper.setUniformFloatValue(B.RESOLUTION,g.resolution),this.helper.setUniformFloatValue(B.ZOOM,g.zoom),this.helper.setUniformFloatValue(B.TEXTURE_PIXEL_WIDTH,p),this.helper.setUniformFloatValue(B.TEXTURE_PIXEL_HEIGHT,m),this.helper.setUniformFloatValue(B.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(B.TEXTURE_ORIGIN_X,a[0]+x*o[0]*s-u*s),this.helper.setUniformFloatValue(B.TEXTURE_ORIGIN_Y,a[1]-w*o[1]*s+u*s),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const r=this.frameState;if(!r)return null;const i=this.getLayer(),s=dt(r.pixelToCoordinateTransform,e.slice()),o=r.viewState,a=i.getExtent();if(a&&!Qt(il(a,o.projection),s))return null;const l=i.getSources(ms([s]),o.resolution);let c,u,h;for(c=l.length-1;c>=0;--c)if(u=l[c],u.getState()==="ready"){if(h=u.getTileGridForProjection(o.projection),u.getWrapX())break;const d=h.getExtent();if(!d||Qt(d,s))break}if(c<0)return null;const f=this.tileRepresentationCache;for(let d=h.getZForResolution(o.resolution);d>=h.getMinZoom();--d){const g=h.getTileCoordForCoordAndZ(s,d),p=Bi(u,g);if(!f.containsKey(p))continue;const m=f.get(p),y=m.tile;if((y instanceof ts||y instanceof rs)&&y.getState()===he.EMPTY)return null;if(!m.loaded)continue;const _=h.getOrigin(d),x=Ze(h.getTileSize(d)),w=h.getResolution(d),S=(s[0]-_[0])/w-g[1]*x[0],T=(_[1]-s[1])/w-g[2]*x[1];return m.getPixelData(S,T)}return null}disposeInternal(){const e=this.helper;if(e){const t=e.getGL();for(const r of this.paletteTextures_)r.delete(t);this.paletteTextures_.length=0,t.deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)}super.disposeInternal(),delete this.indices_}}function Wp(n,e){return`operator_${n}_${Object.keys(e.functions).length}`}function Gt(n){const e=n.toString();return e.includes(".")?e:e+".0"}function Fs(n){if(n.length<2||n.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${n.length}(${n.map(Gt).join(", ")})`}function Tn(n){const e=Ur(n),t=e.length>3?e[3]:1;return Fs([e[0]/255,e[1]/255,e[2]/255,t])}function Zp(n){const e=Ze(n);return Fs(e)}const mi={};let Yp=0;function er(n){return n in mi||(mi[n]=Yp++),mi[n]}function ct(n){return Gt(er(n))}function Os(n){return"u_var_"+n}function Gi(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,featureId:!1,geometryType:!1}}const _i="getBandValue",Yl="u_paletteTextures",ql="featureId",Kl="geometryType";function qp(n,e,t,r){const i=fu(n,e,t);return Ms(i,e,r)}function q(n){return(e,t,r)=>{const i=t.args.length,s=new Array(i);for(let o=0;o<i;++o)s[o]=Ms(t.args[o],r,e);return n(s,e)}}const Kp={[k.Get]:(n,e)=>{const r=e.args[0].value;return r in n.properties||(n.properties[r]={name:r,type:e.type}),(n.inFragmentShader?"v_prop_":"a_prop_")+r},[k.Id]:n=>(n.featureId=!0,(n.inFragmentShader?"v_":"a_")+ql),[k.GeometryType]:n=>(n.geometryType=!0,(n.inFragmentShader?"v_":"a_")+Kl),[k.LineMetric]:()=>"currentLineMetric",[k.Var]:(n,e)=>{const r=e.args[0].value;return r in n.variables||(n.variables[r]={name:r,type:e.type}),Os(r)},[k.Resolution]:()=>"u_resolution",[k.Zoom]:()=>"u_zoom",[k.Time]:()=>"u_time",[k.Any]:q(n=>`(${n.join(" || ")})`),[k.All]:q(n=>`(${n.join(" && ")})`),[k.Not]:q(([n])=>`(!${n})`),[k.Equal]:q(([n,e])=>`(${n} == ${e})`),[k.NotEqual]:q(([n,e])=>`(${n} != ${e})`),[k.GreaterThan]:q(([n,e])=>`(${n} > ${e})`),[k.GreaterThanOrEqualTo]:q(([n,e])=>`(${n} >= ${e})`),[k.LessThan]:q(([n,e])=>`(${n} < ${e})`),[k.LessThanOrEqualTo]:q(([n,e])=>`(${n} <= ${e})`),[k.Multiply]:q(n=>`(${n.join(" * ")})`),[k.Divide]:q(([n,e])=>`(${n} / ${e})`),[k.Add]:q(n=>`(${n.join(" + ")})`),[k.Subtract]:q(([n,e])=>`(${n} - ${e})`),[k.Clamp]:q(([n,e,t])=>`clamp(${n}, ${e}, ${t})`),[k.Mod]:q(([n,e])=>`mod(${n}, ${e})`),[k.Pow]:q(([n,e])=>`pow(${n}, ${e})`),[k.Abs]:q(([n])=>`abs(${n})`),[k.Floor]:q(([n])=>`floor(${n})`),[k.Ceil]:q(([n])=>`ceil(${n})`),[k.Round]:q(([n])=>`floor(${n} + 0.5)`),[k.Sin]:q(([n])=>`sin(${n})`),[k.Cos]:q(([n])=>`cos(${n})`),[k.Atan]:q(([n,e])=>e!==void 0?`atan(${n}, ${e})`:`atan(${n})`),[k.Sqrt]:q(([n])=>`sqrt(${n})`),[k.Match]:q(n=>{const e=n[0],t=n[n.length-1];let r=null;for(let i=n.length-3;i>=1;i-=2){const s=n[i],o=n[i+1];r=`(${e} == ${s} ? ${o} : ${r||t})`}return r}),[k.Between]:q(([n,e,t])=>`(${n} >= ${e} && ${n} <= ${t})`),[k.Interpolate]:q(([n,e,...t])=>{let r="";for(let i=0;i<t.length-2;i+=2){const s=t[i],o=r||t[i+1],a=t[i+2],l=t[i+3];let c;n===Gt(1)?c=`(${e} - ${s}) / (${a} - ${s})`:c=`(pow(${n}, (${e} - ${s})) - 1.0) / (pow(${n}, (${a} - ${s})) - 1.0)`,r=`mix(${o}, ${l}, clamp(${c}, 0.0, 1.0))`}return r}),[k.Case]:q(n=>{const e=n[n.length-1];let t=null;for(let r=n.length-3;r>=0;r-=2){const i=n[r],s=n[r+1];t=`(${i} ? ${s} : ${t||e})`}return t}),[k.In]:q(([n,...e],t)=>{const r=Wp("in",t),i=[];for(let s=0;s<e.length;s+=1)i.push(`  if (inputValue == ${e[s]}) { return true; }`);return t.functions[r]=`bool ${r}(float inputValue) {
${i.join(`
`)}
  return false;
}`,`${r}(${n})`}),[k.Array]:q(n=>`vec${n.length}(${n.join(", ")})`),[k.Color]:q(n=>{if(n.length===1)return`vec4(vec3(${n[0]} / 255.0), 1.0)`;if(n.length===2)return`vec4(vec3(${n[0]} / 255.0), ${n[1]})`;const e=n.slice(0,3).map(r=>`${r} / 255.0`);if(n.length===3)return`vec4(${e.join(", ")}, 1.0)`;const t=n[3];return`vec4(${e.join(", ")}, ${t})`}),[k.Band]:q(([n,e,t],r)=>{if(!(_i in r.functions)){let i="";const s=r.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let l=o%4;o===s-1&&l===1&&(l=3);const c=`${B.TILE_TEXTURE_ARRAY}[${a}]`;i+=`  if (band == ${o+1}.0) {
    return texture2D(${c}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}r.functions[_i]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${B.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${B.TEXTURE_PIXEL_HEIGHT};
${i}
}`}return`${_i}(${n}, ${e??"0.0"}, ${t??"0.0"})`}),[k.Palette]:(n,e)=>{const[t,...r]=e.args,i=r.length,s=new Uint8Array(i*4);for(let c=0;c<r.length;c++){const u=r[c].value,h=Ur(u),f=c*4;s[f]=h[0],s[f+1]=h[1],s[f+2]=h[2],s[f+3]=h[3]*255}n.paletteTextures||(n.paletteTextures=[]);const o=`${Yl}[${n.paletteTextures.length}]`,a=new Up(o,s);n.paletteTextures.push(a);const l=Ms(t,ie,n);return`texture2D(${o}, vec2((${l} + 0.5) / ${i}.0, 0.5))`}};function Ms(n,e,t){if(n instanceof du){const r=Kp[n.operator];if(r===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(n.operator)}`);return r(t,n,e)}if((n.type&ie)>0)return Gt(n.value);if((n.type&Ya)>0)return n.value.toString();if((n.type&Br)>0)return ct(n.value.toString());if((n.type&Ae)>0)return Tn(n.value);if((n.type&Rt)>0)return Fs(n.value);if((n.type&hr)>0)return Zp(n.value);throw new Error(`Unexpected expression ${n.value} (expected type ${gu(e)})`)}function Jp(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const Xt=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;
float currentLineMetric = 0.; // an actual value will be used in the stroke shaders
`,Ht=Jp();class Jl{constructor(){this.uniforms_=[],this.attributes_=[],this.varyings_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${Gt(Ht["circle-radius"])} + ${Gt(Ht["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=Tn(Ht["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=Gt(Ht["stroke-width"]),this.strokeColorExpression_=Tn(Ht["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=ct("round"),this.strokeJoinExpression_=ct("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=Tn(Ht["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(e){return this.uniforms_.push(e),this}addAttribute(e){return this.attributes_.push(e),this}addVarying(e,t,r){return this.varyings_.push({name:e,type:t,expression:r}),this}setSymbolSizeExpression(e){return this.hasSymbol_=!0,this.symbolSizeExpression_=e,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(e){return this.symbolRotationExpression_=e,this}setSymbolOffsetExpression(e){return this.symbolOffsetExpression_=e,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(e){return this.hasSymbol_=!0,this.symbolColorExpression_=e,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(e){return this.texCoordExpression_=e,this}setFragmentDiscardExpression(e){return this.discardExpression_=e,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(e){return this.symbolRotateWithView_=e,this}setStrokeWidthExpression(e){return this.hasStroke_=!0,this.strokeWidthExpression_=e,this}setStrokeColorExpression(e){return this.hasStroke_=!0,this.strokeColorExpression_=e,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(e){return this.strokeOffsetExpression_=e,this}setStrokeCapExpression(e){return this.strokeCapExpression_=e,this}setStrokeJoinExpression(e){return this.strokeJoinExpression_=e,this}setStrokeMiterLimitExpression(e){return this.strokeMiterLimitExpression_=e,this}setStrokeDistanceFieldExpression(e){return this.strokeDistanceFieldExpression_=e,this}setFillColorExpression(e){return this.hasFill_=!0,this.fillColorExpression_=e,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(e){this.vertexShaderFunctions_.includes(e)||this.vertexShaderFunctions_.push(e)}addFragmentShaderFunction(e){this.fragmentShaderFunctions_.includes(e)||this.fragmentShaderFunctions_.push(e)}getSymbolVertexShader(){return this.hasSymbol_?`${Xt}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec4 a_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx;
  if (a_index == 0.0) {
    offsetPx -= halfSizePx;
  } else if (a_index == 1.0) {
    offsetPx += halfSizePx * vec2(1., -1.);
  } else if (a_index == 2.0) {
    offsetPx += halfSizePx;
  } else {
    offsetPx += halfSizePx * vec2(-1., 1.);
  }
  float angle = ${this.symbolRotationExpression_};
  ${this.symbolRotateWithView_?"angle += u_rotation;":""}
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;
  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;
  v_texCoord = vec2(u, v);
  v_hitColor = a_hitColor;
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y); 
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${Xt}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${Xt}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute float a_measureStart;
attribute float a_measureEnd;
attribute float a_parameters;
attribute float a_distance;
attribute vec2 a_joinAngles;
attribute vec4 a_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distanceOffsetPx;
varying float v_measureStart;
varying float v_measureEnd;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);
  currentLineMetric = vertexNumber < 1.5 ? a_measureStart : a_measureEnd;
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)
  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);
  
  // compute current vertex position
  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;
  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;
  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;
  vec2 joinDirection;
  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${ca} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStart = segmentStartPx;
  v_segmentEnd = segmentEndPx;
  v_width = lineWidth;
  v_hitColor = a_hitColor;
  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);
  v_measureStart = a_measureStart;
  v_measureEnd = a_measureEnd;
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${Xt}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distanceOffsetPx;
varying float v_measureStart;
varying float v_measureEnd;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${ca}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${ct("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${ct("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${ct("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${ct("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

void main(void) {
  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPoint);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif

  float segmentLength = length(v_segmentEnd - v_segmentStart);
  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPoint = currentPoint - v_segmentStart;
  float lengthToPoint = max(0., min(dot(segmentTangent, startToPoint), segmentLength));
  float currentLengthPx = lengthToPoint + v_distanceOffsetPx; 
  float currentRadiusPx = abs(dot(segmentNormal, startToPoint));
  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;
  currentLineMetric = mix(v_measureStart, v_measureEnd, lengthToPoint / segmentLength);

  if (${this.discardExpression_}) { discard; }

  vec4 color = ${this.strokeColorExpression_};
  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);
  float distance = max(
    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distance = max(distance, ${this.strokeDistanceFieldExpression_});
  color.a *= smoothstep(0.5, -0.5, distance);
  gl_FragColor = color;
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${Xt}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute vec4 a_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec4 v_hitColor;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_hitColor = a_hitColor;
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${Xt}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec4 v_hitColor;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_};
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}}const Ve={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},Qp=["#00f","#0ff","#0f0","#ff0","#f00"];class em extends Zn{constructor(e){e=e||{};const t=Object.assign({},e);delete t.gradient,delete t.radius,delete t.blur,delete t.weight,super(t),this.gradient_=null,this.addChangeListener(Ve.GRADIENT,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:Qp),this.setBlur(e.blur!==void 0?e.blur:15),this.setRadius(e.radius!==void 0?e.radius:8);const r=e.weight?e.weight:"weight";this.weightFunction_=typeof r=="string"?i=>i.get(r):r,this.setRenderOrder(null)}getBlur(){return this.get(Ve.BLUR)}getGradient(){return this.get(Ve.GRADIENT)}getRadius(){return this.get(Ve.RADIUS)}handleGradientChanged_(){this.gradient_=tm(this.getGradient())}setBlur(e){this.set(Ve.BLUR,e)}setGradient(e){this.set(Ve.GRADIENT,e)}setRadius(e){this.set(Ve.RADIUS,e)}createRenderer(){const e=new Jl().addAttribute("float a_weight").addVarying("v_weight","float","a_weight").addUniform("float u_size").addUniform("float u_blurSlope").setSymbolSizeExpression("vec2(u_size)").setSymbolColorExpression("vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * u_blurSlope) * v_weight)");return new Wl(this,{className:this.getClassName(),attributes:[{name:"weight",callback:t=>{const r=this.weightFunction_(t);return r!==void 0?ue(r,0,1):1}}],uniforms:{u_size:()=>(this.get(Ve.RADIUS)+this.get(Ve.BLUR))*2,u_blurSlope:()=>this.get(Ve.RADIUS)/Math.max(1,this.get(Ve.BLUR))},hitDetectionEnabled:!0,vertexShader:e.getSymbolVertexShader(),fragmentShader:e.getSymbolFragmentShader(),postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}renderDeclutter(){}}function tm(n){const r=zt(1,256),i=r.createLinearGradient(0,0,1,256),s=1/(n.length-1);for(let o=0,a=n.length;o<a;++o)i.addColorStop(o*s,n[o]);return r.fillStyle=i,r.fillRect(0,0,1,256),r.canvas}class rm extends pu{constructor(e){super(e),this.vectorRenderer_=new mu(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=be(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return Promise.resolve([]);const t=dt(this.coordinateToVectorPixelTransform_,dt(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(t)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){const t=e.pixelRatio,r=e.viewState,i=r.resolution,s=e.viewHints,o=this.vectorRenderer_;let a=e.extent;this.layerImageRatio_!==1&&(a=a.slice(0),ul(a,this.layerImageRatio_));const l=De(a)/i,c=vt(a)/i;if(!s[St.ANIMATING]&&!s[St.INTERACTING]&&!gs(a)){o.useContainer(null,null);const u=o.context,h=e.layerStatesArray[e.layerIndex],f=Object.assign({},h,{opacity:1}),d=Object.assign({},e,{extent:a,size:[l,c],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[f],layerIndex:0,declutter:null}),g=this.getLayer().getDeclutter();g&&(d.declutter={[g]:new _u(9)});let p=!0;const m=new ys(a,i,t,u.canvas,function(y){o.prepareFrame(d)&&o.replayGroupChanged&&(o.clipping=!1,o.renderFrame(d,null)&&(o.renderDeclutter(d),o.renderDeferred(d),p=!1),y())});m.addEventListener(Ie.CHANGE,()=>{if(m.getState()!==Nt.LOADED)return;this.image=p?null:m;const y=m.getPixelRatio(),_=yu(m.getResolution())*t/y;this.renderedResolution=_,this.coordinateToVectorPixelTransform_=hs(this.coordinateToVectorPixelTransform_,l/2,c/2,1/_,-1/_,0,-r.center[0],-r.center[1])}),m.load()}return this.image&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!!this.image}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,t,r,i,s){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,r,i,s):super.forEachFeatureAtCoordinate(e,t,r,i,s)}}class nm extends Zn{constructor(e){e=e||{};const t=Object.assign({},e);delete t.imageRatio,super(t),this.imageRatio_=e.imageRatio!==void 0?e.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new rm(this)}}function U(n,e,t){const r=bu();return qp(e,t,r,n)}function im(n){const e=Ur(n),t=e[0]*256,r=e[1],i=e[2]*256,s=Math.round(e[3]*255);return[t+r,i+s]}const sm=`vec4 unpackColor(vec2 packedColor) {
  return vec4(
    fract(floor(packedColor[0] / 256.0) / 256.0),
    fract(packedColor[0] / 256.0),
    fract(floor(packedColor[1] / 256.0) / 256.0),
    fract(packedColor[1] / 256.0)
  );
}`;function zi(n){return n===Ae||n===hr?2:n===Rt?4:1}function mn(n){const e=zi(n);return e>1?`vec${e}`:"float"}function Un(n){return(JSON.stringify(n).split("").reduce((t,r)=>(t<<5)-t+r.charCodeAt(0),0)>>>0).toString()}function Ns(n,e,t,r){if(`${r}radius`in n&&r!=="icon-"){let i=U(t,n[`${r}radius`],ie);if(`${r}radius2`in n){const s=U(t,n[`${r}radius2`],ie);i=`max(${i}, ${s})`}`${r}stroke-width`in n&&(i=`(${i} + ${U(t,n[`${r}stroke-width`],ie)} * 0.5)`),e.setSymbolSizeExpression(`vec2(${i} * 2. + 0.5)`)}if(`${r}scale`in n){const i=U(t,n[`${r}scale`],hr);e.setSymbolSizeExpression(`${e.getSymbolSizeExpression()} * ${i}`)}`${r}displacement`in n&&e.setSymbolOffsetExpression(U(t,n[`${r}displacement`],Rt)),`${r}rotation`in n&&e.setSymbolRotationExpression(U(t,n[`${r}rotation`],ie)),`${r}rotate-with-view`in n&&e.setSymbolRotateWithView(!!n[`${r}rotate-with-view`])}function Ql(n,e,t,r,i){let s="vec4(0.)";if(e!==null&&(s=e),t!==null&&r!==null){const l=`smoothstep(-${r} + 0.63, -${r} - 0.58, ${n})`;s=`mix(${t}, ${s}, ${l})`}const o=`(1.0 - smoothstep(-0.63, 0.58, ${n}))`;let a=`${s} * vec4(1.0, 1.0, 1.0, ${o})`;return i!==null&&(a=`${a} * vec4(1.0, 1.0, 1.0, ${i})`),a}function Ds(n,e,t,r,i){const s=new Image;s.crossOrigin=n[`${r}cross-origin`]===void 0?"anonymous":n[`${r}cross-origin`],s.src=n[`${r}src`],t[`u_texture${i}_size`]=()=>s.complete?[s.width,s.height]:[0,0],e.addUniform(`vec2 u_texture${i}_size`);const o=`u_texture${i}_size`;return t[`u_texture${i}`]=s,e.addUniform(`sampler2D u_texture${i}`),o}function Us(n,e,t,r,i){let s=U(t,n[`${e}offset`],Rt);if(`${e}offset-origin`in n)switch(n[`${e}offset-origin`]){case"top-right":s=`vec2(${r}.x, 0.) + ${i} * vec2(-1., 0.) + ${s} * vec2(-1., 1.)`;break;case"bottom-left":s=`vec2(0., ${r}.y) + ${i} * vec2(0., -1.) + ${s} * vec2(1., -1.)`;break;case"bottom-right":s=`${r} - ${i} - ${s}`;break}return s}function om(n,e,t,r,i){i.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,Ns(n,e,r,"circle-");let s=null;"circle-opacity"in n&&(s=U(i,n["circle-opacity"],ie));let o="coordsPx";"circle-scale"in n&&(o=`coordsPx / ${U(i,n["circle-scale"],hr)}`);let a=null;"circle-fill-color"in n&&(a=U(i,n["circle-fill-color"],Ae));let l=null;"circle-stroke-color"in n&&(l=U(i,n["circle-stroke-color"],Ae));let c=U(i,n["circle-radius"],ie),u=null;"circle-stroke-width"in n&&(u=U(i,n["circle-stroke-width"],ie),c=`(${c} + ${u} * 0.5)`);const h=`circleDistanceField(${o}, ${c})`,f=Ql(h,a,l,u,s);e.setSymbolColorExpression(f)}function am(n,e,t,r,i){i.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,i.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,i.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,Ns(n,e,r,"shape-");let s=null;"shape-opacity"in n&&(s=U(i,n["shape-opacity"],ie));let o="coordsPx";"shape-scale"in n&&(o=`coordsPx / ${U(i,n["shape-scale"],hr)}`);let a=null;"shape-fill-color"in n&&(a=U(i,n["shape-fill-color"],Ae));let l=null;"shape-stroke-color"in n&&(l=U(i,n["shape-stroke-color"],Ae));let c=null;"shape-stroke-width"in n&&(c=U(i,n["shape-stroke-width"],ie));const u=U(i,n["shape-points"],ie);let h="0.";"shape-angle"in n&&(h=U(i,n["shape-angle"],ie));let f,d=U(i,n["shape-radius"],ie);if(c!==null&&(d=`${d} + ${c} * 0.5`),"shape-radius2"in n){let p=U(i,n["shape-radius2"],ie);c!==null&&(p=`${p} + ${c} * 0.5`),f=`starDistanceField(${o}, ${u}, ${d}, ${p}, ${h})`}else f=`regularDistanceField(${o}, ${u}, ${d}, ${h})`;const g=Ql(f,a,l,c,s);e.setSymbolColorExpression(g)}function lm(n,e,t,r,i){let s="vec4(1.0)";"icon-color"in n&&(s=U(i,n["icon-color"],Ae)),"icon-opacity"in n&&(s=`${s} * vec4(1.0, 1.0, 1.0, ${U(i,n["icon-opacity"],ie)})`);const o=Un(n["icon-src"]),a=Ds(n,e,t,"icon-",o);if(e.setSymbolColorExpression(`${s} * texture2D(u_texture${o}, v_texCoord)`).setSymbolSizeExpression(a),"icon-width"in n&&"icon-height"in n&&e.setSymbolSizeExpression(`vec2(${U(r,n["icon-width"],ie)}, ${U(r,n["icon-height"],ie)})`),"icon-offset"in n&&"icon-size"in n){const l=U(r,n["icon-size"],Rt),c=e.getSymbolSizeExpression();e.setSymbolSizeExpression(l);const u=Us(n,"icon-",r,"v_quadSizePx",l);e.setTextureCoordinateExpression(`(vec4((${u}).xyxy) + vec4(0., 0., ${l})) / (${c}).xyxy`)}if(Ns(n,e,r,"icon-"),"icon-anchor"in n){const l=U(r,n["icon-anchor"],Rt);let c="1.0";"icon-scale"in n&&(c=U(r,n["icon-scale"],hr));let u;n["icon-anchor-x-units"]==="pixels"&&n["icon-anchor-y-units"]==="pixels"?u=`${l} * ${c}`:n["icon-anchor-x-units"]==="pixels"?u=`${l} * vec2(vec2(${c}).x, v_quadSizePx.y)`:n["icon-anchor-y-units"]==="pixels"?u=`${l} * vec2(v_quadSizePx.x, vec2(${c}).x)`:u=`${l} * v_quadSizePx`;let h=`v_quadSizePx * vec2(0.5, -0.5) + ${u} * vec2(-1., 1.)`;if("icon-anchor-origin"in n)switch(n["icon-anchor-origin"]){case"top-right":h=`v_quadSizePx * -0.5 + ${u}`;break;case"bottom-left":h=`v_quadSizePx * 0.5 - ${u}`;break;case"bottom-right":h=`v_quadSizePx * vec2(-0.5, 0.5) + ${u} * vec2(1., -1.)`;break}e.setSymbolOffsetExpression(`${e.getSymbolOffsetExpression()} + ${h}`)}}function cm(n,e,t,r,i){if("stroke-color"in n&&e.setStrokeColorExpression(U(i,n["stroke-color"],Ae)),"stroke-pattern-src"in n){const s=Un(n["stroke-pattern-src"]),o=Ds(n,e,t,"stroke-pattern-",s);let a=o,l="vec2(0.)";"stroke-pattern-offset"in n&&"stroke-pattern-size"in n&&(a=U(i,n["stroke-pattern-size"],Rt),l=Us(n,"stroke-pattern-",i,o,a));let c="0.";"stroke-pattern-spacing"in n&&(c=U(i,n["stroke-pattern-spacing"],ie)),i.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = currentLengthPx * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return texture2D(texture, texCoord);
}`;const u=`u_texture${s}`;let h="1.";"stroke-color"in n&&(h=e.getStrokeColorExpression()),e.setStrokeColorExpression(`${h} * sampleStrokePattern(${u}, ${o}, ${l}, ${a}, ${c}, currentLengthPx, currentRadiusRatio, v_width)`)}if("stroke-width"in n&&e.setStrokeWidthExpression(U(r,n["stroke-width"],ie)),"stroke-offset"in n&&e.setStrokeOffsetExpression(U(r,n["stroke-offset"],ie)),"stroke-line-cap"in n&&e.setStrokeCapExpression(U(r,n["stroke-line-cap"],Br)),"stroke-line-join"in n&&e.setStrokeJoinExpression(U(r,n["stroke-line-join"],Br)),"stroke-miter-limit"in n&&e.setStrokeMiterLimitExpression(U(r,n["stroke-miter-limit"],ie)),"stroke-line-dash"in n){i.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${ct("square")}) {
    distanceSegment -= v_width * 0.5;
  } else if (capType == ${ct("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - v_width * 0.5);
  }
  return distanceSegment;
}`;let s=n["stroke-line-dash"].map(d=>U(i,d,ie));s.length%2===1&&(s=[...s,...s]);let o="0.";"stroke-line-dash-offset"in n&&(o=U(r,n["stroke-line-dash-offset"],ie));const l=`dashDistanceField_${Un(n["stroke-line-dash"])}`,c=s.map((d,g)=>`float dashLength${g} = ${d};`),u=s.map((d,g)=>`dashLength${g}`).join(" + ");let h="0.",f=`getSingleDashDistance(distance, radius, ${h}, dashLength0, totalDashLength, capType)`;for(let d=2;d<s.length;d+=2)h=`${h} + dashLength${d-2} + dashLength${d-1}`,f=`min(${f}, getSingleDashDistance(distance, radius, ${h}, dashLength${d}, totalDashLength, capType))`;i.functions[l]=`float ${l}(float distance, float radius, float capType) {
  ${c.join(`
  `)}
  float totalDashLength = ${u};
  return ${f};
}`,e.setStrokeDistanceFieldExpression(`${l}(currentLengthPx + ${o}, currentRadiusPx, capType)`)}}function um(n,e,t,r,i){if("fill-color"in n&&e.setFillColorExpression(U(i,n["fill-color"],Ae)),"fill-pattern-src"in n){const s=Un(n["fill-pattern-src"]),o=Ds(n,e,t,"fill-pattern-",s);let a=o,l="vec2(0.)";"fill-pattern-offset"in n&&"fill-pattern-size"in n&&(a=U(i,n["fill-pattern-size"],Rt),l=Us(n,"fill-pattern-",i,o,a)),i.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return texture2D(texture, (samplePos + textureOffset) / textureSize);
}`;const c=`u_texture${s}`;let u="1.";"fill-color"in n&&(u=e.getFillColorExpression()),e.setFillColorExpression(`${u} * sampleFillPattern(${c}, ${o}, ${l}, ${a}, pxOrigin, pxPos)`)}}function ec(n,e){const t=Gi(),r={...Gi(),inFragmentShader:!0,variables:t.variables},i=new Jl,s={};if("icon-src"in n?lm(n,i,s,t,r):"shape-points"in n?am(n,i,s,t,r):"circle-radius"in n&&om(n,i,s,t,r),cm(n,i,s,t,r),um(n,i,s,t,r),n.filter){const l=U(r,n.filter,Ya);i.setFragmentDiscardExpression(`!${l}`)}for(const l in r.variables){const c=r.variables[l],u=Os(c.name);let h=mn(c.type);c.type===Ae&&(h="vec4"),i.addUniform(`${h} ${u}`),s[u]=()=>{const f=e[c.name];return typeof f=="number"?f:typeof f=="boolean"?f?1:0:c.type===Ae?Ur(f||"#eee"):typeof f=="string"?er(f):f}}for(const l in r.properties){const c=r.properties[l];t.properties[l]||(t.properties[l]=c);let u=mn(c.type),h=`a_prop_${c.name}`;c.type===Ae&&(u="vec4",h=`unpackColor(${h})`,i.addVertexShaderFunction(sm)),i.addVarying(`v_prop_${c.name}`,u,h)}for(const l in t.properties){const c=t.properties[l];i.addAttribute(`${mn(c.type)} a_prop_${c.name}`)}for(const l in t.functions)i.addVertexShaderFunction(t.functions[l]);for(const l in r.functions)i.addFragmentShaderFunction(r.functions[l]);const o={};for(const l in t.properties){const c=t.properties[l],u=h=>{const f=h.get(c.name);return c.type===Ae?im([...Ur(f||"#eee")]):typeof f=="string"?er(f):typeof f=="boolean"?f?1:0:f};o[`prop_${c.name}`]={size:zi(c.type),callback:u}}function a(l,c,u,h){const f=t[l],d=r[l];if(!f&&!d)return;const g=mn(u),p=zi(u);i.addAttribute(`${g} a_${c}`),d&&i.addVarying(`v_${c}`,g,`a_${c}`),o[c]={size:p,callback:h}}return a("geometryType",Kl,Br,l=>er(xu(l.getGeometry()))),a("featureId",ql,Br|ie,l=>{const c=l.getId()??null;return typeof c=="string"?er(c):c}),{builder:i,attributes:o,uniforms:s}}class hm extends ns{constructor(e){const t=Object.assign({},e);super(t),this.styleVariables_=e.variables||{},this.parseResult_=ec(e.style,this.styleVariables_),this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){const e=Object.keys(this.parseResult_.attributes).map(t=>({name:t,...this.parseResult_.attributes[t]}));return new Wl(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:e})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}function ga(n,e){const t=`
    attribute vec2 ${wn.TEXTURE_COORD};
    uniform mat4 ${B.TILE_TRANSFORM};
    uniform float ${B.TEXTURE_PIXEL_WIDTH};
    uniform float ${B.TEXTURE_PIXEL_HEIGHT};
    uniform float ${B.TEXTURE_RESOLUTION};
    uniform float ${B.TEXTURE_ORIGIN_X};
    uniform float ${B.TEXTURE_ORIGIN_Y};
    uniform float ${B.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${wn.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${B.TEXTURE_ORIGIN_X} + ${B.TEXTURE_RESOLUTION} * ${B.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${B.TEXTURE_ORIGIN_Y} - ${B.TEXTURE_RESOLUTION} * ${B.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${B.TILE_TRANSFORM} * vec4(${wn.TEXTURE_COORD}, ${B.DEPTH}, 1.0);
    }
  `,r={...Gi(),inFragmentShader:!0,bandCount:e},i=[];if(n.color!==void 0){const h=U(r,n.color,Ae);i.push(`color = ${h};`)}if(n.contrast!==void 0){const h=U(r,n.contrast,ie);i.push(`color.rgb = clamp((${h} + 1.0) * color.rgb - (${h} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(n.exposure!==void 0){const h=U(r,n.exposure,ie);i.push(`color.rgb = clamp((${h} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(n.saturation!==void 0){const h=U(r,n.saturation,ie);i.push(`
      float saturation = ${h} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(n.gamma!==void 0){const h=U(r,n.gamma,ie);i.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${h}));`)}if(n.brightness!==void 0){const h=U(r,n.brightness,ie);i.push(`color.rgb = clamp(color.rgb + ${h}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=Object.keys(r.variables).length;if(o>1&&!n.variables)throw new Error(`Missing variables in style (expected ${r.variables})`);for(let h=0;h<o;++h){const f=r.variables[Object.keys(r.variables)[h]];if(!(f.name in n.variables))throw new Error(`Missing '${f.name}' in style variables`);const d=Os(f.name);s[d]=function(){let g=n.variables[f.name];return typeof g=="string"&&(g=er(g)),g!==void 0?g:-9999999}}const a=Object.keys(s).map(function(h){return`uniform float ${h};`}),l=Math.ceil(e/4);a.push(`uniform sampler2D ${B.TILE_TEXTURE_ARRAY}[${l}];`),r.paletteTextures&&a.push(`uniform sampler2D ${Yl}[${r.paletteTextures.length}];`);const c=Object.keys(r.functions).map(function(h){return r.functions[h]}),u=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${B.RENDER_EXTENT};
    uniform float ${B.TRANSITION_ALPHA};
    uniform float ${B.TEXTURE_PIXEL_WIDTH};
    uniform float ${B.TEXTURE_PIXEL_HEIGHT};
    uniform float ${B.RESOLUTION};
    uniform float ${B.ZOOM};

    ${a.join(`
`)}

    ${c.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${B.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${B.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${B.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${B.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${B.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${i.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${B.TRANSITION_ALPHA};
    }`;return{vertexShader:t,fragmentShader:u,uniforms:s,paletteTextures:r.paletteTextures}}class Bn extends Eu{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.styleVariables_=this.style_.variables||{},this.addChangeListener(Oi.SOURCE,this.handleSourceUpdate_)}getSources(e,t){const r=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,t):this.sources_:r?[r]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache();const e=this.getSource();if(e)if(e.getState()==="loading"){const t=()=>{e.getState()==="ready"&&(e.removeEventListener("change",t),this.setStyle(this.style_))};e.addEventListener("change",t)}else this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=ga(this.style_,this.getSourceBandCount_());return new Hp(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.getCacheSize(),paletteTextures:e.paletteTextures})}renderSources(e,t){const r=this.getRenderer();let i;for(let s=0,o=t.length;s<o;++s)this.renderedSource_=t[s],r.prepareFrame(e)&&(i=r.renderFrame(e));return i}render(e,t){this.rendered=!0;const r=e.viewState,i=this.getSources(e.extent,r.resolution);let s=!0;for(let a=0,l=i.length;a<l;++a){const c=i[a],u=c.getState();if(u=="loading"){const h=()=>{c.getState()=="ready"&&(c.removeEventListener("change",h),this.changed())};c.addEventListener("change",h)}s=s&&u=="ready"}const o=this.renderSources(e,i);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=r.resolution,o;if(this.renderedResolution_>.5*r.resolution){const a=this.getSources(e.extent,this.renderedResolution_).filter(l=>!i.includes(l));if(a.length>0)return this.renderSources(e,a)}return o}setStyle(e){if(this.styleVariables_=e.variables||{},this.style_=e,this.hasRenderer()){const t=ga(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}Bn.prototype.dispose;class fm{constructor(){this.globalCounter_=0,this.refToFeature_=new Map,this.uidToRef_=new Map,this.freeGlobalRef_=[],this.polygonBatch={entries:{},geometriesCount:0,verticesCount:0,ringsCount:0},this.pointBatch={entries:{},geometriesCount:0},this.lineStringBatch={entries:{},geometriesCount:0,verticesCount:0}}addFeatures(e,t){for(let r=0;r<e.length;r++)this.addFeature(e[r],t)}addFeature(e,t){let r=e.getGeometry();r&&(t&&(r=r.clone(),r.applyTransform(t)),this.addGeometry_(r,e))}clearFeatureEntryInPointBatch_(e){const t=ne(e),r=this.pointBatch.entries[t];if(r)return this.pointBatch.geometriesCount-=r.flatCoordss.length,delete this.pointBatch.entries[t],r}clearFeatureEntryInLineStringBatch_(e){const t=ne(e),r=this.lineStringBatch.entries[t];if(r)return this.lineStringBatch.verticesCount-=r.verticesCount,this.lineStringBatch.geometriesCount-=r.flatCoordss.length,delete this.lineStringBatch.entries[t],r}clearFeatureEntryInPolygonBatch_(e){const t=ne(e),r=this.polygonBatch.entries[t];if(r)return this.polygonBatch.verticesCount-=r.verticesCount,this.polygonBatch.ringsCount-=r.ringsCount,this.polygonBatch.geometriesCount-=r.flatCoordss.length,delete this.polygonBatch.entries[t],r}addGeometry_(e,t){var i;const r=e.getType();switch(r){case"GeometryCollection":{const s=e.getGeometriesArray();for(const o of s)this.addGeometry_(o,t);break}case"MultiPolygon":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),s.getEndss(),t,ne(t),s.getStride());break}case"MultiLineString":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),s.getEnds(),t,ne(t),s.getStride());break}case"MultiPoint":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),null,t,ne(t),s.getStride());break}case"Polygon":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),s.getEnds(),t,ne(t),s.getStride());break}case"Point":{const s=e;this.addCoordinates_(r,s.getFlatCoordinates(),null,t,ne(t),s.getStride());break}case"LineString":case"LinearRing":{const s=e,o=s.getStride();this.addCoordinates_(r,s.getFlatCoordinates(),null,t,ne(t),o,(i=s.getLayout)==null?void 0:i.call(s));break}}}addCoordinates_(e,t,r,i,s,o,a){let l;switch(e){case"MultiPolygon":{const c=r;for(let u=0,h=c.length;u<h;u++){let f=c[u];const d=u>0?c[u-1]:null,g=d?d[d.length-1]:0,p=f[f.length-1];f=g>0?f.map(m=>m-g):f,this.addCoordinates_("Polygon",t.slice(g,p),f,i,s,o,a)}break}case"MultiLineString":{const c=r;for(let u=0,h=c.length;u<h;u++){const f=u>0?c[u-1]:0;this.addCoordinates_("LineString",t.slice(f,c[u]),null,i,s,o,a)}break}case"MultiPoint":for(let c=0,u=t.length;c<u;c+=o)this.addCoordinates_("Point",t.slice(c,c+2),null,i,s,null,null);break;case"Polygon":{const c=r;if(i instanceof qu){const f=Ku(t,c);if(f.length>1){this.addCoordinates_("MultiPolygon",t,f,i,s,o,a);return}}this.polygonBatch.entries[s]||(this.polygonBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[],verticesCount:0,ringsCount:0,ringsVerticesCounts:[]})),l=t.length/o;const u=r.length,h=r.map((f,d,g)=>d>0?(f-g[d-1])/o:f/o);this.polygonBatch.verticesCount+=l,this.polygonBatch.ringsCount+=u,this.polygonBatch.geometriesCount++,this.polygonBatch.entries[s].flatCoordss.push(dm(t,o)),this.polygonBatch.entries[s].ringsVerticesCounts.push(h),this.polygonBatch.entries[s].verticesCount+=l,this.polygonBatch.entries[s].ringsCount+=u;for(let f=0,d=c.length;f<d;f++){const g=f>0?c[f-1]:0;this.addCoordinates_("LinearRing",t.slice(g,c[f]),null,i,s,o,a)}break}case"Point":this.pointBatch.entries[s]||(this.pointBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[]})),this.pointBatch.geometriesCount++,this.pointBatch.entries[s].flatCoordss.push(t);break;case"LineString":case"LinearRing":this.lineStringBatch.entries[s]||(this.lineStringBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[],verticesCount:0})),l=t.length/o,this.lineStringBatch.verticesCount+=l,this.lineStringBatch.geometriesCount++,this.lineStringBatch.entries[s].flatCoordss.push(gm(t,o,a)),this.lineStringBatch.entries[s].verticesCount+=l;break}}addRefToEntry_(e,t){const r=this.uidToRef_.get(e),i=r||this.freeGlobalRef_.pop()||++this.globalCounter_;return t.ref=i,r||(this.refToFeature_.set(i,t.feature),this.uidToRef_.set(e,i)),t}returnRef_(e,t){if(!e)throw new Error("This feature has no ref: "+t);this.refToFeature_.delete(e),this.uidToRef_.delete(t),this.freeGlobalRef_.push(e)}changeFeature(e){this.removeFeature(e);const t=e.getGeometry();t&&this.addGeometry_(t,e)}removeFeature(e){let t;t=this.clearFeatureEntryInPointBatch_(e)||t,t=this.clearFeatureEntryInPolygonBatch_(e)||t,t=this.clearFeatureEntryInLineStringBatch_(e)||t,t&&this.returnRef_(t.ref,ne(t.feature))}clear(){this.polygonBatch.entries={},this.polygonBatch.geometriesCount=0,this.polygonBatch.verticesCount=0,this.polygonBatch.ringsCount=0,this.lineStringBatch.entries={},this.lineStringBatch.geometriesCount=0,this.lineStringBatch.verticesCount=0,this.pointBatch.entries={},this.pointBatch.geometriesCount=0,this.globalCounter_=0,this.freeGlobalRef_=[],this.refToFeature_.clear(),this.uidToRef_.clear()}getFeatureFromRef(e){return this.refToFeature_.get(e)}}function dm(n,e){return e===2?n:n.filter((t,r)=>r%e<2)}function gm(n,e,t){return e===3&&t==="XYM"?n:e===4?n.filter((r,i)=>i%e!==2):e===3?n.map((r,i)=>i%e!==2?r:0):new Array(n.length*1.5).fill(0).map((r,i)=>i%3===2?0:n[Math.round(i/1.5)])}function Bs(n,e,t,r){let i=0;for(const s in e){const o=e[s],a=o.callback.call(t,t.feature);n[r+i++]=a[0]??a,!(!o.size||o.size===1)&&(n[r+i++]=a[1],!(o.size<3)&&(n[r+i++]=a[2],!(o.size<4)&&(n[r+i++]=a[3])))}return i}function oi(n){return Object.keys(n).reduce((e,t)=>e+(n[t].size||1),0)}function pm(n,e,t,r){const i=(2+oi(t))*n.geometriesCount;(!e||e.length!==i)&&(e=new Float32Array(i));const s=[];let o=0;for(const a in n.entries){const l=n.entries[a];for(let c=0,u=l.flatCoordss.length;c<u;c++)s[0]=l.flatCoordss[c][0],s[1]=l.flatCoordss[c][1],dt(r,s),e[o++]=s[0],e[o++]=s[1],o+=Bs(e,t,l,o)}return e}function mm(n,e,t,r){const i=3*n.verticesCount+(1+oi(t))*n.geometriesCount;(!e||e.length!==i)&&(e=new Float32Array(i));const s=[];let o=0;for(const a in n.entries){const l=n.entries[a];for(let c=0,u=l.flatCoordss.length;c<u;c++){s.length=l.flatCoordss[c].length,sl(l.flatCoordss[c],0,s.length,3,r,s,3),o+=Bs(e,t,l,o),e[o++]=s.length/3;for(let h=0,f=s.length;h<f;h+=3)e[o++]=s[h],e[o++]=s[h+1],e[o++]=s[h+2]}}return e}function _m(n,e,t,r){const i=2*n.verticesCount+(1+oi(t))*n.geometriesCount+n.ringsCount;(!e||e.length!==i)&&(e=new Float32Array(i));const s=[];let o=0;for(const a in n.entries){const l=n.entries[a];for(let c=0,u=l.flatCoordss.length;c<u;c++){s.length=l.flatCoordss[c].length,sl(l.flatCoordss[c],0,s.length,2,r,s),o+=Bs(e,t,l,o),e[o++]=l.ringsVerticesCounts[c].length;for(let h=0,f=l.ringsVerticesCounts[c].length;h<f;h++)e[o++]=l.ringsVerticesCounts[c][h];for(let h=0,f=s.length;h<f;h+=2)e[o++]=s[h],e[o++]=s[h+1]}}return e}const ym=[],yi=Xl();let xm=0;const Je={POSITION:"a_position",INDEX:"a_index",SEGMENT_START:"a_segmentStart",SEGMENT_END:"a_segmentEnd",MEASURE_START:"a_measureStart",MEASURE_END:"a_measureEnd",PARAMETERS:"a_parameters",JOIN_ANGLES:"a_joinAngles",DISTANCE:"a_distance"};class bm{constructor(e,t,r,i){this.helper_,this.hitDetectionEnabled_=i;let s=e;if(!("builder"in e)){const c=ec(e,t);s={builder:c.builder,attributes:c.attributes,uniforms:c.uniforms}}this.fillProgram_,this.strokeProgram_,this.symbolProgram_,this.hasFill_=!!s.builder.getFillVertexShader(),this.hasFill_&&(this.fillVertexShader_=s.builder.getFillVertexShader(),this.fillFragmentShader_=s.builder.getFillFragmentShader()),this.hasStroke_=!!s.builder.getStrokeVertexShader(),this.hasStroke_&&(this.strokeVertexShader_=s.builder.getStrokeVertexShader(),this.strokeFragmentShader_=s.builder.getStrokeFragmentShader()),this.hasSymbol_=!!s.builder.getSymbolVertexShader(),this.hasSymbol_&&(this.symbolVertexShader_=s.builder.getSymbolVertexShader(),this.symbolFragmentShader_=s.builder.getSymbolFragmentShader());const a=this.hitDetectionEnabled_?{hitColor:{callback(){return Vl(this.ref,ym)},size:4}}:{};this.customAttributes_=Object.assign({},a,s.attributes),this.uniforms_=s.uniforms;const l=Object.entries(this.customAttributes_).map(([c,u])=>({name:`a_${c}`,size:u.size||1,type:de.FLOAT}));this.polygonAttributesDesc_=[{name:Je.POSITION,size:2,type:de.FLOAT},...l],this.lineStringAttributesDesc_=[{name:Je.SEGMENT_START,size:2,type:de.FLOAT},{name:Je.MEASURE_START,size:1,type:de.FLOAT},{name:Je.SEGMENT_END,size:2,type:de.FLOAT},{name:Je.MEASURE_END,size:1,type:de.FLOAT},{name:Je.JOIN_ANGLES,size:2,type:de.FLOAT},{name:Je.DISTANCE,size:1,type:de.FLOAT},{name:Je.PARAMETERS,size:1,type:de.FLOAT},...l],this.pointAttributesDesc_=[{name:Je.POSITION,size:2,type:de.FLOAT},{name:Je.INDEX,size:1,type:de.FLOAT},...l],this.setHelper(r)}async generateBuffers(e,t){const r=this.generateRenderInstructions_(e,t),[i,s,o]=await Promise.all([this.generateBuffersForType_(r.polygonInstructions,"Polygon",t),this.generateBuffersForType_(r.lineStringInstructions,"LineString",t),this.generateBuffersForType_(r.pointInstructions,"Point",t)]),a=$r(be(),t);return{polygonBuffers:i,lineStringBuffers:s,pointBuffers:o,invertVerticesTransform:a}}generateRenderInstructions_(e,t){const r=this.hasFill_?_m(e.polygonBatch,new Float32Array(0),this.customAttributes_,t):null,i=this.hasStroke_?mm(e.lineStringBatch,new Float32Array(0),this.customAttributes_,t):null,s=this.hasSymbol_?pm(e.pointBatch,new Float32Array(0),this.customAttributes_,t):null;return{polygonInstructions:r,lineStringInstructions:i,pointInstructions:s}}generateBuffersForType_(e,t,r){if(e===null)return null;const i=xm++;let s;switch(t){case"Polygon":s=Ir.GENERATE_POLYGON_BUFFERS;break;case"LineString":s=Ir.GENERATE_LINE_STRING_BUFFERS;break;case"Point":s=Ir.GENERATE_POINT_BUFFERS;break}const o={id:i,type:s,renderInstructions:e.buffer,renderInstructionsTransform:r,customAttributesSize:oi(this.customAttributes_)};return yi.postMessage(o,[e.buffer]),e=null,new Promise(a=>{const l=c=>{const u=c.data;if(u.id!==i||(yi.removeEventListener("message",l),!this.helper_.getGL()))return;const h=new or(en,Xr).fromArrayBuffer(u.vertexBuffer),f=new or(tn,Xr).fromArrayBuffer(u.indexBuffer);this.helper_.flushBufferData(h),this.helper_.flushBufferData(f),a([f,h])};yi.addEventListener("message",l)})}render(e,t,r){this.hasFill_&&this.renderInternal_(e.polygonBuffers[0],e.polygonBuffers[1],this.fillProgram_,this.polygonAttributesDesc_,t,r),this.hasStroke_&&this.renderInternal_(e.lineStringBuffers[0],e.lineStringBuffers[1],this.strokeProgram_,this.lineStringAttributesDesc_,t,r),this.hasSymbol_&&this.renderInternal_(e.pointBuffers[0],e.pointBuffers[1],this.symbolProgram_,this.pointAttributesDesc_,t,r)}renderInternal_(e,t,r,i,s,o){const a=e.getSize();a!==0&&(this.helper_.useProgram(r,s),this.helper_.bindBuffer(t),this.helper_.bindBuffer(e),this.helper_.enableAttributes(i),o(),this.helper_.drawElements(0,a))}setHelper(e,t=null){this.helper_=e,this.hasFill_&&(this.fillProgram_=this.helper_.getProgram(this.fillFragmentShader_,this.fillVertexShader_)),this.hasStroke_&&(this.strokeProgram_=this.helper_.getProgram(this.strokeFragmentShader_,this.strokeVertexShader_)),this.hasSymbol_&&(this.symbolProgram_=this.helper_.getProgram(this.symbolFragmentShader_,this.symbolVertexShader_)),this.helper_.addUniforms(this.uniforms_),t&&(t.polygonBuffers&&(this.helper_.flushBufferData(t.polygonBuffers[0]),this.helper_.flushBufferData(t.polygonBuffers[1])),t.lineStringBuffers&&(this.helper_.flushBufferData(t.lineStringBuffers[0]),this.helper_.flushBufferData(t.lineStringBuffers[1])),t.pointBuffers&&(this.helper_.flushBufferData(t.pointBuffers[0]),this.helper_.flushBufferData(t.pointBuffers[1])))}}const Wt={...rt,RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",GLOBAL_ALPHA:"u_globalAlpha"};class Em extends rn{constructor(e,t){const r={[Wt.RENDER_EXTENT]:[0,0,0,0],[Wt.PATTERN_ORIGIN]:[0,0],[Wt.GLOBAL_ALPHA]:1};super(e,{uniforms:r,postProcesses:t.postProcesses}),this.hitDetectionEnabled_=!t.disableHitDetection,this.hitRenderTarget_,this.sourceRevision_=-1,this.previousExtent_=ei(),this.currentTransform_=be(),this.tmpCoords_=[0,0],this.tmpTransform_=be(),this.tmpMat4_=Qi(),this.currentFrameStateTransform_=be(),this.styleVariables_={},this.styles_=[],this.styleRenderers_=[],this.buffers_=[],this.applyOptions_(t),this.batch_=new fm,this.initialFeaturesAdded_=!1,this.sourceListenKeys_=null}addInitialFeatures_(e){const t=this.getLayer().getSource();let r;this.batch_.addFeatures(t.getFeatures(),r),this.sourceListenKeys_=[Et(t,bt.ADDFEATURE,this.handleSourceFeatureAdded_.bind(this,r)),Et(t,bt.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),Et(t,bt.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),Et(t,bt.CLEAR,this.handleSourceFeatureClear_,this)]}applyOptions_(e){this.styleVariables_=e.variables,this.styles_=Array.isArray(e.style)?e.style:[e.style]}createRenderers_(){this.buffers_=[],this.styleRenderers_=this.styles_.map(e=>new bm(e,this.styleVariables_,this.helper,this.hitDetectionEnabled_))}reset(e){this.applyOptions_(e),this.helper&&this.createRenderers_(),super.reset(e)}afterHelperCreated(){this.styleRenderers_.length?this.styleRenderers_.forEach((e,t)=>e.setHelper(this.helper,this.buffers_[t])):this.createRenderers_(),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new $l(this.helper))}handleSourceFeatureAdded_(e,t){const r=t.feature;this.batch_.addFeature(r,e)}handleSourceFeatureChanged_(e){const t=e.feature;this.batch_.changeFeature(t)}handleSourceFeatureDelete_(e){const t=e.feature;this.batch_.removeFeature(t)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(e){Ju(this.tmpTransform_,this.currentFrameStateTransform_),zr(this.tmpTransform_,e),this.helper.setUniformMatrixValue(Wt.PROJECTION_MATRIX,Ln(this.tmpMat4_,this.tmpTransform_)),$r(this.tmpTransform_,this.tmpTransform_),this.helper.setUniformMatrixValue(Wt.SCREEN_TO_WORLD_MATRIX,Ln(this.tmpMat4_,this.tmpTransform_)),this.tmpCoords_[0]=0,this.tmpCoords_[1]=0,$r(this.tmpTransform_,e),dt(this.tmpTransform_,this.tmpCoords_),this.helper.setUniformFloatVec2(Wt.PATTERN_ORIGIN,this.tmpCoords_)}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[r,i,s]=Hl(e,this.getLayer());this.helper.prepareDraw(e),this.renderWorlds(e,!1,r,i,s),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const o=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,r,i,s),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),o}prepareFrameInternal(e){this.initialFeaturesAdded_||(this.addInitialFeatures_(e),this.initialFeaturesAdded_=!0);const t=this.getLayer(),r=t.getSource(),i=e.viewState,s=!e.viewHints[St.ANIMATING]&&!e.viewHints[St.INTERACTING],o=!jr(this.previousExtent_,e.extent),a=this.sourceRevision_<r.getRevision();if(a&&(this.sourceRevision_=r.getRevision()),s&&(o||a)){const l=i.projection,c=i.resolution,u=t instanceof Zn?t.getRenderBuffer():0,h=_s(e.extent,u*c);r.loadFeatures(h,c,l),this.ready=!1;const f=this.helper.makeProjectionTransform(e,be()),d=this.styleRenderers_.map((g,p)=>g.generateBuffers(this.batch_,f).then(m=>{this.buffers_[p]&&this.disposeBuffers(this.buffers_[p]),this.buffers_[p]=m}));Promise.all(d).then(()=>{this.ready=!0,this.getLayer().changed()}),this.previousExtent_=e.extent.slice()}return!0}renderWorlds(e,t,r,i,s){let o=r;t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0));do{this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_),fs(this.currentFrameStateTransform_,o*s,0);for(let a=0,l=this.styleRenderers_.length;a<l;a++){const c=this.styleRenderers_[a],u=this.buffers_[a];u&&c.render(u,e,()=>{this.applyUniforms_(u.invertVerticesTransform),this.helper.applyHitDetectionUniform(t)})}}while(++o<i)}forEachFeatureAtCoordinate(e,t,r,i,s){if(qe(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.styleRenderers_.length||!this.hitDetectionEnabled_)return;const o=dt(t.coordinateToPixelTransform,e.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),l=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],c=jl(l),u=this.batch_.getFeatureFromRef(c);if(u)return i(u,this.getLayer(),null)}disposeBuffers(e){e.pointBuffers&&e.pointBuffers.filter(Boolean).forEach(t=>this.helper.deleteBuffer(t)),e.lineStringBuffers&&e.lineStringBuffers.filter(Boolean).forEach(t=>this.helper.deleteBuffer(t)),e.polygonBuffers&&e.polygonBuffers.filter(Boolean).forEach(t=>this.helper.deleteBuffer(t))}disposeInternal(){this.buffers_.forEach(e=>{this.disposeBuffers(e)}),this.sourceListenKeys_&&(this.sourceListenKeys_.forEach(function(e){cl(e)}),this.sourceListenKeys_=null),super.disposeInternal()}}class wm extends ns{constructor(e){const t=Object.assign({},e);super(t),this.styleVariables_=e.variables||{},this.style_=e.style,this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){return new Em(this,{style:this.style_,variables:this.styleVariables_,disableHitDetection:this.hitDetectionDisabled_})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}setStyle(e){this.style=e,this.clearRenderer(),this.changed()}}const Tm=Object.freeze(Object.defineProperty({__proto__:null,Graticule:jh,Group:dl,Heatmap:em,Image:is,Layer:ns,Tile:An,Vector:Ki,VectorImage:nm,VectorTile:qa,WebGLPoints:hm,WebGLTile:Bn,WebGLVector:wm},Symbol.toStringTag,{value:"Module"}));function Sm(n){const e=n[0],t=new Array(e);let r=1<<e-1,i,s;for(i=0;i<e;++i)s=48,n[1]&r&&(s+=1),n[2]&r&&(s+=2),t[i]=String.fromCharCode(s),r>>=1;return t.join("")}const Rm='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class vm extends mt{constructor(e){const t=e.hidpi!==void 0?e.hidpi:!1;super({cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,projection:K("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.hidpi_=t,this.culture_=e.culture!==void 0?e.culture:"en-us",this.maxZoom_=e.maxZoom!==void 0?e.maxZoom:-1,this.apiKey_=e.key,this.imagerySet_=e.imagerySet,this.placeholderTiles_=e.placeholderTiles;const r="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(r).then(i=>i.json()).then(i=>this.handleImageryMetadataResponse(i))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(e){if(e.statusCode!=200||e.statusDescription!="OK"||e.authenticationResultCode!="ValidCredentials"||e.resourceSets.length!=1||e.resourceSets[0].resources.length!=1){this.setState("error");return}const t=e.resourceSets[0].resources[0],r=this.maxZoom_==-1?t.zoomMax:this.maxZoom_,i=this.getProjection(),s=Yr(i),o=this.hidpi_?2:1,a=t.imageWidth==t.imageHeight?t.imageWidth/o:[t.imageWidth/o,t.imageHeight/o],l=qr({extent:s,minZoom:t.zoomMin,maxZoom:r,tileSize:a});this.tileGrid=l;const c=this.culture_,u=this.hidpi_,h=this.placeholderTiles_;if(this.tileUrlFunction=ss(t.imageUrlSubdomains.map(function(f){const d=[0,0,0],g=t.imageUrl.replace("{subdomain}",f).replace("{culture}",c);return function(p,m,y){if(!p)return;Ii(p[0],p[1],p[2],d);const _=new URL(g.replace("{quadkey}",Sm(d))),x=_.searchParams;return u&&(x.set("dpi","d1"),x.set("device","mobile")),h===!0?x.delete("n"):h===!1&&x.set("n","z"),_.toString()}})),t.imageryProviders){const f=ds(K("EPSG:4326"),this.getProjection());this.setAttributions(d=>{const g=[],p=d.viewState,m=this.getTileGrid(),y=m.getZForResolution(p.resolution,this.zDirection),x=m.getTileCoordForCoordAndZ(p.center,y)[0];return t.imageryProviders.map(function(w){let S=!1;const T=w.coverageAreas;for(let R=0,L=T.length;R<L;++R){const I=T[R];if(x>=I.zoomMin&&x<=I.zoomMax){const C=I.bbox,j=[C[1],C[0],C[3],C[2]],z=sr(j,f);if(ir(z,d.extent)){S=!0;break}}}S&&g.push(w.attribution)}),g.push(Rm),g})}this.setState("ready")}}class Pm extends Gr{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,maxZoom:e.maxZoom!==void 0?e.maxZoom:18,minZoom:e.minZoom,projection:e.projection,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection}),this.account_=e.account,this.mapId_=e.map||"",this.config_=e.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(e){Object.assign(this.config_,e),this.initializeMap_()}setConfig(e){this.config_=e||{},this.initializeMap_()}initializeMap_(){const e=JSON.stringify(this.config_);if(this.templateCache_[e]){this.applyTemplate_(this.templateCache_[e]);return}let t="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(t+="/named/"+this.mapId_);const r=new XMLHttpRequest;r.addEventListener("load",this.handleInitResponse_.bind(this,e)),r.addEventListener("error",this.handleInitError_.bind(this)),r.open("POST",t),r.setRequestHeader("Content-type","application/json"),r.send(JSON.stringify(this.config_))}handleInitResponse_(e,t){const r=t.target;if(!r.status||r.status>=200&&r.status<300){let i;try{i=JSON.parse(r.responseText)}catch{this.setState("error");return}this.applyTemplate_(i),this.templateCache_[e]=i,this.setState("ready")}else this.setState("error")}handleInitError_(e){this.setState("error")}applyTemplate_(e){const t="https://"+e.cdn_url.https+"/"+this.account_+"/api/v1/map/"+e.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(t)}}class Lm extends Zr{constructor(e){e=e||{},super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(t){const r=t.getGeometry();return qe(!r||r.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),r},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,t,r){var i;(i=this.source)==null||i.loadFeatures(e,t,r),t!==this.resolution&&(this.resolution=t,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(Ie.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(Ie.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,t){const r=e===0?0:Math.min(t,e)/e,i=e!==this.distance||this.interpolationRatio!==r;this.distance=e,this.minDistance=t,this.interpolationRatio=r,i&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=ei(),t=this.distance*this.resolution,r=this.source.getFeatures(),i={};for(let s=0,o=r.length;s<o;s++){const a=r[s];if(!(ne(a)in i)){const l=this.geometryFunction(a);if(l){const c=l.getCoordinates();fh(c,e),_s(e,t,e);const u=this.source.getFeaturesInExtent(e).filter(function(h){const f=ne(h);return f in i?!1:(i[f]=!0,!0)});this.features.push(this.createCluster(u,e))}}}}createCluster(e,t){const r=[0,0];for(let a=e.length-1;a>=0;--a){const l=this.geometryFunction(e[a]);l?Qu(r,l.getCoordinates()):e.splice(a,1)}eh(r,1/e.length);const i=Tt(t),s=this.interpolationRatio,o=new it([r[0]*(1-s)+i[0]*s,r[1]*(1-s)+i[1]*s]);return this.createCustomCluster_?this.createCustomCluster_(o,e):new Ye({geometry:o,features:e})}}class nn extends Yn{constructor(e){const t=e.projection===void 0?"EPSG:3857":e.projection;let r=e.tileGrid;r===void 0&&t&&(r=qr({extent:Yr(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:r,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.tileSize_=e.tileSize?Ze(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=e.bandCount===void 0?4:e.bandCount,this.tileGridForProjection_={},this.crossOrigin_=e.crossOrigin||"anonymous",this.transformMatrix=null}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?Ze(t.getTileSize(e)):[256,256]}getGutterForProjection(e){const t=this.getProjection();return(!t||En(t,e))&&!this.transformMatrix?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,t,r,i,s){const o=this.tileGrid||this.getTileGridForProjection(s||i),a=Math.max.apply(null,o.getResolutions().map((d,g)=>{const p=Ze(o.getTileSize(g)),m=this.getTileSize(g);return Math.max(m[0]/p[0],m[1]/p[1])})),l=this.getTileGridForProjection(i),c=[e,t,r],u=this.getTileCoordForTileUrlFunction(c,i),h=Object.assign({sourceProj:s||i,sourceTileGrid:o,targetProj:i,targetTileGrid:l,tileCoord:c,wrappedTileCoord:u,pixelRatio:a,gutter:this.gutter_,getTileFunction:(d,g,p,m)=>this.getTile(d,g,p,m),transformMatrix:this.transformMatrix},this.tileOptions),f=new rs(h);return f.key=this.getKey(),f}getTile(e,t,r,i,s){var x;const o=this.getProjection();if(s&&(o&&!En(o,s)||this.transformMatrix))return this.getReprojTile_(e,t,r,s,o);const a=this.getTileSize(e),l=this.loader_,c=new AbortController,u={signal:c.signal,crossOrigin:this.crossOrigin_},h=this.getTileCoordForTileUrlFunction([e,t,r]);if(!h)return null;const f=h[0],d=h[1],g=h[2],p=(x=this.getTileGrid())==null?void 0:x.getFullTileRange(f);p&&(u.maxY=p.getHeight()-1);function m(){return dh(function(){return l(f,d,g,u)})}const y=Object.assign({tileCoord:[e,t,r],loader:m,size:a,controller:c},this.tileOptions),_=new Wa(y);return _.key=this.getKey(),_.addEventListener(Ie.CHANGE,this.handleTileChange_),_}handleTileChange_(e){const t=e.target,r=ne(t),i=t.getState();let s;i==he.LOADING?(this.tileLoadingKeys_[r]=!0,s=hi.TILELOADSTART):r in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[r],s=i==he.ERROR?hi.TILELOADERROR:i==he.LOADED?hi.TILELOADEND:void 0),s&&this.dispatchEvent(new wu(s,t))}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||En(t,e))&&!this.transformMatrix)return this.tileGrid;const r=ne(e);return r in this.tileGridForProjection_||(this.tileGridForProjection_[r]=Tu(e)),this.tileGridForProjection_[r]}setTileGridForProjection(e,t){const r=K(e);if(r){const i=ne(r);i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=t)}}}function Ee(n){return(e,...t)=>Am(n,e,t)}function yr(n,e){return Ee(tc(n,e).get)}const{apply:Am,construct:Xx,defineProperty:Hx,get:Wx,getOwnPropertyDescriptor:tc,getPrototypeOf:Gs,has:Zx,ownKeys:Im,set:Yx,setPrototypeOf:qx}=Reflect,{iterator:sn,species:Kx,toStringTag:Cm,for:Jx}=Symbol,Fm=Object,{create:zs,defineProperty:Om,freeze:Qx,is:eb}=Fm,Mm=Array,Nm=Mm.prototype,rc=Nm[sn],Dm=Ee(rc),nc=ArrayBuffer,Um=nc.prototype;yr(Um,"byteLength");const pa=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;pa&&yr(pa.prototype,"byteLength");const ic=Gs(Uint8Array);ic.from;const Pe=ic.prototype;Pe[sn];Ee(Pe.keys);Ee(Pe.values);Ee(Pe.entries);Ee(Pe.set);Ee(Pe.reverse);Ee(Pe.fill);Ee(Pe.copyWithin);Ee(Pe.sort);Ee(Pe.slice);Ee(Pe.subarray);yr(Pe,"buffer");yr(Pe,"byteOffset");yr(Pe,"length");yr(Pe,Cm);const Bm=Uint8Array,sc=Uint16Array,ks=Uint32Array,Gm=Float32Array,Hr=Gs([][sn]()),oc=Ee(Hr.next),zm=Ee(function*(){}().next),km=Gs(Hr),$m=DataView.prototype,Vm=Ee($m.getUint16),$s=WeakMap,ac=$s.prototype,lc=Ee(ac.get),jm=Ee(ac.set),cc=new $s,Xm=zs(null,{next:{value:function(){const e=lc(cc,this);return oc(e)}},[sn]:{value:function(){return this}}});function Hm(n){if(n[sn]===rc&&Hr.next===oc)return n;const e=zs(Xm);return jm(cc,e,Dm(n)),e}const Wm=new $s,Zm=zs(km,{next:{value:function(){const e=lc(Wm,this);return zm(e)},writable:!0,configurable:!0}});for(const n of Im(Hr))n!=="next"&&Om(Zm,n,tc(Hr,n));const uc=new nc(4),Ym=new Gm(uc),qm=new ks(uc),Qe=new sc(512),et=new Bm(512);for(let n=0;n<256;++n){const e=n-127;e<-24?(Qe[n]=0,Qe[n|256]=32768,et[n]=24,et[n|256]=24):e<-14?(Qe[n]=1024>>-e-14,Qe[n|256]=1024>>-e-14|32768,et[n]=-e-1,et[n|256]=-e-1):e<=15?(Qe[n]=e+15<<10,Qe[n|256]=e+15<<10|32768,et[n]=13,et[n|256]=13):e<128?(Qe[n]=31744,Qe[n|256]=64512,et[n]=24,et[n|256]=24):(Qe[n]=31744,Qe[n|256]=64512,et[n]=13,et[n|256]=13)}const Vs=new ks(2048);for(let n=1;n<1024;++n){let e=n<<13,t=0;for(;!(e&8388608);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,Vs[n]=e|t}for(let n=1024;n<2048;++n)Vs[n]=939524096+(n-1024<<13);const xr=new ks(64);for(let n=1;n<31;++n)xr[n]=n<<23;xr[31]=1199570944;xr[32]=2147483648;for(let n=33;n<63;++n)xr[n]=2147483648+(n-32<<23);xr[63]=3347054592;const hc=new sc(64);for(let n=1;n<64;++n)n!==32&&(hc[n]=1024);function Km(n){const e=n>>10;return qm[0]=Vs[hc[e]+(n&1023)]+xr[e],Ym[0]}function fc(n,e,...t){return Km(Vm(n,e,...Hm(t)))}var js={exports:{}};function dc(n,e,t){const r=t&&t.debug||!1;r&&console.log("[xml-utils] getting "+e+" in "+n);const i=typeof n=="object"?n.outer:n,s=i.slice(0,i.indexOf(">")+1),o=['"',"'"];for(let a=0;a<o.length;a++){const l=o[a],c=e+"\\="+l+"([^"+l+"]*)"+l;r&&console.log("[xml-utils] pattern:",c);const h=new RegExp(c).exec(s);if(r&&console.log("[xml-utils] match:",h),h)return h[1]}}js.exports=dc;js.exports.default=dc;var Jm=js.exports;const xi=gl(Jm);var Xs={exports:{}},Hs={exports:{}},Ws={exports:{}};function gc(n,e,t){const i=new RegExp(e).exec(n.slice(t));return i?t+i.index:-1}Ws.exports=gc;Ws.exports.default=gc;var Qm=Ws.exports,Zs={exports:{}};function pc(n,e,t){const i=new RegExp(e).exec(n.slice(t));return i?t+i.index+i[0].length-1:-1}Zs.exports=pc;Zs.exports.default=pc;var e_=Zs.exports,Ys={exports:{}};function mc(n,e){const t=new RegExp(e,"g"),r=n.match(t);return r?r.length:0}Ys.exports=mc;Ys.exports.default=mc;var t_=Ys.exports;const r_=Qm,bi=e_,ma=t_;function _c(n,e,t){const r=t&&t.debug||!1,i=!(t&&typeof t.nested===!1),s=t&&t.startIndex||0;r&&console.log("[xml-utils] starting findTagByName with",e," and ",t);const o=r_(n,`<${e}[ 
>/]`,s);if(r&&console.log("[xml-utils] start:",o),o===-1)return;const a=n.slice(o+e.length);let l=bi(a,"^[^<]*[ /]>",0);const c=l!==-1&&a[l-1]==="/";if(r&&console.log("[xml-utils] selfClosing:",c),c===!1)if(i){let d=0,g=1,p=0;for(;(l=bi(a,"[ /]"+e+">",d))!==-1;){const m=a.substring(d,l+1);if(g+=ma(m,"<"+e+`[ 
	>]`),p+=ma(m,"</"+e+">"),p>=g)break;d=l}}else l=bi(a,"[ /]"+e+">",0);const u=o+e.length+l+1;if(r&&console.log("[xml-utils] end:",u),u===-1)return;const h=n.slice(o,u);let f;return c?f=null:f=h.slice(h.indexOf(">")+1,h.lastIndexOf("<")),{inner:f,outer:h,start:o,end:u}}Hs.exports=_c;Hs.exports.default=_c;var n_=Hs.exports;const i_=n_;function yc(n,e,t){const r=[],i=t&&t.debug||!1,s=t&&typeof t.nested=="boolean"?t.nested:!0;let o=t&&t.startIndex||0,a;for(;a=i_(n,e,{debug:i,startIndex:o});)s?o=a.start+1+e.length:o=a.end,r.push(a);return i&&console.log("findTagsByName found",r.length,"tags"),r}Xs.exports=yc;Xs.exports.default=yc;var s_=Xs.exports;const o_=gl(s_),Cr={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},tt={};for(const n in Cr)Cr.hasOwnProperty(n)&&(tt[Cr[n]]=parseInt(n,10));const a_=[tt.BitsPerSample,tt.ExtraSamples,tt.SampleFormat,tt.StripByteCounts,tt.StripOffsets,tt.StripRowCounts,tt.TileByteCounts,tt.TileOffsets,tt.SubIFDs],Ei={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},$={};for(const n in Ei)Ei.hasOwnProperty(n)&&($[Ei[n]]=parseInt(n,10));const Le={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},l_={Unspecified:0,Assocalpha:1,Unassalpha:2},tb={Version:0,AddCompression:1},rb={None:0,Deflate:1,Zstandard:2},c_={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function u_(n,e){const{width:t,height:r}=n,i=new Uint8Array(t*r*3);let s;for(let o=0,a=0;o<n.length;++o,a+=3)s=256-n[o]/e*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function h_(n,e){const{width:t,height:r}=n,i=new Uint8Array(t*r*3);let s;for(let o=0,a=0;o<n.length;++o,a+=3)s=n[o]/e*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function f_(n,e){const{width:t,height:r}=n,i=new Uint8Array(t*r*3),s=e.length/3,o=e.length/3*2;for(let a=0,l=0;a<n.length;++a,l+=3){const c=n[a];i[l]=e[c]/65536*256,i[l+1]=e[c+s]/65536*256,i[l+2]=e[c+o]/65536*256}return i}function d_(n){const{width:e,height:t}=n,r=new Uint8Array(e*t*3);for(let i=0,s=0;i<n.length;i+=4,s+=3){const o=n[i],a=n[i+1],l=n[i+2],c=n[i+3];r[s]=255*((255-o)/256)*((255-c)/256),r[s+1]=255*((255-a)/256)*((255-c)/256),r[s+2]=255*((255-l)/256)*((255-c)/256)}return r}function g_(n){const{width:e,height:t}=n,r=new Uint8ClampedArray(e*t*3);for(let i=0,s=0;i<n.length;i+=3,s+=3){const o=n[i],a=n[i+1],l=n[i+2];r[s]=o+1.402*(l-128),r[s+1]=o-.34414*(a-128)-.71414*(l-128),r[s+2]=o+1.772*(a-128)}return r}const p_=.95047,m_=1,__=1.08883;function y_(n){const{width:e,height:t}=n,r=new Uint8Array(e*t*3);for(let i=0,s=0;i<n.length;i+=3,s+=3){const o=n[i+0],a=n[i+1]<<24>>24,l=n[i+2]<<24>>24;let c=(o+16)/116,u=a/500+c,h=c-l/200,f,d,g;u=p_*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),c=m_*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),h=__*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),f=u*3.2406+c*-1.5372+h*-.4986,d=u*-.9689+c*1.8758+h*.0415,g=u*.0557+c*-.204+h*1.057,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,r[s]=Math.max(0,Math.min(1,f))*255,r[s+1]=Math.max(0,Math.min(1,d))*255,r[s+2]=Math.max(0,Math.min(1,g))*255}return r}const xc=new Map;function At(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>xc.set(t,e))}async function bc(n){const e=xc.get(n.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${n.Compression}`);const t=await e();return new t(n)}At([void 0,1],()=>Lt(()=>import("./raw.D6pKN3lG.js"),__vite__mapDeps([0,1])).then(n=>n.default));At(5,()=>Lt(()=>import("./lzw.oZZD6jgh.js"),__vite__mapDeps([2,1])).then(n=>n.default));At(6,()=>{throw new Error("old style JPEG compression is not supported.")});At(7,()=>Lt(()=>import("./jpeg.C0INXBWW.js"),__vite__mapDeps([3,1])).then(n=>n.default));At([8,32946],()=>Lt(()=>import("./deflate.Bdd8XQIN.js"),__vite__mapDeps([4,5,1])).then(n=>n.default));At(32773,()=>Lt(()=>import("./packbits.DEOShcjz.js"),__vite__mapDeps([6,1])).then(n=>n.default));At(34887,()=>Lt(()=>import("./lerc.B6tymh4S.js"),__vite__mapDeps([7,5,8,1,9,10,11,12,13,14,15,16,17])).then(async n=>(await n.zstd.init(),n)).then(n=>n.default));At(50001,()=>Lt(()=>import("./webimage.D-DuHHsL.js"),__vite__mapDeps([18,1])).then(n=>n.default));function ai(n,e,t,r=1){return new(Object.getPrototypeOf(n)).constructor(e*t*r)}function x_(n,e,t,r,i){const s=e/r,o=t/i;return n.map(a=>{const l=ai(a,r,i);for(let c=0;c<i;++c){const u=Math.min(Math.round(o*c),t-1);for(let h=0;h<r;++h){const f=Math.min(Math.round(s*h),e-1),d=a[u*e+f];l[c*r+h]=d}}return l})}function rr(n,e,t){return(1-t)*n+t*e}function b_(n,e,t,r,i){const s=e/r,o=t/i;return n.map(a=>{const l=ai(a,r,i);for(let c=0;c<i;++c){const u=o*c,h=Math.floor(u),f=Math.min(Math.ceil(u),t-1);for(let d=0;d<r;++d){const g=s*d,p=g%1,m=Math.floor(g),y=Math.min(Math.ceil(g),e-1),_=a[h*e+m],x=a[h*e+y],w=a[f*e+m],S=a[f*e+y],T=rr(rr(_,x,p),rr(w,S,p),u%1);l[c*r+d]=T}}return l})}function E_(n,e,t,r,i,s="nearest"){switch(s.toLowerCase()){case"nearest":return x_(n,e,t,r,i);case"bilinear":case"linear":return b_(n,e,t,r,i);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function w_(n,e,t,r,i,s){const o=e/r,a=t/i,l=ai(n,r,i,s);for(let c=0;c<i;++c){const u=Math.min(Math.round(a*c),t-1);for(let h=0;h<r;++h){const f=Math.min(Math.round(o*h),e-1);for(let d=0;d<s;++d){const g=n[u*e*s+f*s+d];l[c*r*s+h*s+d]=g}}}return l}function T_(n,e,t,r,i,s){const o=e/r,a=t/i,l=ai(n,r,i,s);for(let c=0;c<i;++c){const u=a*c,h=Math.floor(u),f=Math.min(Math.ceil(u),t-1);for(let d=0;d<r;++d){const g=o*d,p=g%1,m=Math.floor(g),y=Math.min(Math.ceil(g),e-1);for(let _=0;_<s;++_){const x=n[h*e*s+m*s+_],w=n[h*e*s+y*s+_],S=n[f*e*s+m*s+_],T=n[f*e*s+y*s+_],R=rr(rr(x,w,p),rr(S,T,p),u%1);l[c*r*s+d*s+_]=R}}}return l}function S_(n,e,t,r,i,s,o="nearest"){switch(o.toLowerCase()){case"nearest":return w_(n,e,t,r,i,s);case"bilinear":case"linear":return T_(n,e,t,r,i,s);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function R_(n,e,t){let r=0;for(let i=e;i<t;++i)r+=n[i];return r}function ki(n,e,t){switch(n){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function v_(n,e){return(n===1||n===2)&&e<=32&&e%8===0?!1:!(n===3&&(e===16||e===32||e===64))}function P_(n,e,t,r,i,s,o){const a=new DataView(n),l=t===2?o*s:o*s*r,c=t===2?1:r,u=ki(e,i,l),h=parseInt("1".repeat(i),2);if(e===1){let f;t===1?f=r*i:f=i;let d=s*f;d&7&&(d=d+7&-8);for(let g=0;g<o;++g){const p=g*d;for(let m=0;m<s;++m){const y=p+m*c*i;for(let _=0;_<c;++_){const x=y+_*i,w=(g*s+m)*c+_,S=Math.floor(x/8),T=x%8;if(T+i<=8)u[w]=a.getUint8(S)>>8-i-T&h;else if(T+i<=16)u[w]=a.getUint16(S)>>16-i-T&h;else if(T+i<=24){const R=a.getUint16(S)<<8|a.getUint8(S+2);u[w]=R>>24-i-T&h}else u[w]=a.getUint32(S)>>32-i-T&h}}}}return u.buffer}class Ec{constructor(e,t,r,i,s,o){this.fileDirectory=e,this.geoKeys=t,this.dataView=r,this.littleEndian=i,this.tiles=s?{}:null,this.isTiled=!e.StripOffsets;const a=e.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,r=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(r<=8)return DataView.prototype.getUint8;if(r<=16)return DataView.prototype.getUint16;if(r<=32)return DataView.prototype.getUint32;break;case 2:if(r<=8)return DataView.prototype.getInt8;if(r<=16)return DataView.prototype.getInt16;if(r<=32)return DataView.prototype.getInt32;break;case 3:switch(r){case 16:return function(i,s){return fc(this,i,s)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const r=this.getSampleFormat(e),i=this.getBitsPerSample(e);return ki(r,i,t)}async getTileOrStrip(e,t,r,i,s){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:c}=this;this.planarConfiguration===1?l=t*o+e:this.planarConfiguration===2&&(l=r*o*a+t*o+e);let u,h;this.isTiled?(u=this.fileDirectory.TileOffsets[l],h=this.fileDirectory.TileByteCounts[l]):(u=this.fileDirectory.StripOffsets[l],h=this.fileDirectory.StripByteCounts[l]);const f=(await this.source.fetch([{offset:u,length:h}],s))[0];let d;return c===null||!c[l]?(d=(async()=>{let g=await i.decode(this.fileDirectory,f);const p=this.getSampleFormat(),m=this.getBitsPerSample();return v_(p,m)&&(g=P_(g,p,this.planarConfiguration,this.getSamplesPerPixel(),m,this.getTileWidth(),this.getBlockHeight(t))),g})(),c!==null&&(c[l]=d)):d=c[l],{x:e,y:t,sample:r,data:await d}}async _readRaster(e,t,r,i,s,o,a,l,c){const u=this.getTileWidth(),h=this.getTileHeight(),f=this.getWidth(),d=this.getHeight(),g=Math.max(Math.floor(e[0]/u),0),p=Math.min(Math.ceil(e[2]/u),Math.ceil(f/u)),m=Math.max(Math.floor(e[1]/h),0),y=Math.min(Math.ceil(e[3]/h),Math.ceil(d/h)),_=e[2]-e[0];let x=this.getBytesPerPixel();const w=[],S=[];for(let L=0;L<t.length;++L)this.planarConfiguration===1?w.push(R_(this.fileDirectory.BitsPerSample,0,t[L])/8):w.push(0),S.push(this.getReaderForSample(t[L]));const T=[],{littleEndian:R}=this;for(let L=m;L<y;++L)for(let I=g;I<p;++I){let C;this.planarConfiguration===1&&(C=this.getTileOrStrip(I,L,0,s,c));for(let j=0;j<t.length;++j){const z=j,Y=t[j];this.planarConfiguration===2&&(x=this.getSampleByteSize(Y),C=this.getTileOrStrip(I,L,Y,s,c));const M=C.then(W=>{const ge=W.data,ae=new DataView(ge),se=this.getBlockHeight(W.y),_e=W.y*h,Ue=W.x*u,ze=_e+se,Fe=(W.x+1)*u,ot=S[z],at=Math.min(se,se-(ze-e[3]),d-_e),It=Math.min(u,u-(Fe-e[2]),f-Ue);for(let ke=Math.max(0,e[1]-_e);ke<at;++ke)for(let $e=Math.max(0,e[0]-Ue);$e<It;++$e){const cn=(ke*u+$e)*x,un=ot.call(ae,cn+w[z],R);let Ct;i?(Ct=(ke+_e-e[1])*_*t.length+($e+Ue-e[0])*t.length+z,r[Ct]=un):(Ct=(ke+_e-e[1])*_+$e+Ue-e[0],r[z][Ct]=un)}});T.push(M)}}if(await Promise.all(T),o&&e[2]-e[0]!==o||a&&e[3]-e[1]!==a){let L;return i?L=S_(r,e[2]-e[0],e[3]-e[1],o,a,t.length,l):L=E_(r,e[2]-e[0],e[3]-e[1],o,a,l),L.width=o,L.height=a,L}return r.width=o||e[2]-e[0],r.height=a||e[3]-e[1],r}async readRasters({window:e,samples:t=[],interleave:r,pool:i=null,width:s,height:o,resampleMethod:a,fillValue:l,signal:c}={}){const u=e||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw new Error("Invalid subsets");const h=u[2]-u[0],f=u[3]-u[1],d=h*f,g=this.getSamplesPerPixel();if(!t||!t.length)for(let _=0;_<g;++_)t.push(_);else for(let _=0;_<t.length;++_)if(t[_]>=g)return Promise.reject(new RangeError(`Invalid sample index '${t[_]}'.`));let p;if(r){const _=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,x=Math.max.apply(null,this.fileDirectory.BitsPerSample);p=ki(_,x,d*t.length),l&&p.fill(l)}else{p=[];for(let _=0;_<t.length;++_){const x=this.getArrayForSample(t[_],d);Array.isArray(l)&&_<l.length?x.fill(l[_]):l&&!Array.isArray(l)&&x.fill(l),p.push(x)}}const m=i||await bc(this.fileDirectory);return await this._readRaster(u,t,p,r,m,s,o,a,c)}async readRGB({window:e,interleave:t=!0,pool:r=null,width:i,height:s,resampleMethod:o,enableAlpha:a=!1,signal:l}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const u=this.fileDirectory.PhotometricInterpretation;if(u===Le.RGB){let y=[0,1,2];if(this.fileDirectory.ExtraSamples!==l_.Unspecified&&a){y=[];for(let _=0;_<this.fileDirectory.BitsPerSample.length;_+=1)y.push(_)}return this.readRasters({window:e,interleave:t,samples:y,pool:r,width:i,height:s,resampleMethod:o,signal:l})}let h;switch(u){case Le.WhiteIsZero:case Le.BlackIsZero:case Le.Palette:h=[0];break;case Le.CMYK:h=[0,1,2,3];break;case Le.YCbCr:case Le.CIELab:h=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const f={window:c,interleave:!0,samples:h,pool:r,width:i,height:s,resampleMethod:o,signal:l},{fileDirectory:d}=this,g=await this.readRasters(f),p=2**this.fileDirectory.BitsPerSample[0];let m;switch(u){case Le.WhiteIsZero:m=u_(g,p);break;case Le.BlackIsZero:m=h_(g,p);break;case Le.Palette:m=f_(g,d.ColorMap);break;case Le.CMYK:m=d_(g);break;case Le.YCbCr:m=g_(g);break;case Le.CIELab:m=y_(g);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const y=new Uint8Array(m.length/3),_=new Uint8Array(m.length/3),x=new Uint8Array(m.length/3);for(let w=0,S=0;w<m.length;w+=3,++S)y[S]=m[w],_[S]=m[w+1],x[S]=m[w+2];m=[y,_,x]}return m.width=g.width,m.height=g.height,m}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const r=this.fileDirectory.GDAL_METADATA;let i=o_(r,"Item");e===null?i=i.filter(s=>xi(s,"sample")===void 0):i=i.filter(s=>Number(xi(s,"sample"))===e);for(let s=0;s<i.length;++s){const o=i[s];t[xi(o,"name")]=o.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,r=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(r)return r[1]===0&&r[4]===0?[r[0],-r[5],r[10]]:[Math.sqrt(r[0]*r[0]+r[4]*r[4]),-Math.sqrt(r[1]*r[1]+r[5]*r[5]),r[10]];if(e){const[i,s,o]=e.getResolution();return[i*e.getWidth()/this.getWidth(),s*e.getHeight()/this.getHeight(),o*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const t=this.getHeight(),r=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[i,s,o,a,l,c,u,h]=this.fileDirectory.ModelTransformation,d=[[0,0],[0,t],[r,0],[r,t]].map(([m,y])=>[a+i*m+s*y,h+l*m+c*y]),g=d.map(m=>m[0]),p=d.map(m=>m[1]);return[Math.min(...g),Math.min(...p),Math.max(...g),Math.max(...p)]}else{const i=this.getOrigin(),s=this.getResolution(),o=i[0],a=i[1],l=o+s[0]*r,c=a+s[1]*t;return[Math.min(o,l),Math.min(a,c),Math.max(o,l),Math.max(a,c)]}}}class L_{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const r=this.getUint32(e,t),i=this.getUint32(e+4,t);let s;if(t){if(s=r+2**32*i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*r+i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}getInt64(e,t){let r=0;const i=(this._dataView.getUint8(e+(t?7:0))&128)>0;let s=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(t?o:7-o));i&&(s?a!==0&&(a=~(a-1)&255,s=!1):a=~a&255),r+=a*256**o}return i&&(r=-r),r}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return fc(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class A_{constructor(e,t,r,i){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=r,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),r=this.readUint32(e+4);let i;if(this._littleEndian){if(i=t+2**32*r,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*t+r,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}readInt64(e){let t=0;const r=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let i=!0;for(let s=0;s<8;s++){let o=this._dataView.getUint8(e+(this._littleEndian?s:7-s));r&&(i?o!==0&&(o=~(o-1)&255,i=!1):o=~o&255),t+=o*256**s}return r&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const I_=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class C_{constructor(e=I_,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(r=>{Lt(()=>import("./decoder.CaSv2t6h.js"),[]).then(i=>{r(i.create)})}),this._awaitingDecoder.then(r=>{this._awaitingDecoder=null,this.workers=[];for(let i=0;i<e;i++)this.workers.push({worker:r(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?bc(e).then(r=>r.decode(e,t)):new Promise(r=>{const i=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];i.idle=!1;const s=this.messageId++,o=a=>{a.data.id===s&&(i.idle=!0,r(a.data.decoded),i.worker.removeEventListener("message",o))};i.worker.addEventListener("message",o),i.worker.postMessage({fileDirectory:e,buffer:t,id:s},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const _a=`\r
\r
`;function wc(n){if(typeof Object.fromEntries<"u")return Object.fromEntries(n);const e={};for(const[t,r]of n)e[t.toLowerCase()]=r;return e}function F_(n){const e=n.split(`\r
`).map(t=>{const r=t.split(":").map(i=>i.trim());return r[0]=r[0].toLowerCase(),r});return wc(e)}function O_(n){const[e,...t]=n.split(";").map(i=>i.trim()),r=t.map(i=>i.split("="));return{type:e,params:wc(r)}}function $i(n){let e,t,r;return n&&([,e,t,r]=n.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),t=parseInt(t,10),r=parseInt(r,10)),{start:e,end:t,total:r}}function M_(n,e){let t=null;const r=new TextDecoder("ascii"),i=[],s=`--${e}`,o=`${s}--`;for(let a=0;a<10;++a)r.decode(new Uint8Array(n,a,s.length))===s&&(t=a);if(t===null)throw new Error("Could not find initial boundary");for(;t<n.byteLength;){const a=r.decode(new Uint8Array(n,t,Math.min(s.length+1024,n.byteLength-t)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(s))throw new Error("Part does not start with boundary");const l=a.substr(s.length+2);if(l.length===0)break;const c=l.indexOf(_a),u=F_(l.substr(0,c)),{start:h,end:f,total:d}=$i(u["content-range"]),g=t+s.length+c+_a.length,p=parseInt(f,10)+1-parseInt(h,10);i.push({headers:u,data:n.slice(g,g+p),offset:h,length:p,fileSize:d}),t=g+p+4}return i}class qs{async fetch(e,t=void 0){return Promise.all(e.map(r=>this.fetchSlice(r,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class N_ extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,r]of e)this.onEviction(t,r.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const r=t.get(e);return this._getItemValue(e,r)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,r]=e;this.cache.has(t)||this._deleteIfExpired(t,r)===!1&&(yield e)}for(const e of this.cache){const[t,r]=e;this._deleteIfExpired(t,r)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:r=this.maxAge}={}){const i=typeof r=="number"&&r!==Number.POSITIVE_INFINITY?Date.now()+r:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],r=t.length-e;r<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(r>0&&this._emitEvictions(t.slice(0,r)),this.oldCache=new Map(t.slice(r)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,r]=e;this._deleteIfExpired(t,r)===!1&&(yield[t,r.value])}for(const e of this.oldCache){const[t,r]=e;this.cache.has(t)||this._deleteIfExpired(t,r)===!1&&(yield[t,r.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const r=e[t],[i,s]=r;this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const r=e[t],[i,s]=r;this.cache.has(i)||this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[r,i]of this.entriesAscending())e.call(t,i,r,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function D_(n){return new Promise(e=>setTimeout(e,n))}function U_(n,e){const t=Array.isArray(n)?n:Array.from(n),r=Array.isArray(e)?e:Array.from(e);return t.map((i,s)=>[i,r[s]])}class ar extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,ar),this.name="AbortError"}}class B_ extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const G_=B_;class z_{constructor(e,t,r=null){this.offset=e,this.length=t,this.data=r}get top(){return this.offset+this.length}}class ya{constructor(e,t,r){this.offset=e,this.length=t,this.blockIds=r}}class k_ extends qs{constructor(e,{blockSize:t=65536,cacheSize:r=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new N_({maxSize:r,onEviction:(i,s)=>{this.evictedBlocks.set(i,s)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const r=[],i=[],s=[];this.evictedBlocks.clear();for(const{offset:f,length:d}of e){let g=f+d;const{fileSize:p}=this;p!==null&&(g=Math.min(g,p));const m=Math.floor(f/this.blockSize)*this.blockSize;for(let y=m;y<g;y+=this.blockSize){const _=Math.floor(y/this.blockSize);!this.blockCache.has(_)&&!this.blockRequests.has(_)&&(this.blockIdsToFetch.add(_),i.push(_)),this.blockRequests.has(_)&&r.push(this.blockRequests.get(_)),s.push(_)}}await D_(),this.fetchBlocks(t);const o=[];for(const f of i)this.blockRequests.has(f)&&o.push(this.blockRequests.get(f));await Promise.allSettled(r),await Promise.allSettled(o);const a=[],l=s.filter(f=>this.abortedBlockIds.has(f)||!this.blockCache.has(f));if(l.forEach(f=>this.blockIdsToFetch.add(f)),l.length>0&&t&&!t.aborted){this.fetchBlocks(null);for(const f of l){const d=this.blockRequests.get(f);if(!d)throw new Error(`Block ${f} is not in the block requests`);a.push(d)}await Promise.allSettled(a)}if(t&&t.aborted)throw new ar("Request was aborted");const c=s.map(f=>this.blockCache.get(f)||this.evictedBlocks.get(f)),u=c.filter(f=>!f);if(u.length)throw new G_(u,"Request failed");const h=new Map(U_(s,c));return this.readSliceData(e,h)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),r=this.source.fetch(t,e);for(let i=0;i<t.length;++i){const s=t[i];for(const o of s.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await r)[i],l=o*this.blockSize,c=l-a.offset,u=Math.min(c+this.blockSize,a.data.byteLength),h=a.data.slice(c,u),f=new z_(l,h.byteLength,h,o);this.blockCache.set(o,f),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=e,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort((o,a)=>o-a);if(t.length===0)return[];let r=[],i=null;const s=[];for(const o of t)i===null||i+1===o?(r.push(o),i=o):(s.push(new ya(r[0]*this.blockSize,r.length*this.blockSize,r)),r=[o],i=o);return s.push(new ya(r[0]*this.blockSize,r.length*this.blockSize,r)),s}readSliceData(e,t){return e.map(r=>{let i=r.offset+r.length;this.fileSize!==null&&(i=Math.min(this.fileSize,i));const s=Math.floor(r.offset/this.blockSize),o=Math.floor(i/this.blockSize),a=new ArrayBuffer(r.length),l=new Uint8Array(a);for(let c=s;c<=o;++c){const u=t.get(c),h=u.offset-r.offset,f=u.top-i;let d=0,g=0,p;h<0?d=-h:h>0&&(g=h),f<0?p=u.length-d:p=i-u.offset-d;const m=new Uint8Array(u.data,d,p);l.set(m,g)}return a})}}class Ks{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class Js{constructor(e){this.url=e}async request({headers:e,signal:t}={}){throw new Error("request is not implemented")}}class $_ extends Ks{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class V_ extends Js{constructor(e,t){super(e),this.credentials=t}async request({headers:e,signal:t}={}){const r=await fetch(this.url,{headers:e,credentials:this.credentials,signal:t});return new $_(r)}}class j_ extends Ks{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class X_ extends Js{constructRequest(e,t){return new Promise((r,i)=>{const s=new XMLHttpRequest;s.open("GET",this.url),s.responseType="arraybuffer";for(const[o,a]of Object.entries(e))s.setRequestHeader(o,a);s.onload=()=>{const o=s.response;r(new j_(s,o))},s.onerror=i,s.onabort=()=>i(new ar("Request aborted")),s.send(),t&&(t.aborted&&s.abort(),t.addEventListener("abort",()=>s.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}const wi={};class H_ extends Ks{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class W_ extends Js{constructor(e){super(e),this.parsedUrl=wi.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",wi)}constructRequest(e,t){return new Promise((r,i)=>{const s=this.httpApi.get({...this.parsedUrl,headers:e},o=>{const a=new Promise(l=>{const c=[];o.on("data",u=>{c.push(u)}),o.on("end",()=>{const u=Buffer.concat(c).buffer;l(u)}),o.on("error",i)});r(new H_(o,a))});s.on("error",i),t&&(t.aborted&&s.destroy(new ar("Request aborted")),t.addEventListener("abort",()=>s.destroy(new ar("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class Qs extends qs{constructor(e,t,r,i){super(),this.client=e,this.headers=t,this.maxRanges=r,this.allowFullFile=i,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length>1,Promise.all(e.map(r=>this.fetchSlice(r,t))))}async fetchSlices(e,t){const r=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:i,length:s})=>`${i}-${i+s}`).join(",")}`},signal:t});if(r.ok)if(r.status===206){const{type:i,params:s}=O_(r.getHeader("content-type"));if(i==="multipart/byteranges"){const h=M_(await r.getData(),s.boundary);return this._fileSize=h[0].fileSize||null,h}const o=await r.getData(),{start:a,end:l,total:c}=$i(r.getHeader("content-range"));this._fileSize=c||null;const u=[{data:o,offset:a,length:l-a}];if(e.length>1){const h=await Promise.all(e.slice(1).map(f=>this.fetchSlice(f,t)));return u.concat(h)}return u}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const i=await r.getData();return this._fileSize=i.byteLength,[{data:i,offset:0,length:i.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:r,length:i}=e,s=await this.client.request({headers:{...this.headers,Range:`bytes=${r}-${r+i}`},signal:t});if(s.ok)if(s.status===206){const o=await s.getData(),{total:a}=$i(s.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:r,length:i}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await s.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function eo(n,{blockSize:e,cacheSize:t}){return e===null?n:new k_(n,{blockSize:e,cacheSize:t})}function Z_(n,{headers:e={},credentials:t,maxRanges:r=0,allowFullFile:i=!1,...s}={}){const o=new V_(n,t),a=new Qs(o,e,r,i);return eo(a,s)}function Y_(n,{headers:e={},maxRanges:t=0,allowFullFile:r=!1,...i}={}){const s=new X_(n),o=new Qs(s,e,t,r);return eo(o,i)}function q_(n,{headers:e={},maxRanges:t=0,allowFullFile:r=!1,...i}={}){const s=new W_(n),o=new Qs(s,e,t,r);return eo(o,i)}function Vi(n,{forceXHR:e=!1,...t}={}){return typeof fetch=="function"&&!e?Z_(n,t):typeof XMLHttpRequest<"u"?Y_(n,t):q_(n,t)}class K_ extends qs{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((r,i)=>{const s=this.file.slice(e.offset,e.offset+e.length),o=new FileReader;o.onload=a=>r(a.target.result),o.onerror=i,o.onabort=i,o.readAsArrayBuffer(s),t&&t.addEventListener("abort",()=>o.abort())})}}function J_(n){return new K_(n)}function ji(n){switch(n){case $.BYTE:case $.ASCII:case $.SBYTE:case $.UNDEFINED:return 1;case $.SHORT:case $.SSHORT:return 2;case $.LONG:case $.SLONG:case $.FLOAT:case $.IFD:return 4;case $.RATIONAL:case $.SRATIONAL:case $.DOUBLE:case $.LONG8:case $.SLONG8:case $.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${n}`)}}function Q_(n){const e=n.GeoKeyDirectory;if(!e)return null;const t={};for(let r=4;r<=e[3]*4;r+=4){const i=c_[e[r]],s=e[r+1]?Cr[e[r+1]]:null,o=e[r+2],a=e[r+3];let l=null;if(!s)l=a;else{if(l=n[s],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${i}'.`);typeof l=="string"?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),o===1&&(l=l[0]))}t[i]=l}return t}function Zt(n,e,t,r){let i=null,s=null;const o=ji(e);switch(e){case $.BYTE:case $.ASCII:case $.UNDEFINED:i=new Uint8Array(t),s=n.readUint8;break;case $.SBYTE:i=new Int8Array(t),s=n.readInt8;break;case $.SHORT:i=new Uint16Array(t),s=n.readUint16;break;case $.SSHORT:i=new Int16Array(t),s=n.readInt16;break;case $.LONG:case $.IFD:i=new Uint32Array(t),s=n.readUint32;break;case $.SLONG:i=new Int32Array(t),s=n.readInt32;break;case $.LONG8:case $.IFD8:i=new Array(t),s=n.readUint64;break;case $.SLONG8:i=new Array(t),s=n.readInt64;break;case $.RATIONAL:i=new Uint32Array(t*2),s=n.readUint32;break;case $.SRATIONAL:i=new Int32Array(t*2),s=n.readInt32;break;case $.FLOAT:i=new Float32Array(t),s=n.readFloat32;break;case $.DOUBLE:i=new Float64Array(t),s=n.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===$.RATIONAL||e===$.SRATIONAL)for(let a=0;a<t;a+=2)i[a]=s.call(n,r+a*o),i[a+1]=s.call(n,r+(a*o+4));else for(let a=0;a<t;++a)i[a]=s.call(n,r+a*o);return e===$.ASCII?new TextDecoder("utf-8").decode(i):i}class ey{constructor(e,t,r){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=r}}class _n extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class Tc{async readRasters(e={}){const{window:t,width:r,height:i}=e;let{resX:s,resY:o,bbox:a}=e;const l=await this.getImage();let c=l;const u=await this.getImageCount(),h=l.getBoundingBox();if(t&&a)throw new Error('Both "bbox" and "window" passed.');if(r||i){if(t){const[g,p]=l.getOrigin(),[m,y]=l.getResolution();a=[g+t[0]*m,p+t[1]*y,g+t[2]*m,p+t[3]*y]}const d=a||h;if(r){if(s)throw new Error("Both width and resX passed");s=(d[2]-d[0])/r}if(i){if(o)throw new Error("Both width and resY passed");o=(d[3]-d[1])/i}}if(s||o){const d=[];for(let g=0;g<u;++g){const p=await this.getImage(g),{SubfileType:m,NewSubfileType:y}=p.fileDirectory;(g===0||m===2||y&1)&&d.push(p)}d.sort((g,p)=>g.getWidth()-p.getWidth());for(let g=0;g<d.length;++g){const p=d[g],m=(h[2]-h[0])/p.getWidth(),y=(h[3]-h[1])/p.getHeight();if(c=p,s&&s>m||o&&o>y)break}}let f=t;if(a){const[d,g]=l.getOrigin(),[p,m]=c.getResolution(l);f=[Math.round((a[0]-d)/p),Math.round((a[1]-g)/m),Math.round((a[2]-d)/p),Math.round((a[3]-g)/m)],f=[Math.min(f[0],f[2]),Math.min(f[1],f[3]),Math.max(f[0],f[2]),Math.max(f[1],f[3])]}return c.readRasters({...e,window:f})}}class lr extends Tc{constructor(e,t,r,i,s={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=r,this.firstIFDOffset=i,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const r=this.bigTiff?4048:1024;return new A_((await this.source.fetch([{offset:e,length:typeof t<"u"?t:r}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,r=this.bigTiff?8:2;let i=await this.getSlice(e);const s=this.bigTiff?i.readUint64(e):i.readUint16(e),o=s*t+(this.bigTiff?16:6);i.covers(e,o)||(i=await this.getSlice(e,o));const a={};let l=e+(this.bigTiff?8:2);for(let h=0;h<s;l+=t,++h){const f=i.readUint16(l),d=i.readUint16(l+2),g=this.bigTiff?i.readUint64(l+4):i.readUint32(l+4);let p,m;const y=ji(d),_=l+(this.bigTiff?12:8);if(y*g<=(this.bigTiff?8:4))p=Zt(i,d,g,_);else{const x=i.readOffset(_),w=ji(d)*g;if(i.covers(x,w))p=Zt(i,d,g,x);else{const S=await this.getSlice(x,w);p=Zt(S,d,g,x)}}g===1&&a_.indexOf(f)===-1&&!(d===$.RATIONAL||d===$.SRATIONAL)?m=p[0]:m=p,a[Cr[f]]=m}const c=Q_(a),u=i.readOffset(e+r+t*s);return new ey(a,c,u)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof _n?new _n(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new _n(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new Ec(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(r){if(r instanceof _n)t=!1;else throw r}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",r=t.length+100;let i=await this.getSlice(e,r);if(t===Zt(i,$.ASCII,t.length,e)){const o=Zt(i,$.ASCII,r,e).split(`
`)[0],a=Number(o.split("=")[1].split(" ")[0])+o.length;a>r&&(i=await this.getSlice(e,a));const l=Zt(i,$.ASCII,a,e);this.ghostValues={},l.split(`
`).filter(c=>c.length>0).map(c=>c.split("=")).forEach(([c,u])=>{this.ghostValues[c]=u})}return this.ghostValues}static async fromSource(e,t,r){const i=(await e.fetch([{offset:0,length:1024}],r))[0],s=new L_(i),o=s.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=s.getUint16(2,a);let c;if(l===42)c=!1;else if(l===43){if(c=!0,s.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const u=c?s.getUint64(8,a):s.getUint32(4,a);return new lr(e,a,c,u,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class ty extends Tc{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(t=>t.parseFileDirectoryAt(t.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,r=0;for(let i=0;i<this.imageFiles.length;i++){const s=this.imageFiles[i];for(let o=0;o<this.imageCounts[i];o++){if(e===t){const a=await s.requestIFD(r);return new Ec(a.fileDirectory,a.geoKeyDirectory,s.dataView,s.littleEndian,s.cache,s.source)}t++,r++}r=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(t=>t.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((t,r)=>t+r,0),this.imageCount}}async function ry(n,e={},t){return lr.fromSource(Vi(n,e),t)}async function ny(n,e){return lr.fromSource(J_(n),e)}async function iy(n,e=[],t={},r){const i=await lr.fromSource(Vi(n,t),r),s=await Promise.all(e.map(o=>lr.fromSource(Vi(o,t))));return new ty(i,s)}function sy(n){return((n.fileDirectory.NewSubfileType||0)&4)===4}function oy(n,e){if(!n)return!1;if(n===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,r=Le;return t===r.CMYK||t===r.YCbCr||t===r.CIELab||t===r.ICCLab}const xa="STATISTICS_MAXIMUM",ba="STATISTICS_MINIMUM",Ti=256;let Si;function ay(){return Si||(Si=new C_),Si}function ly(n){try{return n.getBoundingBox(!0)}catch{return[0,0,n.getWidth(),n.getHeight()]}}function cy(n){try{return n.getOrigin().slice(0,2)}catch{return[0,n.getHeight()]}}function uy(n,e){try{return n.getResolution(e)}catch{return[e.getWidth()/n.getWidth(),e.getHeight()/n.getHeight()]}}function hy(n){const e=n.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey&&e.ProjectedCSTypeGeoKey!==32767){const t="EPSG:"+e.ProjectedCSTypeGeoKey;let r=K(t);if(!r){const i=wo(e.ProjLinearUnitsGeoKey);i&&(r=new To({code:t,units:i}))}return r}if(e.GeographicTypeGeoKey&&e.GeographicTypeGeoKey!==32767){const t="EPSG:"+e.GeographicTypeGeoKey;let r=K(t);if(!r){const i=wo(e.GeogAngularUnitsGeoKey);i&&(r=new To({code:t,units:i}))}return r}return null}function fy(n){return n.getImageCount().then(function(e){const t=new Array(e);for(let r=0;r<e;++r)t[r]=n.getImage(r);return Promise.all(t)})}function dy(n,e){let t;return n.blob?t=ny(n.blob):n.overviews?t=iy(n.url,n.overviews,e):t=ry(n.url,e),t.then(fy)}function Pr(n,e,t,r,i){if(Array.isArray(n)){const s=n.length;if(!Array.isArray(e)||s!=e.length){const o=new Error(r);throw i(o),o}for(let o=0;o<s;++o)Pr(n[o],e[o],t,r,i);return}if(e=e,Math.abs(n-e)>t*n)throw new Error(r)}function gy(n){return n instanceof Int8Array?-128:n instanceof Int16Array?-32768:n instanceof Int32Array?-2147483648:n instanceof Float32Array?12e-39:0}function py(n){return n instanceof Int8Array?127:n instanceof Uint8Array||n instanceof Uint8ClampedArray?255:n instanceof Int16Array?32767:n instanceof Uint16Array?65535:n instanceof Int32Array?2147483647:n instanceof Uint32Array?4294967295:n instanceof Float32Array?34e37:255}class to extends nn{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const r=this,i=new Array(t);for(let s=0;s<t;++s)i[s]=dy(this.sourceInfo_[s],this.sourceOptions_);Promise.all(i).then(function(s){r.configure_(s)}).catch(function(s){Vr(s),r.error_=s,r.setState("error")})}getError(){return this.error_}determineProjection(e){const t=e[0];for(let r=t.length-1;r>=0;--r){const i=t[r],s=hy(i);if(s){this.projection=s;break}}}determineTransformMatrix(e){const t=e[0];for(let r=t.length-1;r>=0;--r){const s=t[r].fileDirectory.ModelTransformation;if(s){const[o,a,l,c,u,h,f,d]=s,g=zr(zr([1/Math.sqrt(o*o+u*u),0,0,-1/Math.sqrt(a*a+h*h),c,d],[o,u,a,h,0,0]),[1,0,0,1,-c,-d]);this.transformMatrix=g,this.addAlpha_=!0;break}}}configure_(e){let t,r,i,s,o;const a=new Array(e.length),l=new Array(e.length),c=new Array(e.length);let u=0;const h=e.length;for(let m=0;m<h;++m){const y=[],_=[];e[m].forEach(I=>{sy(I)?_.push(I):y.push(I)});const x=y.length;if(_.length>0&&_.length!==x)throw new Error(`Expected one mask per image found ${_.length} masks and ${x} images`);let w,S;const T=new Array(x),R=new Array(x),L=new Array(x);l[m]=new Array(x),c[m]=new Array(x);for(let I=0;I<x;++I){const C=y[I],j=C.getGDALNoData();c[m][I]=C.getGDALMetadata(0),l[m][I]=j;const z=this.sourceInfo_[m].bands;a[m]=z?z.length:C.getSamplesPerPixel();const Y=x-(I+1);w||(w=ly(C)),S||(S=cy(C));const M=uy(C,y[0]);L[Y]=M[0];const W=[C.getTileWidth(),C.getTileHeight()];W[0]!==W[1]&&W[1]<Ti&&(W[0]=Ti,W[1]=Ti),T[Y]=W;const ge=M[0]/Math.abs(M[1]);R[Y]=[W[0],W[1]/ge]}if(t?kt(t,w,t):t=w,!r)r=S;else{const I=`Origin mismatch for source ${m}, got [${S}] but expected [${r}]`;Pr(r,S,0,I,this.viewRejector)}if(!o)o=L,this.resolutionFactors_[m]=1;else{o.length-u>L.length&&(u=o.length-L.length);const I=o[o.length-1]/L[L.length-1];this.resolutionFactors_[m]=I;const C=L.map(z=>z*=I),j=`Resolution mismatch for source ${m}, got [${C}] but expected [${o}]`;Pr(o.slice(u,o.length),C,.02,j,this.viewRejector)}i?Pr(i.slice(u,i.length),R,.01,`Tile size mismatch for source ${m}`,this.viewRejector):i=R,s?Pr(s.slice(u,s.length),T,0,`Tile size mismatch for source ${m}`,this.viewRejector):s=T,this.sourceImagery_[m]=y.reverse(),this.sourceMasks_[m]=_.reverse()}for(let m=0,y=this.sourceImagery_.length;m<y;++m){const _=this.sourceImagery_[m];for(;_.length<o.length;)_.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.determineTransformMatrix(e),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=c;e:for(let m=0;m<h;++m){if(this.sourceInfo_[m].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[m].length){this.addAlpha_=!0;break}const y=l[m],_=this.sourceInfo_[m].bands;if(_){for(let x=0;x<_.length;++x)if(y[_[x]-1]!==null){this.addAlpha_=!0;break e}continue}for(let x=0;x<y.length;++x)if(y[x]!==null){this.addAlpha_=!0;break e}}let f=this.addAlpha_?1:0;for(let m=0;m<h;++m)f+=a[m];this.bandCount=f;const d=new qn({extent:t,minZoom:u,origin:r,resolutions:o,tileSizes:i});this.tileGrid=d,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const g=1;o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]);let p=t;if(this.transformMatrix){const m=$r(be(),this.transformMatrix.slice()),y=nh(_=>dt(m,_));p=sr(t,y)}this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:th(Tt(p),this.projection),extent:rh(p,this.projection),zoom:g})}loadTile_(e,t,r,i){const s=this.getTileSize(e),o=this.sourceImagery_.length,a=new Array(o*2),l=this.nodataValues_,c=this.sourceInfo_,u=ay();for(let h=0;h<o;++h){const f=c[h],d=this.resolutionFactors_[h],g=[Math.round(t*(s[0]*d)),Math.round(r*(s[1]*d)),Math.round((t+1)*(s[0]*d)),Math.round((r+1)*(s[1]*d))],p=this.sourceImagery_[h][e];let m;f.bands&&(m=f.bands.map(function(S){return S-1}));let y;"nodata"in f&&f.nodata!==null?y=f.nodata:m?y=m.map(function(S){return l[h][S]}):y=l[h];const _={window:g,width:s[0],height:s[1],samples:m,fillValue:y,pool:u,interleave:!1,signal:i.signal};oy(this.convertToRGB_,p)?a[h]=p.readRGB(_):a[h]=p.readRasters(_);const x=o+h,w=this.sourceMasks_[h][e];if(!w){a[x]=Promise.resolve(null);continue}a[x]=w.readRasters({window:g,width:s[0],height:s[1],samples:[0],pool:u,interleave:!1})}return Promise.all(a).then(this.composeTile_.bind(this,s)).catch(function(h){throw Vr(h),h})}composeTile_(e,t){const r=this.metadata_,i=this.sourceInfo_,s=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,c=this.normalize_,u=this.addAlpha_,h=e[0]*e[1],f=h*o;let d;c?d=new Uint8Array(f):d=new Float32Array(f);let g=0;for(let p=0;p<h;++p){let m=u;for(let y=0;y<s;++y){const _=i[y];let x=_.min,w=_.max,S,T;if(c){const R=r[y][0];x===void 0&&(R&&ba in R?x=parseFloat(R[ba]):x=gy(t[y][0])),w===void 0&&(R&&xa in R?w=parseFloat(R[xa]):w=py(t[y][0])),S=255/(w-x),T=-x*S}for(let R=0;R<a[y];++R){const L=t[y][R][p];let I;if(c?I=ue(S*L+T,0,255):I=L,!u)d[g]=I;else{let C=_.nodata;if(C===void 0){let z;_.bands?z=_.bands[R]-1:z=R,C=l[y][z]}const j=isNaN(C);(!j&&L!==C||j&&!isNaN(L))&&(m=!1,d[g]=I)}g++}if(!m){const R=s+y,L=t[R];L&&!L[0][p]&&(m=!0)}}u&&(m||(d[g]=255),g++)}return d}}to.prototype.getView;const my="https://tile.googleapis.com/v1/createSession",_y="https://tile.googleapis.com/v1/2dtiles",yy="https://tile.googleapis.com/tile/v1/viewport",xy=22;class by extends mt{constructor(e){const t=!!e.highDpi;super({attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,projection:"EPSG:3857",reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.apiKey_=e.key,this.error_=null;const r={mapType:e.mapType||"roadmap",language:e.language||"en-US",region:e.region||"US"};e.imageFormat&&(r.imageFormat=e.imageFormat),e.scale&&(r.scale=e.scale),t&&(r.highDpi=!0),e.layerTypes&&(r.layerTypes=e.layerTypes),e.styles&&(r.styles=e.styles),e.overlay===!0&&(r.overlay=!0),e.apiOptions&&(r.apiOptions=e.apiOptions),this.sessionTokenRequest_=r,this.sessionTokenValue_,this.sessionRefreshId_,this.previousViewportAttribution_,this.previousViewportExtent_,this.createSession_()}getError(){return this.error_}fetchSessionToken(e,t){return fetch(e,t)}async createSession_(){const e=my+"?key="+this.apiKey_,t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.sessionTokenRequest_)},r=await this.fetchSessionToken(e,t);if(!r.ok){try{const h=await r.json();this.error_=new Error(h.error.message)}catch{this.error_=new Error("Error fetching session token")}this.setState("error");return}const i=await r.json(),s=this.getTilePixelRatio(1),o=[i.tileWidth/s,i.tileHeight/s];this.tileGrid=qr({extent:Yr(this.getProjection()),maxZoom:xy,tileSize:o});const a=i.session;this.sessionTokenValue_=a;const l=this.apiKey_;this.tileUrlFunction=function(h,f,d){const g=h[0],p=h[1],m=h[2];return`${_y}/${g}/${p}/${m}?session=${a}&key=${l}`};const c=parseInt(i.expiry,10)*1e3,u=Math.max(c-Date.now()-60*1e3,1);this.sessionRefreshId_=setTimeout(()=>this.createSession_(),u),this.setAttributions(this.fetchAttributions_.bind(this)),this.setState("ready")}async fetchAttributions_(e){if(e.viewHints[St.ANIMATING]||e.viewHints[St.INTERACTING]||e.animate)return this.previousViewportAttribution_;const[t,r]=So(gh(e.extent),e.viewState.projection),[i,s]=So(ph(e.extent),e.viewState.projection),l=`zoom=${this.getTileGrid().getZForResolution(e.viewState.resolution,this.zDirection)}&north=${s}&south=${r}&east=${i}&west=${t}`;if(this.previousViewportExtent_==l)return this.previousViewportAttribution_;this.previousViewportExtent_=l;const c=this.sessionTokenValue_,u=this.apiKey_,h=`${yy}?session=${c}&key=${u}&${l}`;return this.previousViewportAttribution_=await fetch(h).then(f=>f.json()).then(f=>f.copyright),this.previousViewportAttribution_}disposeInternal(){clearTimeout(this.sessionRefreshId_),super.disposeInternal()}}let Sc=class extends es{constructor(e,t,r,i,s,o,a){super(t,r,i,s,o,a),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==he.LOADED){const t=this.tileSize_;if(e.width==t[0]&&e.height==t[1])return this.zoomifyImage_=e,e;const r=zt(t[0],t[1]);return r.drawImage(e,0,0),this.zoomifyImage_=r.canvas,r.canvas}return e}};class Ey extends mt{constructor(e){const t=e.size,r=e.tierSizeCalculation!==void 0?e.tierSizeCalculation:"default",i=e.tilePixelRatio||1,s=t[0],o=t[1],a=[],l=e.tileSize||Ci;let c=l*i;switch(r){case"default":for(;s>c||o>c;)a.push([Math.ceil(s/c),Math.ceil(o/c)]),c+=c;break;case"truncated":let T=s,R=o;for(;T>c||R>c;)a.push([Math.ceil(T/c),Math.ceil(R/c)]),T>>=1,R>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}a.push([1,1]),a.reverse();const u=[i],h=[0];for(let T=1,R=a.length;T<R;T++)u.push(i<<T),h.push(a[T-1][0]*a[T-1][1]+h[T-1]);u.reverse();const f=new qn({tileSize:l,extent:e.extent||[0,-o,s,0],resolutions:u});let d=e.url;d&&!d.includes("{TileGroup}")&&!d.includes("{tileIndex}")&&(d+="{TileGroup}/{z}-{x}-{y}.jpg");const g=Ka(d);let p=l*i;function m(T){return function(R,L,I){if(!R)return;const C=R[0],j=R[1],z=R[2],Y=j+z*a[C][0],M=(Y+h[C])/p|0,W={z:C,x:j,y:z,tileIndex:Y,TileGroup:"TileGroup"+M};return T.replace(/\{(\w+?)\}/g,function(ge,ae){return W[ae]})}}const y=ss(g.map(m)),_=Sc.bind(null,Ze(l*i));super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,tilePixelRatio:i,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:_,tileGrid:f,tileUrlFunction:y,transition:e.transition}),this.zDirection=e.zDirection;const x=f.getTileCoordForCoordAndResolution(Tt(f.getExtent()),u[u.length-1]),w=y(x,1,null),S=new Image;S.addEventListener("error",()=>{p=l,this.changed()}),S.src=w}}function wr(n){return n.toLocaleString("en",{maximumFractionDigits:10})}class wy extends mt{constructor(e){const t=e||{};let r=t.url||"";r=r+(r.lastIndexOf("/")===r.length-1||r===""?"":"/");const i=t.version||pe.VERSION2,s=t.sizes||[],o=t.size;qe(o!=null&&Array.isArray(o)&&o.length==2&&!isNaN(o[0])&&o[0]>0&&!isNaN(o[1])&&o[1]>0,"Missing or invalid `size`");const a=o[0],l=o[1],c=t.tileSize,u=t.tilePixelRatio||1,h=t.format||"jpg",f=t.quality||(t.version==pe.VERSION1?"native":"default");let d=t.resolutions||[];const g=t.supports||[],p=t.extent||[0,-l,a,0],m=s!=null&&Array.isArray(s)&&s.length>0,y=c!==void 0&&(typeof c=="number"&&Number.isInteger(c)&&c>0||Array.isArray(c)&&c.length>0),_=g!=null&&Array.isArray(g)&&(g.includes("regionByPx")||g.includes("regionByPct"))&&(g.includes("sizeByWh")||g.includes("sizeByH")||g.includes("sizeByW")||g.includes("sizeByPct"));let x,w,S;if(d.sort(function(I,C){return C-I}),y||_)if(c!=null&&(typeof c=="number"&&Number.isInteger(c)&&c>0?(x=c,w=c):Array.isArray(c)&&c.length>0&&((c.length==1||c[1]==null&&Number.isInteger(c[0]))&&(x=c[0],w=c[0]),c.length==2&&(Number.isInteger(c[0])&&Number.isInteger(c[1])?(x=c[0],w=c[1]):c[0]==null&&Number.isInteger(c[1])&&(x=c[1],w=c[1])))),(x===void 0||w===void 0)&&(x=Ci,w=Ci),d.length==0){S=Math.max(Math.ceil(Math.log(a/x)/Math.LN2),Math.ceil(Math.log(l/w)/Math.LN2));for(let I=S;I>=0;I--)d.push(Math.pow(2,I))}else{const I=Math.max(...d);S=Math.round(Math.log(I)/Math.LN2)}else if(x=a,w=l,d=[],m){s.sort(function(C,j){return C[0]-j[0]}),S=-1;const I=[];for(let C=0;C<s.length;C++){const j=a/s[C][0];if(d.length>0&&d[d.length-1]==j){I.push(C);continue}d.push(j),S++}if(I.length>0)for(let C=0;C<I.length;C++)s.splice(I[C]-C,1)}else d.push(1),s.push([a,l]),S=0;const T=new qn({tileSize:[x,w],extent:p,origin:mh(p),resolutions:d}),R=function(I,C,j){let z,Y;const M=I[0];if(M>S)return;const W=I[1],ge=I[2],ae=d[M];if(!(W===void 0||ge===void 0||ae===void 0||W<0||Math.ceil(a/ae/x)<=W||ge<0||Math.ceil(l/ae/w)<=ge)){if(_||y){const se=W*x*ae,_e=ge*w*ae;let Ue=x*ae,ze=w*ae,Fe=x,ot=w;if(se+Ue>a&&(Ue=a-se),_e+ze>l&&(ze=l-_e),se+x*ae>a&&(Fe=Math.floor((a-se+ae-1)/ae)),_e+w*ae>l&&(ot=Math.floor((l-_e+ae-1)/ae)),se==0&&Ue==a&&_e==0&&ze==l)z="full";else if(!_||g.includes("regionByPx"))z=se+","+_e+","+Ue+","+ze;else if(g.includes("regionByPct")){const at=wr(se/a*100),It=wr(_e/l*100),ke=wr(Ue/a*100),$e=wr(ze/l*100);z="pct:"+at+","+It+","+ke+","+$e}i==pe.VERSION3&&(!_||g.includes("sizeByWh"))?Y=Fe+","+ot:!_||g.includes("sizeByW")?Y=Fe+",":g.includes("sizeByH")?Y=","+ot:g.includes("sizeByWh")?Y=Fe+","+ot:g.includes("sizeByPct")&&(Y="pct:"+wr(100/ae))}else if(z="full",m){const se=s[M][0],_e=s[M][1];i==pe.VERSION3?se==a&&_e==l?Y="max":Y=se+","+_e:se==a?Y="full":Y=se+","}else Y=i==pe.VERSION3?"max":"full";return r+z+"/"+Y+"/0/"+f+"."+h}},L=Sc.bind(null,Ze(c||256).map(function(I){return I*u}));super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:t.state,tileClass:L,tileGrid:T,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:R,transition:t.transition}),this.zDirection=t.zDirection}}function Rc(n,e,t,r,i,s){const o=i.getCode().split(/:(?=\d+$)/).pop(),a=t/r,l=[Ro(De(e)/a,yo),Ro(vt(e)/a,yo)];s.SIZE=l[0]+","+l[1],s.BBOX=e.join(","),s.BBOXSR=o,s.IMAGESR=o,s.DPI=Math.round(s.DPI?s.DPI*r:90*r);const c=n.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return In(c,s)}function vc(n){const e=n.load?n.load:fr,t=K(n.projection||"EPSG:3857"),r=n.ratio??1.5,i=n.crossOrigin??null;return function(s,o,a){a=n.hidpi?a:1;const l={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(l,n.params),s=Ja(s,o,a,r);const c=Rc(n.url,s,o,a,t,l),u=new Image;return u.crossOrigin=i,e(u,c).then(h=>{const f=De(s)/h.width*a;return{image:h,extent:s,resolution:f,pixelRatio:a}})}}class Ty extends jt{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:os,this.params_=Object.assign({},e.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,r,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=vc({crossOrigin:this.crossOrigin_,params:this.params_,projection:i,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),fr(s))})),super.getImageInternal(e,t,r,i))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}class Sy extends jt{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions,state:e.state}),this.canvasFunction_=e.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5}getImageInternal(e,t,r,i){t=this.findNearestResolution(t);let s=this.canvas_;if(s&&this.renderedRevision_==this.getRevision()&&s.getResolution()==t&&s.getPixelRatio()==r&&Fn(s.getExtent(),e))return s;e=e.slice(),ul(e,this.ratio_);const o=De(e)/t,a=vt(e)/t,l=[o*r,a*r],c=this.canvasFunction_.call(this,e,t,r,l,i);return c&&(s=new ys(e,t,r,c)),this.canvas_=s,this.renderedRevision_=this.getRevision(),s}}function Ry(n,e,t,r){const i=De(n),s=vt(n),o=e[0],a=e[1],l=.0254/r;return a*i>o*s?i*t/(o*l):s*t/(a*l)}function vy(n,e,t,r,i,s,o){const a=Ry(t,r,s,o),l=Tt(t),c={OPERATION:i?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:o,SETDISPLAYWIDTH:Math.round(r[0]),SETDISPLAYHEIGHT:Math.round(r[1]),SETVIEWSCALE:a,SETVIEWCENTERX:l[0],SETVIEWCENTERY:l[1]};return Object.assign(c,e),In(n,c)}function Pc(n){const e=n.load||fr,t=n.useOverlay??!1,r=n.metersPerUnit||1,i=n.displayDpi||96,s=n.ratio??1,o=n.crossOrigin??null;return function(a,l,c){const u=new Image;u.crossOrigin=o,a=Ja(a,l,c,s);const h=De(a)/l,f=vt(a)/l,d=[h*c,f*c],g=vy(n.url,n.params,a,d,t,r,i);return e(u,g).then(p=>({image:p,extent:a,pixelRatio:c}))}}class Py extends jt{constructor(e){super({interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.displayDpi_=e.displayDpi!==void 0?e.displayDpi:96,this.params_=Object.assign({},e.params),this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:os,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.metersPerUnit_=e.metersPerUnit!==void 0?e.metersPerUnit:1,this.ratio_=e.ratio!==void 0?e.ratio:1,this.useOverlay_=e.useOverlay!==void 0?e.useOverlay:!1,this.renderedRevision_=0,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,r,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=Pc({crossOrigin:this.crossOrigin_,params:this.params_,hidpi:this.hidpi_,metersPerUnit:this.metersPerUnit_,url:this.url_,useOverlay:this.useOverlay_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),fr(s))})),super.getImageInternal(e,t,r,i))}getImageLoadFunction(){return this.imageLoadFunction_}updateParams(e){Object.assign(this.params_,e),this.changed()}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}changed(){this.image=null,super.changed()}}function Lc(n){const e=n.load||fr,t=n.imageExtent,r=n.crossOrigin??null;return()=>{const i=new Image;return i.crossOrigin=r,e(i,n.url).then(s=>{const o=De(t)/s.width,a=vt(t)/s.height;return{image:s,extent:t,resolution:o!==a?[o,a]:a,pixelRatio:1}})}}class Ac extends jt{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,r=e.imageLoadFunction!==void 0?e.imageLoadFunction:os;super({attributions:e.attributions,interpolate:e.interpolate,projection:K(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new Va(this.imageExtent_,void 0,1,Lc({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(i,s)=>(this.image.setImage(i),r(this.image,s),fr(i))})),this.image.addEventListener(Ie.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,r,i){return ir(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}const Ly=new Error("Image failed to load");function Ic(n,e,t,r,i){return new Promise((s,o)=>{const a=new Image;a.crossOrigin=i.crossOrigin??null,a.addEventListener("load",()=>s(a)),a.addEventListener("error",()=>o(Ly)),a.src=Qa(n,e,t,r,i.maxY)})}function Ea(n){return function(e,t,r,i){const s=Su(n,e,t,r);return Ic(s,e,t,r,i)}}function Ay(n){return function(e,t,r,i){const s=n(e,t,r,i);return Ic(s,e,t,r,i)}}function wa(n){let e;if(Array.isArray(n))e=Ea(n);else if(typeof n=="string"){const t=Ka(n);e=Ea(t)}else if(typeof n=="function")e=Ay(n);else throw new Error("The url option must be a single template, an array of templates, or a function for getting a URL");return e}let Ta=0;function Sa(n){return Array.isArray(n)?n.join(`
`):typeof n=="string"?n:(++Ta,"url-function-key-"+Ta)}class Cc extends nn{constructor(e){e=e||{};let t=e.loader,r;e.url&&(t=wa(e.url),r=Sa(e.url));const i=t?e.state:"loading",s=e.wrapX===void 0?!0:e.wrapX;super({loader:t,key:r,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize,gutter:e.gutter,maxResolution:e.maxResolution,projection:e.projection,tileGrid:e.tileGrid,state:i,wrapX:s,transition:e.transition,interpolate:e.interpolate!==!1,crossOrigin:e.crossOrigin,zDirection:e.zDirection})}setUrl(e){const t=wa(e);this.setLoader(t),this.setKey(Sa(e)),this.getState()!=="ready"&&this.setState("ready")}}function ro(n,e,t,r){const i=document.createElement("script"),s="olc_"+ne(e);function o(){delete window[s],i.parentNode.removeChild(i)}i.async=!0,i.src=n+(n.includes("?")?"&":"?")+"callback="+s;const a=setTimeout(function(){o(),t&&t()},1e4);window[s]=function(l){clearTimeout(a),o(),e(l)},document.head.appendChild(i)}class Iy extends Error{constructor(e){const t="Unexpected response status: "+e.status;super(t),this.name="ResponseError",this.response=e}}class Cy extends Error{constructor(e){super("Failed to issue request"),this.name="ClientError",this.client=e}}function Fc(n){return new Promise(function(e,t){function r(o){const a=o.target;if(!a.status||a.status>=200&&a.status<300){let l;try{l=JSON.parse(a.responseText)}catch(c){const u="Error parsing response text as JSON: "+c.message;t(new Error(u));return}e(l);return}t(new Iy(a))}function i(o){t(new Cy(o.target))}const s=new XMLHttpRequest;s.addEventListener("load",r),s.addEventListener("error",i),s.open("GET",n),s.setRequestHeader("Accept","application/json"),s.send()})}function Oc(n,e){return e.includes("://")?e:new URL(e,n).href}const Fy={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},Oy={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function Mc(n,e){if(!e.length)return n;const t=new URL(n,"file:/");if(t.pathname.split("/").includes("collections"))return Vr('The "collections" query parameter cannot be added to collection endpoints'),n;const r=e.map(o=>encodeURIComponent(o)).join(",");t.searchParams.append("collections",r);const i=n.split("?")[0],s=decodeURIComponent(t.searchParams.toString());return`${i}?${s}`}function My(n,e,t){let r,i;for(let s=0;s<n.length;++s){const o=n[s];if(o.rel==="item"){if(o.type===e){r=o.href;break}(Fy[o.type]||!i&&o.type.startsWith("image/"))&&(i=o.href)}}if(!r)if(i)r=i;else throw new Error('Could not find "item" link');return t&&(r=Mc(r,t)),r}function Ny(n,e,t,r){let i,s;const o={};for(let a=0;a<n.length;++a){const l=n[a];if(o[l.type]=l.href,l.rel==="item"){if(l.type===e){i=l.href;break}Oy[l.type]&&(s=l.href)}}if(!i&&t)for(let a=0;a<t.length;++a){const l=t[a];if(o[l]){i=o[l];break}}if(!i)if(s)i=s;else throw new Error('Could not find "item" link');return r&&(i=Mc(i,r)),i}function Ra(n,e,t,r){let i=n.projection;if(!i&&(typeof e.crs=="string"?i=K(e.crs):"uri"in e.crs&&(i=K(e.crs.uri)),!i))throw new Error(`Unsupported CRS: ${JSON.stringify(e.crs)}`);const s=e.orderedAxes,a=!(s?s.slice(0,2).map(T=>T.replace(/E|X|Lon/i,"e").replace(/N|Y|Lat/i,"n")).join(""):i.getAxisOrientation()).startsWith("en"),l=e.tileMatrices,c={};for(let T=0;T<l.length;++T){const R=l[T];c[R.id]=R}const u={},h=[];if(r)for(let T=0;T<r.length;++T){const R=r[T],L=R.tileMatrix;h.push(L),u[L]=R}else for(let T=0;T<l.length;++T){const R=l[T].id;h.push(R)}const f=h.length,d=new Array(f),g=new Array(f),p=new Array(f),m=new Array(f),y=[-1/0,-1/0,1/0,1/0];for(let T=0;T<f;++T){const R=h[T],L=c[R],I=L.pointOfOrigin;a?d[T]=[I[1],I[0]]:d[T]=I,g[T]=L.cellSize,p[T]=[L.matrixWidth,L.matrixHeight],m[T]=[L.tileWidth,L.tileHeight];const C=u[R];if(C){const j=L.cellSize*L.tileWidth,z=d[T][0]+C.minTileCol*j,Y=d[T][0]+(C.maxTileCol+1)*j,M=L.cellSize*L.tileHeight,W=L.cornerOfOrigin==="bottomLeft";let ge,ae;W?(ge=d[T][1]+C.minTileRow*M,ae=d[T][1]+(C.maxTileRow+1)*M):(ge=d[T][1]-(C.maxTileRow+1)*M,ae=d[T][1]-C.minTileRow*M),kt(y,[z,ge,Y,ae],y)}}const _=new qn({origins:d,resolutions:g,sizes:p,tileSizes:m,extent:r?y:void 0}),x=n.context,w=n.url;function S(T,R,L){if(!T)return;const I=h[T[0]],C=c[I],j=C.cornerOfOrigin==="bottomLeft",z={tileMatrix:I,tileCol:T[1],tileRow:j?-T[2]-1:T[2]};if(r){const M=u[C.id];if(z.tileCol<M.minTileCol||z.tileCol>M.maxTileCol||z.tileRow<M.minTileRow||z.tileRow>M.maxTileRow)return}Object.assign(z,x);const Y=t.replace(/\{(\w+?)\}/g,function(M,W){return z[W]});return Oc(w,Y)}return{grid:_,projection:i,urlTemplate:t,urlFunction:S}}function Dy(n,e){const t=e.tileMatrixSetLimits;let r;if(e.dataType==="map")r=My(e.links,n.mediaType,n.collections);else if(e.dataType==="vector")r=Ny(e.links,n.mediaType,n.supportedMediaTypes,n.collections);else throw new Error('Expected tileset data type to be "map" or "vector"');if(e.tileMatrixSet)return Ra(n,e.tileMatrixSet,r,t);const i=e.links.find(a=>a.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!i)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const s=i.href,o=Oc(n.url,s);return Fc(o).then(function(a){return Ra(n,a,r,t)})}function Nc(n){return Fc(n.url).then(function(e){return Dy(n,e)})}class Uy extends mt{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition});const t={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,context:e.context||null,collections:e.collections};Nc(t).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.projection=e.projection,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){Vr(e),this.setState("error")}}class By extends Kn{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,format:e.format,overlaps:e.overlaps,projection:e.projection,tileClass:e.tileClass,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection,state:"loading"});const t={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,supportedMediaTypes:e.format.supportedMediaTypes,context:e.context||null,collections:e.collections};Nc(t).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.projection=e.projection,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){Vr(e),this.setState("error")}}function Dc(n){return function(e){const t=e.buffers,r=e.meta,i=e.imageOps,s=e.width,o=e.height,a=t.length,l=t[0].byteLength;if(i){const f=new Array(a);for(let g=0;g<a;++g)f[g]=new ImageData(new Uint8ClampedArray(t[g]),s,o);return n(f,r).data.buffer}const c=new Uint8ClampedArray(l),u=new Array(a),h=new Array(a);for(let f=0;f<a;++f)u[f]=new Uint8ClampedArray(t[f]),h[f]=[0,0,0,0];for(let f=0;f<l;f+=4){for(let g=0;g<a;++g){const p=u[g];h[g][0]=p[f],h[g][1]=p[f+1],h[g][2]=p[f+2],h[g][3]=p[f+3]}const d=n(h,r);c[f]=d[0],c[f+1]=d[1],c[f+2]=d[2],c[f+3]=d[3]}return c.buffer}}function Gy(n,e){const r=Object.keys(n.lib||{}).map(function(s){return"const "+s+" = "+n.lib[s].toString()+";"}).concat(["const __minion__ = ("+Dc.toString()+")(",n.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),i=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(r.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(r,{type:"text/javascript"})));return i.addEventListener("message",e),i}function zy(n,e){const t=Dc(n.operation);let r=!1;return{postMessage:function(i){setTimeout(function(){r||e({data:{buffer:t(i),meta:i.meta}})},0)},terminate:function(){r=!0}}}class ky extends ll{constructor(e){super(),this.imageOps_=!!e.imageOps;let t;e.threads===0?t=0:this.imageOps_?t=1:t=e.threads||1;const r=new Array(t);if(t)for(let i=0;i<t;++i)r[i]=Gy(e,this.onWorkerMessage_.bind(this,i));else r[0]=zy(e,this.onWorkerMessage_.bind(this,0));this.workers_=r,this.queue_=[],this.maxQueueLength_=e.queue||1/0,this.running_=0,this.dataLookup_={},this.job_=null}process(e,t,r){this.enqueue_({inputs:e,meta:t,callback:r}),this.dispatch_()}enqueue_(e){for(this.queue_.push(e);this.queue_.length>this.maxQueueLength_;)this.queue_.shift().callback(null,null)}dispatch_(){if(this.running_||this.queue_.length===0)return;const e=this.queue_.shift();this.job_=e;const t=e.inputs[0].width,r=e.inputs[0].height,i=e.inputs.map(function(l){return l.data.buffer}),s=this.workers_.length;if(this.running_=s,s===1){this.workers_[0].postMessage({buffers:i,meta:e.meta,imageOps:this.imageOps_,width:t,height:r},i);return}const o=e.inputs[0].data.length,a=4*Math.ceil(o/4/s);for(let l=0;l<s;++l){const c=l*a,u=[];for(let h=0,f=i.length;h<f;++h)u.push(i[h].slice(c,c+a));this.workers_[l].postMessage({buffers:u,meta:e.meta,imageOps:this.imageOps_,width:t,height:r},u)}}onWorkerMessage_(e,t){this.disposed||(this.dataLookup_[e]=t.data,--this.running_,this.running_===0&&this.resolveJob_())}resolveJob_(){const e=this.job_,t=this.workers_.length;let r,i;if(t===1)r=new Uint8ClampedArray(this.dataLookup_[0].buffer),i=this.dataLookup_[0].meta;else{const s=e.inputs[0].data.length;r=new Uint8ClampedArray(s),i=new Array(t);const o=4*Math.ceil(s/4/t);for(let a=0;a<t;++a){const l=this.dataLookup_[a].buffer,c=a*o;r.set(new Uint8ClampedArray(l),c),i[a]=this.dataLookup_[a].meta}}this.job_=null,this.dataLookup_={},e.callback(null,new ImageData(r,e.inputs[0].width,e.inputs[0].height),i),this.dispatch_()}disposeInternal(){for(let e=0;e<this.workers_.length;++e)this.workers_[e].terminate();this.workers_.length=0}}const va={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class Pa extends hl{constructor(e,t,r){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=r}}class Uc extends jt{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=e.operationType!==void 0?e.operationType:"pixel",this.threads_=e.threads!==void 0?e.threads:1,this.layers_=jy(e.sources);const t=this.changed.bind(this);for(let r=0,i=this.layers_.length;r<i;++r)this.layers_[r].addEventListener(Ie.CHANGE,t);this.useResolutions_=e.resolutions!==null,this.tileQueue_=new Ru(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:be(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:Vy(this.layers_),pixelRatio:1,pixelToCoordinateTransform:be(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:ne(this),renderTargets:{}},this.setAttributions(function(r){var s;const i=[];for(let o=0,a=e.sources.length;o<a;++o){const l=e.sources[o],c=l instanceof as?l:l.getSource();if(!c)continue;const u=(s=c.getAttributions())==null?void 0:s(r);typeof u=="string"?i.push(u):u!==void 0&&i.push(...u)}return i}),e.operation!==void 0&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new ky({operation:e,imageOps:this.operationType_==="image",queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,r){const i=Object.assign({},this.frameState_);i.viewState=Object.assign({},i.viewState);const s=Tt(e);i.size[0]=Math.ceil(De(e)/t),i.size[1]=Math.ceil(vt(e)/t),i.extent=[s[0]-i.size[0]*t/2,s[1]-i.size[1]*t/2,s[0]+i.size[0]*t/2,s[1]+i.size[1]*t/2],i.time=Date.now();const o=i.viewState;return o.center=s,o.projection=r,o.resolution=t,i}allSourcesReady_(){let e=!0,t;for(let r=0,i=this.layers_.length;r<i;++r)if(t=this.layers_[r].getSource(),!t||t.getState()!=="ready"){e=!1;break}return e}getImage(e,t,r,i){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);const s=this.updateFrameState_(e,t,i);if(this.requestedFrameState_=s,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(t!==o||!jr(s.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,t=this.layers_.length,r=new Array(t);for(let s=0;s<t;++s){e.layerIndex=s,e.renderTargets={};const o=$y(this.layers_[s],e);if(o)r[s]=o;else return}const i={};this.dispatchEvent(new Pa(va.BEFOREOPERATIONS,e,i)),this.processor_.process(r,i,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,r,i){if(t||!r)return;const s=e.extent,o=e.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!jr(s,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(De(s)/o),c=Math.round(vt(s)/o);a=zt(l,c),this.renderedImageCanvas_=new ys(s,o,1,a.canvas)}a.putImageData(r,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new Pa(va.AFTEROPERATIONS,e,i))}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let r=0,i=this.layers_.length;r<i&&(t=this.layers_[r].getSource().getResolutions(e),!t);++r);return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}Uc.prototype.dispose;let Ot=null;function $y(n,e){const t=n.getRenderer();if(!t)throw new Error("Unsupported layer type: "+n);if(!t.prepareFrame(e))return null;const r=e.size[0],i=e.size[1];if(r===0||i===0)return null;const s=t.renderFrame(e,null);let o;if(s instanceof HTMLCanvasElement)o=s;else{if(s&&(o=s.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===r&&o.height===i)return o.getContext("2d").getImageData(0,0,r,i)}if(!Ot)Ot=zt(r,i,void 0,{willReadFrequently:!0});else{const a=Ot.canvas;a.width!==r||a.height!==i?Ot=zt(r,i,void 0,{willReadFrequently:!0}):Ot.clearRect(0,0,r,i)}return Ot.drawImage(o,0,0,r,i),Ot.getImageData(0,0,r,i)}function Vy(n){return n.map(function(e){return e.getLayerState()})}function jy(n){const e=n.length,t=new Array(e);for(let r=0;r<e;++r)t[r]=Xy(n[r]);return t}function Xy(n){let e;return n instanceof as?n instanceof Yn?e=new An({source:n}):n instanceof jt&&(e=new is({source:n})):e=n,e}const Hy='&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>',Wy='&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',Zy='&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>',Yy={stamen_terrain:{extension:"png"},stamen_terrain_background:{extension:"png"},stamen_terrain_labels:{extension:"png"},stamen_terrain_lines:{extension:"png"},stamen_toner_background:{extension:"png"},stamen_toner:{extension:"png"},stamen_toner_labels:{extension:"png"},stamen_toner_lines:{extension:"png"},stamen_toner_lite:{extension:"png"},stamen_watercolor:{extension:"jpg"},alidade_smooth:{extension:"png"},alidade_smooth_dark:{extension:"png"},alidade_satellite:{extension:"png"},outdoors:{extension:"png"},osm_bright:{extension:"png"}},qy={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};class Ky extends Gr{constructor(e){const t=e.layer.indexOf("-"),r=t==-1?e.layer:e.layer.slice(0,t),i=qy[r]||{minZoom:0,maxZoom:20,retina:!0},s=Yy[e.layer],o=e.apiKey?"?api_key="+e.apiKey:"",a=i.retina&&e.retina?"@2x":"",l=e.url!==void 0?e.url:"https://tiles.stadiamaps.com/tiles/"+e.layer+"/{z}/{x}/{y}"+a+"."+s.extension+o,c=[Hy,Wy,vu];e.layer.startsWith("stamen_")&&c.splice(1,0,Zy),super({attributions:c,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:i.maxZoom,minZoom:e.minZoom!==void 0?e.minZoom:i.minZoom,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:l,tilePixelRatio:a?2:1,wrapX:e.wrapX,zDirection:e.zDirection})}}class Jy extends mt{constructor(e){e=e||{},super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.params_=Object.assign({},e.params),this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=ei(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let e=0;const t=[];for(const r in this.params_)t[e++]=r+"-"+this.params_[r];return t.join("/")}getParams(){return this.params_}getRequestUrl_(e,t,r,i,s,o){const a=this.urls;if(!a)return;let l;if(a.length==1)l=a[0];else{const c=_h(Pu(e),a.length);l=a[c]}return Rc(l,r,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(e[0]),i,s,o)}getTilePixelRatio(e){return this.hidpi_?e:1}updateParams(e){Object.assign(this.params_,e),this.setKey(this.getKeyForParams_())}tileUrlFunction(e,t,r){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(r)),i.getResolutions().length<=e[0])return;t!=1&&!this.hidpi_&&(t=1);const s=i.getTileCoordExtent(e,this.tmpExtent_);let o=Ze(i.getTileSize(e[0]),this.tmpSize);t!=1&&(o=Lu(o,t,this.tmpSize));const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(a,this.params_),this.getRequestUrl_(e,o,s,t,r,a)}}class Qy extends Cc{constructor(e){e=e||{};const t=e.template||"z:{z} x:{x} y:{y}",r=e.source;super({transition:0,wrapX:e.wrapX!==void 0?e.wrapX:r!==void 0?r.getWrapX():void 0});const i=()=>{var o;this.projection=e.projection!==void 0?K(e.projection):r!==void 0?r.getProjection():this.projection,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:r!==void 0?r.getTileGrid():this.tileGrid,this.zDirection=e.zDirection!==void 0?e.zDirection:r!==void 0?r.zDirection:this.zDirection,r instanceof nn&&(this.transformMatrix=((o=r.transformMatrix)==null?void 0:o.slice())||null);const s=this.tileGrid;s&&this.setTileSizes(s.getResolutions().map((a,l)=>Ze(s.getTileSize(l)).map(c=>Math.max(Math.floor(c),1)))),this.setLoader((a,l,c,u)=>{const h=Qa(t,a,l,c,u.maxY),[f,d]=this.getTileSize(a),g=zt(f,d);return g.strokeStyle="grey",g.strokeRect(.5,.5,f+.5,d+.5),g.fillStyle="grey",g.strokeStyle="white",g.textAlign="center",g.textBaseline="middle",g.font="24px sans-serif",g.lineWidth=4,g.strokeText(h,f/2,d/2,f),g.fillText(h,f/2,d/2,f),g.canvas}),this.setState("ready")};if(r===void 0||r.getState()==="ready")i();else{const s=()=>{r.getState()==="ready"&&(r.removeEventListener(Ie.CHANGE,s),i())};r.addEventListener(Ie.CHANGE,s)}}}class Bc extends mt{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:K("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)ro(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let r;try{r=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(r)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const t=K("EPSG:4326"),r=this.getProjection();let i;if(e.bounds!==void 0){const c=ds(t,r);i=sr(e.bounds,c)}const s=Yr(r),o=e.minzoom||0,a=e.maxzoom||22,l=qr({extent:s,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=el(e.tiles,l),e.attribution&&!this.getAttributions()){const c=i!==void 0?i:s;this.setAttributions(function(u){return ir(c,u.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}}class e0 extends Iu{constructor(e,t,r,i,s,o){super(e,t),this.src_=r,this.extent_=i,this.preemptive_=s,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=o}getImage(){return null}getData(e){if(!this.grid_||!this.keys_)return null;const t=(e[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),r=(e[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),i=this.grid_[Math.floor((1-r)*this.grid_.length)];if(typeof i!="string")return null;let s=i.charCodeAt(Math.floor(t*i.length));s>=93&&s--,s>=35&&s--,s-=32;let o=null;if(s in this.keys_){const a=this.keys_[s];this.data_&&a in this.data_?o=this.data_[a]:o=a}return o}forDataAtCoordinate(e,t,r){this.state==he.EMPTY&&r===!0?(this.state=he.IDLE,yh(this,Ie.CHANGE,i=>{t(this.getData(e))}),this.loadInternal_()):r===!0?setTimeout(()=>{t(this.getData(e))},0):t(this.getData(e))}getKey(){return this.src_}handleError_(){this.state=he.ERROR,this.changed()}handleLoad_(e){this.grid_=e.grid,this.keys_=e.keys,this.data_=e.data,this.state=he.LOADED,this.changed()}loadInternal_(){if(this.state==he.IDLE)if(this.state=he.LOADING,this.jsonp_)ro(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",this.src_),e.send()}}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let r;try{r=JSON.parse(t.responseText)}catch{this.handleError_();return}this.handleLoad_(r)}else this.handleError_()}onXHRError_(e){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(he.EMPTY)}}class t0 extends Yn{constructor(e){if(super({projection:K("EPSG:3857"),state:"loading",wrapX:e.wrapX!==void 0?e.wrapX:!0,zDirection:e.zDirection}),this.preemptive_=e.preemptive!==void 0?e.preemptive:!0,this.tileUrlFunction_=Au,this.template_=void 0,this.jsonp_=e.jsonp||!1,e.url)if(this.jsonp_)ro(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let r;try{r=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(r)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(e,t,r,i){if(this.tileGrid){const s=this.tileGrid.getZForResolution(t,this.zDirection),o=this.tileGrid.getTileCoordForCoordAndZ(e,s);this.getTile(o[0],o[1],o[2],1,this.getProjection()).forDataAtCoordinate(e,r,i)}else i===!0?setTimeout(function(){r(null)},0):r(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(e){const t=K("EPSG:4326"),r=this.getProjection();let i;if(e.bounds!==void 0){const u=ds(t,r);i=sr(e.bounds,u)}const s=Yr(r),o=e.minzoom||0,a=e.maxzoom||22,l=qr({extent:s,maxZoom:a,minZoom:o});this.tileGrid=l,this.template_=e.template;const c=e.grids;if(!c){this.setState("error");return}if(this.tileUrlFunction_=el(c,l),e.attribution){const u=i!==void 0?i:s;this.setAttributions(function(h){return ir(u,h.extent)?[e.attribution]:null})}this.setState("ready")}getTile(e,t,r,i,s){const o=[e,t,r],a=this.getTileCoordForTileUrlFunction(o,s),l=this.tileUrlFunction_(a,i,s);return new e0(o,l!==void 0?he.IDLE:he.EMPTY,l!==void 0?l:"",this.tileGrid.getTileCoordExtent(o),this.preemptive_,this.jsonp_)}}function r0(n,e){const t=new Za(32),r=n.getExtent();return function(i,s){t.expireCache(),r&&(i=kt(r,i));const o=n.getZForResolution(s),a=[];return n.forEachTileCoord(i,o,l=>{const c=l.toString();if(!t.containsKey(c)){const u=e(l);t.set(c,u)}a.push(t.get(c))}),a}}const n0=Object.freeze(Object.defineProperty({__proto__:null,BingMaps:vm,CartoDB:Pm,Cluster:Lm,DataTile:nn,GeoTIFF:to,Google:by,IIIF:wy,Image:jt,ImageArcGISRest:Ty,ImageCanvas:Sy,ImageMapGuide:Py,ImageStatic:Ac,ImageTile:Cc,ImageWMS:Cu,OGCMapTile:Uy,OGCVectorTile:By,OSM:Fu,Raster:Uc,Source:as,StadiaMaps:Ky,Tile:Yn,TileArcGISRest:Jy,TileDebug:Qy,TileImage:mt,TileJSON:Bc,TileWMS:tl,UTFGrid:t0,UrlTile:Ou,Vector:Zr,VectorTile:Kn,WMTS:rl,XYZ:Gr,Zoomify:Ey,createArcGISRestLoader:vc,createMapGuideLoader:Pc,createStaticLoader:Lc,createWMSLoader:Mu,sourcesFromTileGrid:r0},Symbol.toStringTag,{value:"Module"}));class Gc extends vh{constructor(e,t=null,r={},i=[]){super(e,t,r,i)}getAll(){return[]}}class i0 extends Ph{constructor(e,t=null){super(e,t)}}class s0 extends Gc{constructor(e,t=null){const r={collections:i=>i.map(s=>new xl(s))};super(e,t,r)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(t=>t.toGeoJSON()).filter(t=>t!==null)}}getBoundingBox(){return _l(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(e=>e.getBoundingBox())}getTemporalExtent(){return yl(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(e=>e.getTemporalExtent())}}class o0 extends Gc{constructor(e,t=null){const r={features:i=>i.map(s=>new bl(s))};super(e,t,r)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return _l(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(e=>e.getBoundingBox())}getTemporalExtent(){return yl(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(e=>e.getTemporalExtent())}}function a0(n,e=!0,t=!1){return e&&(n=Lh.stac(n,t)),n.type==="Feature"?new bl(n):n.type==="FeatureCollection"?new o0(n):n.type==="Collection"||!n.type&&typeof n.extent<"u"&&typeof n.license<"u"?new xl(n):!n.type&&Array.isArray(n.collections)?new s0(n):new i0(n)}window.eoxMapAdvancedOlFormats=Tp;var ve=(n,e,t)=>new Promise((r,i)=>{var s=l=>{try{a(t.next(l))}catch(c){i(c)}},o=l=>{try{a(t.throw(l))}catch(c){i(c)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,o);a((t=t.apply(n,e)).next())}),Me=Uint8Array,Fr=Uint16Array,l0=Int32Array,zc=new Me([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),kc=new Me([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),c0=new Me([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$c=function(n,e){for(var t=new Fr(31),r=0;r<31;++r)t[r]=e+=1<<n[r-1];for(var i=new l0(t[30]),r=1;r<30;++r)for(var s=t[r];s<t[r+1];++s)i[s]=s-t[r]<<5|r;return{b:t,r:i}},Vc=$c(zc,2),jc=Vc.b,u0=Vc.r;jc[28]=258,u0[258]=28;var h0=$c(kc,0),f0=h0.b,Xc=new Fr(32768);for(te=0;te<32768;++te)lt=(te&43690)>>1|(te&21845)<<1,lt=(lt&52428)>>2|(lt&13107)<<2,lt=(lt&61680)>>4|(lt&3855)<<4,Xc[te]=((lt&65280)>>8|(lt&255)<<8)>>1;var lt,te,Or=function(n,e,t){for(var r=n.length,i=0,s=new Fr(e);i<r;++i)n[i]&&++s[n[i]-1];var o=new Fr(e);for(i=1;i<e;++i)o[i]=o[i-1]+s[i-1]<<1;var a;{a=new Fr(1<<e);var l=15-e;for(i=0;i<r;++i)if(n[i])for(var c=i<<4|n[i],u=e-n[i],h=o[n[i]-1]++<<u,f=h|(1<<u)-1;h<=f;++h)a[Xc[h]>>l]=c}return a},on=new Me(288);for(te=0;te<144;++te)on[te]=8;var te;for(te=144;te<256;++te)on[te]=9;var te;for(te=256;te<280;++te)on[te]=7;var te;for(te=280;te<288;++te)on[te]=8;var te,Hc=new Me(32);for(te=0;te<32;++te)Hc[te]=5;var te,d0=Or(on,9),g0=Or(Hc,5),Ri=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},je=function(n,e,t){var r=e/8|0;return(n[r]|n[r+1]<<8)>>(e&7)&t},vi=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},p0=function(n){return(n+7)/8|0},m0=function(n,e,t){(t==null||t>n.length)&&(t=n.length);var r=new Me(t-e);return r.set(n.subarray(e,t)),r},_0=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Oe=function(n,e,t){var r=new Error(e||_0[n]);if(r.code=n,Error.captureStackTrace&&Error.captureStackTrace(r,Oe),!t)throw r;return r},no=function(n,e,t,r){var i=n.length,s=0;if(!i||e.f&&!e.l)return t||new Me(0);var o=!t||e.i!=2,a=e.i;t||(t=new Me(i*3));var l=function(Ct){var fo=t.length;if(Ct>fo){var go=new Me(Math.max(fo*2,Ct));go.set(t),t=go}},c=e.f||0,u=e.p||0,h=e.b||0,f=e.l,d=e.d,g=e.m,p=e.n,m=i*8;do{if(!f){c=je(n,u,1);var y=je(n,u+1,3);if(u+=3,y)if(y==1)f=d0,d=g0,g=9,p=5;else if(y==2){var S=je(n,u,31)+257,T=je(n,u+10,15)+4,R=S+je(n,u+5,31)+1;u+=14;for(var L=new Me(R),I=new Me(19),C=0;C<T;++C)I[c0[C]]=je(n,u+C*3,7);u+=T*3;for(var j=Ri(I),z=(1<<j)-1,Y=Or(I,j),C=0;C<R;){var M=Y[je(n,u,z)];u+=M&15;var _=M>>4;if(_<16)L[C++]=_;else{var W=0,ge=0;for(_==16?(ge=3+je(n,u,3),u+=2,W=L[C-1]):_==17?(ge=3+je(n,u,7),u+=3):_==18&&(ge=11+je(n,u,127),u+=7);ge--;)L[C++]=W}}var ae=L.subarray(0,S),se=L.subarray(S);g=Ri(ae),p=Ri(se),f=Or(ae,g),d=Or(se,p)}else Oe(1);else{var _=p0(u)+4,x=n[_-4]|n[_-3]<<8,w=_+x;if(w>i){a&&Oe(0);break}o&&l(h+x),t.set(n.subarray(_,w),h),e.b=h+=x,e.p=u=w*8,e.f=c;continue}if(u>m){a&&Oe(0);break}}o&&l(h+131072);for(var _e=(1<<g)-1,Ue=(1<<p)-1,ze=u;;ze=u){var W=f[vi(n,u)&_e],Fe=W>>4;if(u+=W&15,u>m){a&&Oe(0);break}if(W||Oe(2),Fe<256)t[h++]=Fe;else if(Fe==256){ze=u,f=null;break}else{var ot=Fe-254;if(Fe>264){var C=Fe-257,at=zc[C];ot=je(n,u,(1<<at)-1)+jc[C],u+=at}var It=d[vi(n,u)&Ue],ke=It>>4;It||Oe(3),u+=It&15;var se=f0[ke];if(ke>3){var at=kc[ke];se+=vi(n,u)&(1<<at)-1,u+=at}if(u>m){a&&Oe(0);break}o&&l(h+131072);var $e=h+ot;if(h<se){var cn=s-se,un=Math.min(se,$e);for(cn+h<0&&Oe(3);h<un;++h)t[h]=r[cn+h]}for(;h<$e;h+=4)t[h]=t[h-se],t[h+1]=t[h+1-se],t[h+2]=t[h+2-se],t[h+3]=t[h+3-se];h=$e}}e.l=f,e.p=ze,e.b=h,e.f=c,f&&(c=1,e.m=g,e.d=d,e.n=p)}while(!c);return h==t.length?t:m0(t,0,h)},y0=new Me(0),x0=function(n){(n[0]!=31||n[1]!=139||n[2]!=8)&&Oe(6,"invalid gzip data");var e=n[3],t=10;e&4&&(t+=(n[10]|n[11]<<8)+2);for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!n[t++]);return t+(e&2)},b0=function(n){var e=n.length;return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0},E0=function(n,e){return((n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31)&&Oe(6,"invalid zlib data"),(n[1]>>5&1)==+!e&&Oe(6,"invalid zlib data: "+(n[1]&32?"need":"unexpected")+" dictionary"),(n[1]>>3&4)+2};function w0(n,e){return no(n,{i:2},e,e)}function T0(n,e){var t=x0(n);return t+8>n.length&&Oe(6,"invalid gzip data"),no(n.subarray(t,-8),{i:2},new Me(b0(n)),e)}function S0(n,e){return no(n.subarray(E0(n,e),-4),{i:2},e,e)}function Xi(n,e){return n[0]==31&&n[1]==139&&n[2]==8?T0(n,e):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?w0(n,e):S0(n,e)}var R0=typeof TextDecoder<"u"&&new TextDecoder,v0=0;try{R0.decode(y0,{stream:!0}),v0=1}catch{}var Wc=(n,e)=>n*Math.pow(2,e),Tr=(n,e)=>Math.floor(n/Math.pow(2,e)),Gn=(n,e)=>Wc(n.getUint16(e+1,!0),8)+n.getUint8(e),Zc=(n,e)=>Wc(n.getUint32(e+2,!0),16)+n.getUint16(e,!0),P0=(n,e,t,r,i)=>{if(n!=r.getUint8(i))return n-r.getUint8(i);const s=Gn(r,i+1);if(e!=s)return e-s;const o=Gn(r,i+4);return t!=o?t-o:0},L0=(n,e,t,r)=>{const i=Yc(n,e|128,t,r);return i?{z:e,x:t,y:r,offset:i[0],length:i[1],is_dir:!0}:null},La=(n,e,t,r)=>{const i=Yc(n,e,t,r);return i?{z:e,x:t,y:r,offset:i[0],length:i[1],is_dir:!1}:null},Yc=(n,e,t,r)=>{let i=0,s=n.byteLength/17-1;for(;i<=s;){const o=s+i>>1,a=P0(e,t,r,n,o*17);if(a>0)i=o+1;else if(a<0)s=o-1;else return[Zc(n,o*17+7),n.getUint32(o*17+13,!0)]}return null},A0=(n,e)=>n.is_dir&&!e.is_dir?1:!n.is_dir&&e.is_dir?-1:n.z!==e.z?n.z-e.z:n.x!==e.x?n.x-e.x:n.y-e.y,qc=(n,e)=>{const t=n.getUint8(e*17);return{z:t&127,x:Gn(n,e*17+1),y:Gn(n,e*17+4),offset:Zc(n,e*17+7),length:n.getUint32(e*17+13,!0),is_dir:t>>7===1}},Aa=n=>{const e=[],t=new DataView(n);for(let r=0;r<t.byteLength/17;r++)e.push(qc(t,r));return I0(e)},I0=n=>{n.sort(A0);const e=new ArrayBuffer(17*n.length),t=new Uint8Array(e);for(let r=0;r<n.length;r++){const i=n[r];let s=i.z;i.is_dir&&(s=s|128),t[r*17]=s,t[r*17+1]=i.x&255,t[r*17+2]=i.x>>8&255,t[r*17+3]=i.x>>16&255,t[r*17+4]=i.y&255,t[r*17+5]=i.y>>8&255,t[r*17+6]=i.y>>16&255,t[r*17+7]=i.offset&255,t[r*17+8]=Tr(i.offset,8)&255,t[r*17+9]=Tr(i.offset,16)&255,t[r*17+10]=Tr(i.offset,24)&255,t[r*17+11]=Tr(i.offset,32)&255,t[r*17+12]=Tr(i.offset,48)&255,t[r*17+13]=i.length&255,t[r*17+14]=i.length>>8&255,t[r*17+15]=i.length>>16&255,t[r*17+16]=i.length>>24&255}return e},C0=(n,e)=>{if(n.byteLength<17)return null;const t=n.byteLength/17,r=qc(n,t-1);if(r.is_dir){const i=r.z,s=e.z-i,o=Math.trunc(e.x/(1<<s)),a=Math.trunc(e.y/(1<<s));return{z:i,x:o,y:a}}return null};function F0(n){return ve(this,null,function*(){const e=yield n.getBytes(0,512e3),t=new DataView(e.data),r=t.getUint32(4,!0),i=t.getUint16(8,!0),s=new TextDecoder("utf-8"),o=JSON.parse(s.decode(new DataView(e.data,10,r)));let a=0;o.compression==="gzip"&&(a=2);let l=0;"minzoom"in o&&(l=+o.minzoom);let c=0;"maxzoom"in o&&(c=+o.maxzoom);let u=0,h=0,f=0,d=-180,g=-85,p=180,m=85;if(o.bounds){const _=o.bounds.split(",");d=+_[0],g=+_[1],p=+_[2],m=+_[3]}if(o.center){const _=o.center.split(",");u=+_[0],h=+_[1],f=+_[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+r,rootDirectoryLength:i*17,jsonMetadataOffset:10,jsonMetadataLength:r,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:l,maxZoom:c,minLon:d,minLat:g,maxLon:p,maxLat:m,centerZoom:f,centerLon:u,centerLat:h,etag:e.etag}})}function O0(n,e,t,r,i,s,o){return ve(this,null,function*(){let a=yield t.getArrayBuffer(e,n.rootDirectoryOffset,n.rootDirectoryLength,n);n.specVersion===1&&(a=Aa(a));const l=La(new DataView(a),r,i,s);if(l){let h=(yield e.getBytes(l.offset,l.length,o)).data;const f=new DataView(h);return f.getUint8(0)==31&&f.getUint8(1)==139&&(h=Xi(new Uint8Array(h))),{data:h}}const c=C0(new DataView(a),{z:r,x:i,y:s});if(c){const u=L0(new DataView(a),c.z,c.x,c.y);if(u){let h=yield t.getArrayBuffer(e,u.offset,u.length,n);n.specVersion===1&&(h=Aa(h));const f=La(new DataView(h),r,i,s);if(f){let g=(yield e.getBytes(f.offset,f.length,o)).data;const p=new DataView(g);return p.getUint8(0)==31&&p.getUint8(1)==139&&(g=Xi(new Uint8Array(g))),{data:g}}}}})}var Kc={getHeader:F0,getZxy:O0};function Yt(n,e){return(e>>>0)*4294967296+(n>>>0)}function M0(n,e){const t=e.buf;let r,i;if(i=t[e.pos++],r=(i&112)>>4,i<128||(i=t[e.pos++],r|=(i&127)<<3,i<128)||(i=t[e.pos++],r|=(i&127)<<10,i<128)||(i=t[e.pos++],r|=(i&127)<<17,i<128)||(i=t[e.pos++],r|=(i&127)<<24,i<128)||(i=t[e.pos++],r|=(i&1)<<31,i<128))return Yt(n,r);throw new Error("Expected varint not more than 10 bytes")}function Sr(n){const e=n.buf;let t,r;return r=e[n.pos++],t=r&127,r<128||(r=e[n.pos++],t|=(r&127)<<7,r<128)||(r=e[n.pos++],t|=(r&127)<<14,r<128)||(r=e[n.pos++],t|=(r&127)<<21,r<128)?t:(r=e[n.pos],t|=(r&15)<<28,M0(t,n))}function N0(n,e,t,r){if(r==0){t==1&&(e[0]=n-1-e[0],e[1]=n-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}var D0=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function U0(n,e,t){if(n>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,n)-1||t>Math.pow(2,n)-1)throw Error("tile x/y outside zoom level bounds");const r=D0[n],i=Math.pow(2,n);let s=0,o=0,a=0;const l=[e,t];let c=i/2;for(;c>0;)s=(l[0]&c)>0?1:0,o=(l[1]&c)>0?1:0,a+=c*c*(3*s^o),N0(c,l,s,o),c=c/2;return r+a}function Jc(n,e){return ve(this,null,function*(){if(e===1||e===0)return n;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Xi(new Uint8Array(n));{let r=new Response(n).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(r).arrayBuffer()}}else throw Error("Compression method not supported")})}var Jt=(n=>(n[n.Unknown=0]="Unknown",n[n.Mvt=1]="Mvt",n[n.Png=2]="Png",n[n.Jpeg=3]="Jpeg",n[n.Webp=4]="Webp",n[n.Avif=5]="Avif",n))(Jt||{}),B0=127;function G0(n,e){let t=0,r=n.length-1;for(;t<=r;){const i=r+t>>1,s=e-n[i].tileId;if(s>0)t=i+1;else if(s<0)r=i-1;else return n[i]}return r>=0&&(n[r].runLength===0||e-n[r].tileId<n[r].runLength)?n[r]:null}var z0=class{constructor(n,e=new Headers){this.url=n,this.customHeaders=e}getKey(){return this.url}setHeaders(n){this.customHeaders=n}getBytes(n,e,t){return ve(this,null,function*(){let r;t||(r=new AbortController,t=r.signal);const i=new Headers(this.customHeaders);i.set("Range","bytes="+n+"-"+(n+e-1));let s=yield fetch(this.url,{signal:t,headers:i});if(s.status===416&&n===0){const l=s.headers.get("Content-Range");if(!l||!l.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const c=+l.substr(8);s=yield fetch(this.url,{signal:t,headers:{Range:"bytes=0-"+(c-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const o=s.headers.get("Content-Length");if(s.status===200&&(!o||+o>e))throw r&&r.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function Xe(n,e){const t=n.getUint32(e+4,!0),r=n.getUint32(e+0,!0);return t*Math.pow(2,32)+r}function k0(n,e){const t=new DataView(n),r=t.getUint8(7);if(r>3)throw Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:Xe(t,8),rootDirectoryLength:Xe(t,16),jsonMetadataOffset:Xe(t,24),jsonMetadataLength:Xe(t,32),leafDirectoryOffset:Xe(t,40),leafDirectoryLength:Xe(t,48),tileDataOffset:Xe(t,56),tileDataLength:Xe(t,64),numAddressedTiles:Xe(t,72),numTileEntries:Xe(t,80),numTileContents:Xe(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function Qc(n){const e={buf:new Uint8Array(n),pos:0},t=Sr(e),r=[];let i=0;for(let s=0;s<t;s++){const o=Sr(e);r.push({tileId:i+o,offset:0,length:0,runLength:1}),i+=o}for(let s=0;s<t;s++)r[s].runLength=Sr(e);for(let s=0;s<t;s++)r[s].length=Sr(e);for(let s=0;s<t;s++){const o=Sr(e);o===0&&s>0?r[s].offset=r[s-1].offset+r[s-1].length:r[s].offset=o-1}return r}function $0(n){const e=new DataView(n);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var tr=class extends Error{};function V0(n,e,t,r){return ve(this,null,function*(){const i=yield n.getBytes(0,16384);if(new DataView(i.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if($0(i.data)<3)return[yield Kc.getHeader(n)];const o=i.data.slice(0,B0);let a=i.etag;r&&i.etag!=r&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+n.getKey()),a=void 0);const l=k0(o,a);if(t){const c=i.data.slice(l.rootDirectoryOffset,l.rootDirectoryOffset+l.rootDirectoryLength),u=n.getKey()+"|"+(l.etag||"")+"|"+l.rootDirectoryOffset+"|"+l.rootDirectoryLength,h=Qc(yield e(c,l.internalCompression));return[l,[u,h.length,h]]}return[l,void 0]})}function j0(n,e,t,r,i){return ve(this,null,function*(){const s=yield n.getBytes(t,r);if(i.etag&&i.etag!==s.etag)throw new tr(s.etag);const o=yield e(s.data,i.internalCompression),a=Qc(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var X0=class{constructor(n=100,e=!0,t=Jc){this.cache=new Map,this.maxCacheEntries=n,this.counter=1,this.prefetch=e,this.decompress=t}getHeader(n,e){return ve(this,null,function*(){const t=n.getKey();if(this.cache.has(t))return this.cache.get(t).lastUsed=this.counter++,yield this.cache.get(t).data;const r=new Promise((i,s)=>{V0(n,this.decompress,this.prefetch,e).then(o=>{o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:Promise.resolve(o[1][2])}),i(o[0]),this.prune()}).catch(o=>{s(o)})});return this.cache.set(t,{lastUsed:this.counter++,data:r}),r})}getDirectory(n,e,t,r){return ve(this,null,function*(){const i=n.getKey()+"|"+(r.etag||"")+"|"+e+"|"+t;if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;const s=new Promise((o,a)=>{j0(n,this.decompress,e,t,r).then(l=>{o(l),this.prune()}).catch(l=>{a(l)})});return this.cache.set(i,{lastUsed:this.counter++,data:s}),s})}getArrayBuffer(n,e,t,r){return ve(this,null,function*(){const i=n.getKey()+"|"+(r.etag||"")+"|"+e+"|"+t;if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;const s=new Promise((o,a)=>{n.getBytes(e,t).then(l=>{if(r.etag&&r.etag!==l.etag)throw new tr(l.etag);o(l.data),this.cache.has(i),this.prune()}).catch(l=>{a(l)})});return this.cache.set(i,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let n=1/0,e;this.cache.forEach((t,r)=>{t.lastUsed<n&&(n=t.lastUsed,e=r)}),e&&this.cache.delete(e)}}invalidate(n,e){return ve(this,null,function*(){this.cache.delete(n.getKey()),yield this.getHeader(n,e)})}},io=class{constructor(n,e,t){typeof n=="string"?this.source=new z0(n):this.source=n,t?this.decompress=t:this.decompress=Jc,e?this.cache=e:this.cache=new X0}getHeader(){return ve(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(n,e,t,r){return ve(this,null,function*(){const i=U0(n,e,t),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return Kc.getZxy(s,this.source,this.cache,n,e,t,r);if(n<s.minZoom||n>s.maxZoom)return;let o=s.rootDirectoryOffset,a=s.rootDirectoryLength;for(let l=0;l<=3;l++){const c=yield this.cache.getDirectory(this.source,o,a,s),u=G0(c,i);if(u)if(u.runLength>0){const h=yield this.source.getBytes(s.tileDataOffset+u.offset,u.length,r);if(s.etag&&s.etag!==h.etag)throw new tr(h.etag);return{data:yield this.decompress(h.data,s.tileCompression),cacheControl:h.cacheControl,expires:h.expires}}else o=s.leafDirectoryOffset+u.offset,a=u.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(n,e,t,r){return ve(this,null,function*(){try{return yield this.getZxyAttempt(n,e,t,r)}catch(i){if(i instanceof tr)return this.cache.invalidate(this.source,i.message),yield this.getZxyAttempt(n,e,t,r);throw i}})}getMetadataAttempt(){return ve(this,null,function*(){const n=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(n.jsonMetadataOffset,n.jsonMetadataLength);if(n.etag&&n.etag!==e.etag)throw new tr(e.etag);const t=yield this.decompress(e.data,n.internalCompression),r=new TextDecoder("utf-8");return JSON.parse(r.decode(t))})}getMetadata(){return ve(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(n){if(n instanceof tr)return this.cache.invalidate(this.source,n.message),yield this.getMetadataAttempt();throw n}})}};class H0 extends hl{constructor(e){super(Ie.ERROR),this.error=e}}class le{constructor(e){this.name=e}toString(){return this.name}}le.GeoTIFF=new le("GeoTIFF");le.ImageStatic=new le("ImageStatic");le.PMTilesRaster=new le("PMTilesRaster");le.PMTilesVector=new le("PMTilesVector");le.TileJSON=new le("TileJSON");le.TileWMS=new le("TileWMS");le.WMTS=new le("WMTS");le.XYZ=new le("XYZ");class Ia extends nn{constructor(t){super({...t,state:"loading"});J(this,"loadImage",t=>new Promise((r,i)=>{const s=new Image;s.addEventListener("load",()=>r(s)),s.addEventListener("error",()=>i(new Error("load failed"))),s.src=t}));const r=new io(t.url);r.getHeader().then(i=>{this.tileGrid.minZoom=i.minZoom,this.tileGrid.maxZoom=i.maxZoom,this.setLoader(async(s,o,a)=>{const l=await r.getZxy(s,o,a),c=URL.createObjectURL(new Blob([l.data])),u=await this.loadImage(c);return URL.revokeObjectURL(c),u}),this.setState("ready")})}}class W0 extends Kn{constructor(t){super({...t,state:"loading",url:"pmtiles://"+t.url+"/{z}/{x}/{y}",format:new Ha});J(this,"tileLoadFunction",(t,r)=>{const i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=r.match(i),o=+s[2],a=+s[3],l=+s[4];t.setLoader((c,u,h)=>{t.setState(he.LOADING),this.pmtiles_.getZxy(o,a,l).then(f=>{if(f){const d=t.getFormat();t.setFeatures(d.readFeatures(f.data,{extent:c,featureProjection:h})),t.setState(he.LOADED)}else t.setFeatures([]),t.setState(he.EMPTY)}).catch(f=>{t.setFeatures([]),t.setState(he.ERROR)})})});this.pmtiles_=new io(t.url),this.pmtiles_.getHeader().then(r=>{this.tileGrid.minZoom=r.minZoom,this.tileGrid.maxZoom=r.maxZoom,this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}}const Z0=new Lr({fill:new Ai({color:"rgba(255,255,255,0.4)"}),stroke:new Nr({color:"#3399CC",width:3})}),Y0=new Lr({stroke:new Nr({color:"#ff9933",width:1})});function q0(n,e){const t={url:n.getAbsoluteUrl()};let r=null;n.getBands().length===1&&(r=0);const{minimum:i,maximum:s}=n.getMinMaxValues(r);typeof i=="number"&&(t.min=i),typeof s=="number"&&(t.max=s);const o=n.getNoDataValues(r);return o.length>0&&(t.nodata=o[0]),e.length>0&&(t.bands=e),t}async function Ca(n,e=void 0){let t=e;if(Nu()){const r=n.getMetadata("proj:epsg");if(r)try{t=await Du(r)}catch{}}return t}function Fa(n,e){const t=n.clone();return e.hasOnlyBounds()||t.setFill(null),t}function K0(n){let e=n.href;if(e.includes("{s}"))if(Array.isArray(n["href:servers"])&&n["href:servers"].length>0){const t=Math.random()*n["href:servers"].length|0;e=e.replace("{s}",n["href:servers"][t])}else return null;return e}async function J0(n){try{const e=new URL(n);e.searchParams.set("service","wmts"),e.searchParams.set("request","GetCapabilities");const t=await fetch(e);return new Is().read(await t.text())}catch{return null}}class so extends dl{constructor(e){const t={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(r=>t[r]=e[r]),super(t),this.getSourceOptions_=e.getSourceOptions,this.data_,this.assets_=null,this.bands_=[],this.crossOrigin_=e.crossOrigin||null,this.displayFootprint_=e.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!e.displayGeoTiffByDefault,this.displayPreview_=!!e.displayPreview,this.displayOverview_=e.displayOverview!==!1,this.displayWebMapLink_=e.displayWebMapLink||!1,this.buildTileUrlTemplate_=e.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=e.useTileLayerAsFallback||!1,this.boundsStyle_=e.boundsStyle||Z0,this.collectionStyle_=e.collectionStyle||Y0,this.boundsLayer_=null,e.data){try{this.configure_(e.data,e.url,e.assets,e.bands)}catch(r){this.handleError_(r)}return}if(!e.url)throw new Error("Either url or data must be provided");fetch(e.url).then(r=>r.json()).then(r=>this.configure_(r,e.url,e.assets,e.bands)).catch(r=>this.handleError_(r))}getBoundsLayer(){return this.boundsLayer_}handleError_(e){this.dispatchEvent(new H0(e))}configure_(e,t=null,r=null,i=[]){e instanceof di||e instanceof Ah?this.data_=e:this.data_=a0(e),t&&t.includes("://")&&this.data_.setAbsoluteUrl(t),this.bands_=i,this.boundsLayer_=this.addFootprint_();const s=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(Fa(this.boundsStyle_,this))};this.getLayers().on("add",s),this.getLayers().on("remove",s),this.setAssets(r).then(()=>this.dispatchEvent("assetsready")).catch(o=>this.handleError_(o)),this.dispatchEvent("sourceready")}async addApiCollection_(){const e=this.getData().getAll().map(t=>{const r=new so({data:t,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_});return this.addLayer_(r),r});return await Promise.all(e)}async addStacAssets_(){let e=this.getAssets();if(e===null){e=[];const r=this.getData().getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);if(r)e.push(r);else{const i=this.getData().getThumbnails().filter(s=>!Array.isArray(s.roles)||!s.roles.includes("example"));i.length>0&&e.push(i[0])}}const t=e.map(r=>this.addImagery_(r));return await Promise.all(t)}async addImagery_(e){if(e){if(e.isGeoTIFF())return await this.addGeoTiff_(e);if(e.canBrowserDisplayImage())return await this.addThumbnail_(e)}}async addThumbnail_(e){if(!this.displayPreview_)return;let t={url:e.getAbsoluteUrl(),projection:await Ca(e,"EPSG:4326"),imageExtent:e.getContext().getBoundingBox(),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(t=await this.getSourceOptions_(le.ImageStatic,t,e));const r=new is({source:new Ac(t)});return this.addLayer_(r,e),r}async addWebMapLinks_(){const e=this.getWebMapLinks();if(e.length>0)return await this.addLayerForLink(e[0])}async addLayerForLink(e){const t=K0(e);if(!t)return;const r={attributions:e.getMetadata("attribution")||this.data_.getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:t},i=async(o,a)=>(this.getSourceOptions_&&(a=await this.getSourceOptions_(o,a,e)),a),s=[];switch(e.rel){case"pmtiles":const a=await new io(r.url).getHeader();let l;switch(a.tileType){case Jt.Mvt:l=new W0(await i(le.PMTilesVector,r));break;case Jt.Avif:case Jt.Jpeg:case Jt.Png:case Jt.Webp:l=new Ia(await i(le.PMTilesRaster,r));break;default:return}s.push(l);break;case"tilejson":s.push(new Bc(await i(le.TileJSON,r)));break;case"wms":if(!Array.isArray(e["wms:layers"]))break;for(const h in e["wms:layers"]){const f=e["wms:layers"][h]||"";let d="";Array.isArray(e["wms:styles"])&&typeof e["wms:styles"][h]=="string"&&(d=e["wms:styles"][h]);const g=Object.assign({LAYERS:f,STYLES:d},e["wms:dimensions"]);typeof e["wms:transparent"]=="boolean"&&(g.TRANSPARENT=String(e["wms:transparent"])),typeof e.type=="string"&&e.type.startsWith("image/")&&(g.FORMAT=e.type);const p=await i(le.TileWMS,Object.assign({},r,{params:g}));s.push(new tl(p))}break;case"wmts":const c=await J0(t);if(!c)return;const u=Array.isArray(e["wmts:layer"])?e["wmts:layer"]:[e["wmts:layer"]];for(const h of u){let f=Object.assign({},r,{layer:h});typeof e.type=="string"&&e.type.startsWith("image/")&&(f.format=e.type),f=await i(le.WMTS,f),s.push(new rl(nl(c,f)))}break;case"xyz":s.push(new Gr(await i(le.XYZ,r)));break;default:return}return s.map(o=>{let a;return o instanceof Kn?a=new qa({source:o,declutter:!0}):o instanceof Ia?a=new Bn({source:o}):a=new An({source:o}),this.addLayer_(a,e),a})}async addGeoTiff_(e){if(!this.displayOverview_)return;if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);let r={sources:[q0(e,this.bands_)]};const i=await Ca(e);i&&(r.projection=i),this.getSourceOptions_&&(r=await this.getSourceOptions_(le.GeoTIFF,r,e));const s=async(o,a)=>(a&&this.getLayers().remove(a),await this.addTileLayerForImagery_(o));try{const o=new to(r),a=new Bn({source:o});if(this.useTileLayerAsFallback_){const l=()=>s(e,a);o.on("error",l),o.on("tileloaderror",l),o.on("change",()=>{o.getState()==="error"&&s(e,a)}),a.on("error",l),await o.getView()}return this.addLayer_(a,e),a}catch(o){if(this.useTileLayerAsFallback_)return await s(e,null);this.handleError_(o)}}async addTileLayerForImagery_(e){let t={crossOrigin:this.crossOrigin_,url:this.buildTileUrlTemplate_(e)};this.getSourceOptions_&&(t=await this.getSourceOptions_(le.XYZ,t,e));const r=new An({source:new Gr(t)});return this.addLayer_(r,e),r}addLayer_(e,t,r=0){e.set("stac",t),e.setZIndex(r),this.getLayers().push(e)}addFootprint_(){let e=null;const t=this.getData();if(t.isItemCollection()||t.isCollectionCollection()?e=Ih(t.getBoundingBox()):e=t.toGeoJSON(),e){const r=new us,i=new Zr({format:r,loader:(o,a,l)=>{const c=r.readFeatures(e,{featureProjection:l});i.addFeatures(c)}}),s=new Ki({source:i,style:Fa(this.boundsStyle_,this),visible:this.displayFootprint_});return s.set("bounds",!0),this.addLayer_(s,t,1),s}return null}async updateLayers_(){const e=this.getLayers();for(let r=e.getLength()-1;r>=0;r--){const s=e.item(r).get("stac");s&&(s.isLink()||s.isAsset())&&e.removeAt(r)}const t=this.getData();t.isItemCollection()||t.isCollectionCollection()?await this.addApiCollection_():(t.isItem()||t.isCollection())&&await this.addStacAssets_(),this.displayWebMapLink_&&(Array.isArray(this.displayWebMapLink_)||this.hasOnlyBounds())&&await this.addWebMapLinks_()}hasOnlyBounds(){const e=this.getBoundsLayer();return typeof this.getLayersArray().find(r=>r!==e)>"u"}getWebMapLinks(){let e=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(e=[this.displayWebMapLink_]);let t=this.data_.getLinksWithRels(e);return Array.isArray(this.displayWebMapLink_)?t=this.displayWebMapLink_.map(r=>{if(typeof r=="string"){const i=t.find(s=>s.id===r);return i||null}return r}).filter(r=>!!r):t.sort((r,i)=>{const s=e.indexOf(r.rel),o=e.indexOf(i.rel);return s-o}),t}async setAssets(e){Array.isArray(e)?this.assets_=e.map(t=>typeof t=="string"?this.getData().getAsset(t):t instanceof di?t:new di(t)):this.assets_=null,await this.updateLayers_()}getData(){return this.data_}getAssets(){return this.assets_}getExtent(){if(!this.boundsLayer_)return;const e=this.boundsLayer_.getMapInternal();if(!e)return;const t=e.getView();if(!t)return;const r=this.getData();if(!r)return;const i=r.getBoundingBox();if(i)return ol(i,"EPSG:4326",t.getProjection())}}Uu(Bu);window.eoxMapAdvancedOlLayers={...Tm,STAC:so};class Q0 extends mt{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,tilePixelRatio:e.tilePixelRatio,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection,wrapX:e.wrapX}),this.version_=e.version!==void 0?e.version:"1.0.0",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,fetch(e.url).then(t=>t.text()).then(t=>new window.DOMParser().parseFromString(t,"application/xml")).then(t=>{this.handleCapabilitiesResponse(t,e)})}handleCapabilitiesResponse(e,t){const i=new Is().read(e),s=nl(i,t);this.crossOrigin=s.crossOrigin,this.projection=s.projection,this.tileGrid=s.tileGrid,this.requestEncoding_=s.requestEncoding,this.matrixSet_=s.matrixSet,this.style_=s.style,this.format_=s.format,this.dimensions_=s.dimensions,this.setUrls(s.urls),this.urls&&this.urls.length>0&&(this.tileUrlFunction=ss(this.urls.map(this.createFromWMTSTemplate.bind(this)))),this.setState("ready")}createFromWMTSTemplate(e){const t=this.requestEncoding_,r={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t==="KVP"&&Object.assign(r,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t==="KVP"?In(e,r):e.replace(/\{(\w+?)\}/g,(o,a)=>a.toLowerCase()in r?r[a.toLowerCase()]:o);const i=this.tileGrid,s=this.dimensions_;return function(o){if(!o)return;const a={TileMatrix:i.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(a,s);let l=e;return t==="KVP"?l=In(l,a):l=l.replace(/\{(\w+?)\}/g,(c,u)=>a[u]),l}}}var H,we=((H={})[H.Unknown=0]="Unknown",H[H.Point=1]="Point",H[H.LineString=2]="LineString",H[H.Polygon=3]="Polygon",H[H.MultiPoint=4]="MultiPoint",H[H.MultiLineString=5]="MultiLineString",H[H.MultiPolygon=6]="MultiPolygon",H[H.GeometryCollection=7]="GeometryCollection",H[H.CircularString=8]="CircularString",H[H.CompoundCurve=9]="CompoundCurve",H[H.CurvePolygon=10]="CurvePolygon",H[H.MultiCurve=11]="MultiCurve",H[H.MultiSurface=12]="MultiSurface",H[H.Curve=13]="Curve",H[H.Surface=14]="Surface",H[H.PolyhedralSurface=15]="PolyhedralSurface",H[H.TIN=16]="TIN",H[H.Triangle=17]="Triangle",H);const Rr=4,vr=4,an=4,yt=new Int32Array(2),Oa=new Float32Array(yt.buffer),Ma=new Float64Array(yt.buffer),yn=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Hi;(function(n){n[n.UTF8_BYTES=1]="UTF8_BYTES",n[n.UTF16_STRING=2]="UTF16_STRING"})(Hi||(Hi={}));class pt{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new pt(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return yt[0]=this.readInt32(e),Oa[0]}readFloat64(e){return yt[yn?0:1]=this.readInt32(e),yt[yn?1:0]=this.readInt32(e+4),Ma[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){Oa[0]=t,this.writeInt32(e,yt[0])}writeFloat64(e,t){Ma[0]=t,this.writeInt32(e,yt[yn?0:1]),this.writeInt32(e+4,yt[yn?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Rr+vr)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<vr;t++)e+=String.fromCharCode(this.readInt8(this.position_+Rr+t));return e}__offset(e,t){const r=e-this.readInt32(e);return t<this.readInt16(r)?this.readInt16(r+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const r=this.readInt32(e);e+=Rr;const i=this.bytes_.subarray(e,e+r);return t===Hi.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+Rr}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=vr)throw new Error("FlatBuffers: file identifier must be length "+vr);for(let t=0;t<vr;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+Rr+t))return!1;return!0}createScalarList(e,t){const r=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&r.push(s)}return r}createObjList(e,t){const r=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&r.push(s.unpack())}return r}}class Re{constructor(){J(this,"bb",null);J(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsGeometry(e,t){return(t||new Re).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsGeometry(e,t){return e.setPosition(e.position()+an),(t||new Re).__init(e.readInt32(e.position())+e.position(),e)}ends(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+4*e):0}endsLength(){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}endsArray(){let e=this.bb.__offset(this.bb_pos,4);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}xy(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}xyLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}xyArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}z(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}zLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}zArray(){let e=this.bb.__offset(this.bb_pos,8);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}m(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}mLength(){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}mArray(){let e=this.bb.__offset(this.bb_pos,10);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}t(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}tLength(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}tArray(){let e=this.bb.__offset(this.bb_pos,12);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}tm(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint64(this.bb.__vector(this.bb_pos+t)+8*e):BigInt(0)}tmLength(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}type(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readUint8(this.bb_pos+e):we.Unknown}parts(e,t){let r=this.bb.__offset(this.bb_pos,18);return r?(t||new Re).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*e),this.bb):null}partsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}static startGeometry(e){e.startObject(8)}static addEnds(e,t){e.addFieldOffset(0,t,0)}static createEndsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addInt32(t[r]);return e.endVector()}static startEndsVector(e,t){e.startVector(4,t,4)}static addXy(e,t){e.addFieldOffset(1,t,0)}static createXyVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startXyVector(e,t){e.startVector(8,t,8)}static addZ(e,t){e.addFieldOffset(2,t,0)}static createZVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startZVector(e,t){e.startVector(8,t,8)}static addM(e,t){e.addFieldOffset(3,t,0)}static createMVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startMVector(e,t){e.startVector(8,t,8)}static addT(e,t){e.addFieldOffset(4,t,0)}static createTVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startTVector(e,t){e.startVector(8,t,8)}static addTm(e,t){e.addFieldOffset(5,t,0)}static createTmVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addInt64(t[r]);return e.endVector()}static startTmVector(e,t){e.startVector(8,t,8)}static addType(e,t){e.addFieldInt8(6,t,we.Unknown)}static addParts(e,t){e.addFieldOffset(7,t,0)}static createPartsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startPartsVector(e,t){e.startVector(4,t,4)}static endGeometry(e){return e.endObject()}static createGeometry(e,t,r,i,s,o,a,l,c){return Re.startGeometry(e),Re.addEnds(e,t),Re.addXy(e,r),Re.addZ(e,i),Re.addM(e,s),Re.addT(e,o),Re.addTm(e,a),Re.addType(e,l),Re.addParts(e,c),Re.endGeometry(e)}}function Pi(n,e){let t=[];for(let r=0;r<n.length;r+=2){let i=[n[r],n[r+1]];e&&i.push(e[r>>1]),t.push(i)}return t}function Wi(n,e){let t=e;if(t===we.Unknown&&(t=n.type()),t===we.GeometryCollection){let i=[];for(let s=0;s<n.partsLength();s++){let o=n.parts(s),a=o.type();i.push(Wi(o,a))}return{type:we[t],geometries:i}}if(t===we.MultiPolygon){let i=[];for(let s=0;s<n.partsLength();s++)i.push(Wi(n.parts(s),we.Polygon));return{type:we[t],coordinates:i.map(s=>s.coordinates)}}let r=function(i,s){let o=i.xyArray(),a=i.zArray();switch(s){case we.Point:{let l=Array.from(o);return a&&l.push(a[0]),l}case we.MultiPoint:case we.LineString:return Pi(o,a);case we.MultiLineString:case we.Polygon:return function(l,c,u){let h;if(!u||u.length===0)return[Pi(l,c)];let f=0,d=Array.from(u).map(g=>l.slice(f,f=g<<1));return c&&(f=0,h=Array.from(u).map(g=>c.slice(f,f=g))),d.map((g,p)=>Pi(g,h?h[p]:void 0))}(o,a,i.endsArray())}}(n,t);return{type:we[t],coordinates:r}}var Q,xe=((Q={})[Q.Byte=0]="Byte",Q[Q.UByte=1]="UByte",Q[Q.Bool=2]="Bool",Q[Q.Short=3]="Short",Q[Q.UShort=4]="UShort",Q[Q.Int=5]="Int",Q[Q.UInt=6]="UInt",Q[Q.Long=7]="Long",Q[Q.ULong=8]="ULong",Q[Q.Float=9]="Float",Q[Q.Double=10]="Double",Q[Q.String=11]="String",Q[Q.Json=12]="Json",Q[Q.DateTime=13]="DateTime",Q[Q.Binary=14]="Binary",Q);class ye{constructor(){J(this,"bb",null);J(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsColumn(e,t){return(t||new ye).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsColumn(e,t){return e.setPosition(e.position()+an),(t||new ye).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}type(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):xe.Byte}title(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}width(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readInt32(this.bb_pos+e):-1}precision(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readInt32(this.bb_pos+e):-1}scale(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readInt32(this.bb_pos+e):-1}nullable(){let e=this.bb.__offset(this.bb_pos,18);return!e||!!this.bb.readInt8(this.bb_pos+e)}unique(){let e=this.bb.__offset(this.bb_pos,20);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}primaryKey(){let e=this.bb.__offset(this.bb_pos,22);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}metadata(e){let t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__string(this.bb_pos+t,e):null}static startColumn(e){e.startObject(11)}static addName(e,t){e.addFieldOffset(0,t,0)}static addType(e,t){e.addFieldInt8(1,t,xe.Byte)}static addTitle(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWidth(e,t){e.addFieldInt32(4,t,-1)}static addPrecision(e,t){e.addFieldInt32(5,t,-1)}static addScale(e,t){e.addFieldInt32(6,t,-1)}static addNullable(e,t){e.addFieldInt8(7,+t,1)}static addUnique(e,t){e.addFieldInt8(8,+t,0)}static addPrimaryKey(e,t){e.addFieldInt8(9,+t,0)}static addMetadata(e,t){e.addFieldOffset(10,t,0)}static endColumn(e){let t=e.endObject();return e.requiredField(t,4),t}static createColumn(e,t,r,i,s,o,a,l,c,u,h,f){return ye.startColumn(e),ye.addName(e,t),ye.addType(e,r),ye.addTitle(e,i),ye.addDescription(e,s),ye.addWidth(e,o),ye.addPrecision(e,a),ye.addScale(e,l),ye.addNullable(e,c),ye.addUnique(e,u),ye.addPrimaryKey(e,h),ye.addMetadata(e,f),ye.endColumn(e)}}class He{constructor(){J(this,"bb",null);J(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFeature(e,t){return(t||new He).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFeature(e,t){return e.setPosition(e.position()+an),(t||new He).__init(e.readInt32(e.position())+e.position(),e)}geometry(e){let t=this.bb.__offset(this.bb_pos,4);return t?(e||new Re).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}properties(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb.__vector(this.bb_pos+t)+e):0}propertiesLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}propertiesArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}columns(e,t){let r=this.bb.__offset(this.bb_pos,8);return r?(t||new ye).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFeature(e){e.startObject(3)}static addGeometry(e,t){e.addFieldOffset(0,t,0)}static addProperties(e,t){e.addFieldOffset(1,t,0)}static createPropertiesVector(e,t){e.startVector(1,t.length,1);for(let r=t.length-1;r>=0;r--)e.addInt8(t[r]);return e.endVector()}static startPropertiesVector(e,t){e.startVector(1,t,1)}static addColumns(e,t){e.addFieldOffset(2,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static endFeature(e){return e.endObject()}static finishFeatureBuffer(e,t){e.finish(t)}static finishSizePrefixedFeatureBuffer(e,t){e.finish(t,void 0,!0)}static createFeature(e,t,r,i){return He.startFeature(e),He.addGeometry(e,t),He.addProperties(e,r),He.addColumns(e,i),He.endFeature(e)}}new TextEncoder;let Na=new TextDecoder;function ex(n,e){let t={};if(!e||e.length===0)return t;let r=n.propertiesArray();if(!r)return t;let i=new DataView(r.buffer,r.byteOffset),s=n.propertiesLength(),o=0;for(;o<s;){let a=i.getUint16(o,!0);o+=2;let l=e[a],c=l.name;switch(l.type){case xe.Bool:t[c]=!!i.getUint8(o),o+=1;break;case xe.Byte:t[c]=i.getInt8(o),o+=1;break;case xe.UByte:t[c]=i.getUint8(o),o+=1;break;case xe.Short:t[c]=i.getInt16(o,!0),o+=2;break;case xe.UShort:t[c]=i.getUint16(o,!0),o+=2;break;case xe.Int:t[c]=i.getInt32(o,!0),o+=4;break;case xe.UInt:t[c]=i.getUint32(o,!0),o+=4;break;case xe.Long:t[c]=Number(i.getBigInt64(o,!0)),o+=8;break;case xe.ULong:t[c]=Number(i.getBigUint64(o,!0)),o+=8;break;case xe.Float:t[c]=i.getFloat32(o,!0),o+=4;break;case xe.Double:t[c]=i.getFloat64(o,!0),o+=8;break;case xe.DateTime:case xe.String:{let u=i.getUint32(o,!0);o+=4,t[c]=Na.decode(r.subarray(o,o+u)),o+=u;break}case xe.Json:{let u=i.getUint32(o,!0);o+=4;let h=Na.decode(r.subarray(o,o+u));t[c]=JSON.parse(h),o+=u;break}case xe.Binary:{let u=i.getUint32(o,!0);o+=4,t[c]=r.subarray(o,o+u),o+=u;break}default:throw Error("Unknown type "+l.type)}}return t}function oo(n,e,t){let r=t.columns;return{type:"Feature",id:n,geometry:Wi(e.geometry(),t.geometryType),properties:ex(e,r)}}const ao=new Uint8Array(0);function tx(){return this._source.cancel()}function rx(n,e){if(!n.length)return e;if(!e.length)return n;var t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function nx(){var n=this,e=n._array.subarray(n._index);return n._source.read().then(function(t){return n._array=ao,n._index=0,t.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:rx(e,t.value)}})}function ix(n){if((n|=0)<0)throw new Error("invalid length");var e=this,t=this._array.length-this._index;if(this._index+n<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=n));var r=new Uint8Array(n);return r.set(this._array.subarray(this._index)),function i(){return e._source.read().then(function(s){return s.done?(e._array=ao,e._index=0,t>0?r.subarray(0,t):null):t+s.value.length>=n?(e._array=s.value,e._index=n-t,r.set(s.value.subarray(0,n-t),t),r):(r.set(s.value,t),t+=s.value.length,i())})}()}function sx(n){return typeof n.slice=="function"?n:new li(typeof n.read=="function"?n:n.getReader())}function li(n){this._source=n,this._array=ao,this._index=0}li.prototype.read=nx;li.prototype.slice=ix;li.prototype.cancel=tx;class Ge{constructor(){J(this,"bb",null);J(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCrs(e,t){return(t||new Ge).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCrs(e,t){return e.setPosition(e.position()+an),(t||new Ge).__init(e.readInt32(e.position())+e.position(),e)}org(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}code(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}name(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}wkt(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__string(this.bb_pos+t,e):null}codeString(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__string(this.bb_pos+t,e):null}static startCrs(e){e.startObject(6)}static addOrg(e,t){e.addFieldOffset(0,t,0)}static addCode(e,t){e.addFieldInt32(1,t,0)}static addName(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWkt(e,t){e.addFieldOffset(4,t,0)}static addCodeString(e,t){e.addFieldOffset(5,t,0)}static endCrs(e){return e.endObject()}static createCrs(e,t,r,i,s,o,a){return Ge.startCrs(e),Ge.addOrg(e,t),Ge.addCode(e,r),Ge.addName(e,i),Ge.addDescription(e,s),Ge.addWkt(e,o),Ge.addCodeString(e,a),Ge.endCrs(e)}}class zn{constructor(){J(this,"bb",null);J(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsHeader(e,t){return(t||new zn).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsHeader(e,t){return e.setPosition(e.position()+an),(t||new zn).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}envelope(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}envelopeLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}envelopeArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}geometryType(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):we.Unknown}hasZ(){let e=this.bb.__offset(this.bb_pos,10);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasM(){let e=this.bb.__offset(this.bb_pos,12);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasT(){let e=this.bb.__offset(this.bb_pos,14);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasTm(){let e=this.bb.__offset(this.bb_pos,16);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}columns(e,t){let r=this.bb.__offset(this.bb_pos,18);return r?(t||new ye).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}featuresCount(){let e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint64(this.bb_pos+e):BigInt("0")}indexNodeSize(){let e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readUint16(this.bb_pos+e):16}crs(e){let t=this.bb.__offset(this.bb_pos,24);return t?(e||new Ge).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}title(e){let t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__string(this.bb_pos+t,e):null}metadata(e){let t=this.bb.__offset(this.bb_pos,30);return t?this.bb.__string(this.bb_pos+t,e):null}static startHeader(e){e.startObject(14)}static addName(e,t){e.addFieldOffset(0,t,0)}static addEnvelope(e,t){e.addFieldOffset(1,t,0)}static createEnvelopeVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startEnvelopeVector(e,t){e.startVector(8,t,8)}static addGeometryType(e,t){e.addFieldInt8(2,t,we.Unknown)}static addHasZ(e,t){e.addFieldInt8(3,+t,0)}static addHasM(e,t){e.addFieldInt8(4,+t,0)}static addHasT(e,t){e.addFieldInt8(5,+t,0)}static addHasTm(e,t){e.addFieldInt8(6,+t,0)}static addColumns(e,t){e.addFieldOffset(7,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static addFeaturesCount(e,t){e.addFieldInt64(8,t,BigInt("0"))}static addIndexNodeSize(e,t){e.addFieldInt16(9,t,16)}static addCrs(e,t){e.addFieldOffset(10,t,0)}static addTitle(e,t){e.addFieldOffset(11,t,0)}static addDescription(e,t){e.addFieldOffset(12,t,0)}static addMetadata(e,t){e.addFieldOffset(13,t,0)}static endHeader(e){return e.endObject()}static finishHeaderBuffer(e,t){e.finish(t)}static finishSizePrefixedHeaderBuffer(e,t){e.finish(t,void 0,!0)}}function lo(n){let e=zn.getRootAsHeader(n),t=e.featuresCount(),r=e.indexNodeSize(),i=[];for(let a=0;a<e.columnsLength();a++){let l=e.columns(a);if(!l)throw Error("Column unexpectedly missing");if(!l.name())throw Error("Column name unexpectedly missing");i.push({name:l.name(),type:l.type(),title:l.title(),description:l.description(),width:l.width(),precision:l.precision(),scale:l.scale(),nullable:l.nullable(),unique:l.unique(),primary_key:l.primaryKey()})}let s=e.crs(),o=s?{org:s.org(),code:s.code(),name:s.name(),description:s.description(),wkt:s.wkt(),code_string:s.codeString()}:null;return{geometryType:e.geometryType(),columns:i,envelope:null,featuresCount:Number(t),indexNodeSize:r,crs:o,title:e.title(),description:e.description(),metadata:e.metadata()}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Zi=function(n,e){return Zi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},Zi(n,e)};function ox(n,e){Zi(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function cr(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(h){o(h)}}function l(u){try{c(r.throw(u))}catch(h){o(h)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(n,[])).next())})}function Pt(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){t.label=c[1];break}if(c[0]===6&&t.label<s[1]){t.label=s[1],s=c;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(c);break}s[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function br(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Wr(n){return this instanceof Wr?(this.v=n,this):new Wr(n)}function ax(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){r[f]&&(i[f]=function(d){return new Promise(function(g,p){s.push([f,d,g,p])>1||a(f,d)})})}function a(f,d){try{l(r[f](d))}catch(g){h(s[0][3],g)}}function l(f){f.value instanceof Wr?Promise.resolve(f.value.v).then(c,u):h(s[0][2],f)}function c(f){a("next",f)}function u(f){a("throw",f)}function h(f,d){f(d),s.shift(),s.length&&a(s[0][0],s[0][1])}}var eu=function(n){ox(e,n);function e(t){var r=n.call(this,t)||this;return Object.defineProperty(r,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(r,r.constructor.prototype):r.__proto__=r.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(r,r.constructor),r}return e}(Error);(function(){function n(e){if(e<0)throw new RangeError("Capacity may not be less than 0");this._c=e,this._q=[]}return Object.defineProperty(n.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),n.prototype.add=function(e){if(this.full)throw new Error("Buffer full");this._q.push(e)},n.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},n})();(function(){function n(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(n.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),n.prototype.add=function(e){for(;this._q.length>=this._c;)this._q.shift();this._q.push(e)},n.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},n})();(function(){function n(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(n.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),n.prototype.add=function(e){this._q.length<this._c&&this._q.push(e)},n.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},n})();function Yi(n){n!=null&&typeof n.then=="function"&&n.then(Vn,Vn)}var Li=0,Da=1,Vt=2,kn=3,qi=4,$n=1024,Vn=function(){};function nr(n){var e=n.err,t=Promise.resolve(n.execution).then(function(r){if(e!=null)throw e;return r});return n.err=void 0,n.execution=t.then(function(){},function(){}),n.pending===void 0?t:n.pending.then(function(){return t})}function Ut(n,e){var t=n.state>=kn;return Promise.resolve(e).then(function(r){return!t&&n.state>=qi?nr(n).then(function(i){return{value:i,done:!0}}):{value:r,done:t}})}function co(n,e){var t,r;if(!(n.state>=Vt))if(n.state=Vt,n.onnext(),n.onstop(),n.err==null&&(n.err=e),n.pushes.length===0&&(typeof n.buffer>"u"||n.buffer.empty))Mr(n);else try{for(var i=br(n.pushes),s=i.next();!s.done;s=i.next()){var o=s.value;o.resolve()}}catch(a){t={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}}function Mr(n){var e,t;if(!(n.state>=kn)){n.state<Vt&&co(n),n.state=kn,n.buffer=void 0;try{for(var r=br(n.nexts),i=r.next();!i.done;i=r.next()){var s=i.value,o=n.pending===void 0?nr(n):n.pending.then(function(){return nr(n)});s.resolve(Ut(n,o))}}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}n.pushes=[],n.nexts=[]}}function Ua(n){n.state>=qi||(n.state<kn&&Mr(n),n.state=qi)}function lx(n,e){if(Yi(e),n.pushes.length>=$n)throw new eu("No more than "+$n+" pending calls to push are allowed on a single repeater.");if(n.state>=Vt)return Promise.resolve(void 0);var t=n.pending===void 0?Promise.resolve(e):n.pending.then(function(){return e});t=t.catch(function(l){n.state<Vt&&(n.err=l),Ua(n)});var r;if(n.nexts.length){var i=n.nexts.shift();i.resolve(Ut(n,t)),n.nexts.length?r=Promise.resolve(n.nexts[0].value):typeof n.buffer<"u"&&!n.buffer.full?r=Promise.resolve(void 0):r=new Promise(function(l){return n.onnext=l})}else typeof n.buffer<"u"&&!n.buffer.full?(n.buffer.add(t),r=Promise.resolve(void 0)):r=new Promise(function(l){return n.pushes.push({resolve:l,value:t})});var s=!0,o={},a=r.catch(function(l){if(s)throw l});return o.then=function(l,c){return s=!1,Promise.prototype.then.call(r,l,c)},o.catch=function(l){return s=!1,Promise.prototype.catch.call(r,l)},o.finally=r.finally.bind(r),n.pending=t.then(function(){return a}).catch(function(l){n.err=l,Ua(n)}),o}function cx(n){var e=co.bind(null,n),t=new Promise(function(r){return n.onstop=r});return e.then=t.then.bind(t),e.catch=t.catch.bind(t),e.finally=t.finally.bind(t),e}function ux(n){if(!(n.state>=Da)){n.state=Da;var e=lx.bind(null,n),t=cx(n);n.execution=new Promise(function(r){return r(n.executor(e,t))}),n.execution.catch(function(){return co(n)})}}var xn=new WeakMap,ln=function(){function n(e,t){xn.set(this,{executor:e,buffer:t,err:void 0,state:Li,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:Vn,onstop:Vn})}return n.prototype.next=function(e){Yi(e);var t=xn.get(this);if(t===void 0)throw new Error("WeakMap error");if(t.nexts.length>=$n)throw new eu("No more than "+$n+" pending calls to next are allowed on a single repeater.");if(t.state<=Li&&ux(t),t.onnext(e),typeof t.buffer<"u"&&!t.buffer.empty){var r=Ut(t,t.buffer.remove());if(t.pushes.length){var i=t.pushes.shift();t.buffer.add(i.value),t.onnext=i.resolve}return r}else if(t.pushes.length){var s=t.pushes.shift();return t.onnext=s.resolve,Ut(t,s.value)}else if(t.state>=Vt)return Mr(t),Ut(t,nr(t));return new Promise(function(o){return t.nexts.push({resolve:o,value:e})})},n.prototype.return=function(e){Yi(e);var t=xn.get(this);if(t===void 0)throw new Error("WeakMap error");return Mr(t),t.execution=Promise.resolve(t.execution).then(function(){return e}),Ut(t,nr(t))},n.prototype.throw=function(e){var t=xn.get(this);if(t===void 0)throw new Error("WeakMap error");return t.state<=Li||t.state>=Vt||typeof t.buffer<"u"&&!t.buffer.empty?(Mr(t),t.err==null&&(t.err=e),Ut(t,nr(t))):this.next(Promise.reject(e))},n.prototype[Symbol.asyncIterator]=function(){return this},n.race=hx,n.merge=fx,n.zip=dx,n.latest=gx,n}();function ci(n,e){var t,r,i=[],s=function(c){c!=null&&typeof c[Symbol.asyncIterator]=="function"?i.push(c[Symbol.asyncIterator]()):c!=null&&typeof c[Symbol.iterator]=="function"?i.push(c[Symbol.iterator]()):i.push(function(){return ax(this,arguments,function(){return Pt(this,function(f){switch(f.label){case 0:return e.yieldValues?[4,Wr(c)]:[3,3];case 1:return[4,f.sent()];case 2:f.sent(),f.label=3;case 3:return e.returnValues?[4,Wr(c)]:[3,5];case 4:return[2,f.sent()];case 5:return[2]}})})}())};try{for(var o=br(n),a=o.next();!a.done;a=o.next()){var l=a.value;s(l)}}catch(c){t={error:c}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i}function hx(n){var e=this,t=ci(n,{returnValues:!0});return new ln(function(r,i){return cr(e,void 0,void 0,function(){var s,o,a,l,c,u;return Pt(this,function(h){switch(h.label){case 0:if(!t.length)return i(),[2];o=!1,i.then(function(){s(),o=!0}),h.label=1;case 1:h.trys.push([1,,5,7]),l=void 0,c=0,u=function(){var f,d,g,p,m,y;return Pt(this,function(_){switch(_.label){case 0:f=c;try{for(d=(m=void 0,br(t)),g=d.next();!g.done;g=d.next())p=g.value,Promise.resolve(p.next()).then(function(x){x.done?(i(),a===void 0&&(a=x)):c===f&&(c++,s(x))},function(x){return i(x)})}catch(x){m={error:x}}finally{try{g&&!g.done&&(y=d.return)&&y.call(d)}finally{if(m)throw m.error}}return[4,new Promise(function(x){return s=x})];case 1:return l=_.sent(),l===void 0?[3,3]:[4,r(l.value)];case 2:_.sent(),_.label=3;case 3:return[2]}})},h.label=2;case 2:return o?[3,4]:[5,u()];case 3:return h.sent(),[3,2];case 4:return[2,a&&a.value];case 5:return i(),[4,Promise.race(t.map(function(f){return f.return&&f.return()}))];case 6:return h.sent(),[7];case 7:return[2]}})})})}function fx(n){var e=this,t=ci(n,{yieldValues:!0});return new ln(function(r,i){return cr(e,void 0,void 0,function(){var s,o,a,l=this;return Pt(this,function(c){switch(c.label){case 0:if(!t.length)return i(),[2];s=[],o=!1,i.then(function(){var u,h;o=!0;try{for(var f=br(s),d=f.next();!d.done;d=f.next()){var g=d.value;g()}}catch(p){u={error:p}}finally{try{d&&!d.done&&(h=f.return)&&h.call(f)}finally{if(u)throw u.error}}}),c.label=1;case 1:return c.trys.push([1,,3,4]),[4,Promise.all(t.map(function(u,h){return cr(l,void 0,void 0,function(){var f,d;return Pt(this,function(g){switch(g.label){case 0:g.trys.push([0,,6,9]),g.label=1;case 1:return o?[3,5]:(Promise.resolve(u.next()).then(function(p){return s[h](p)},function(p){return i(p)}),[4,new Promise(function(p){s[h]=p})]);case 2:return f=g.sent(),f===void 0?[3,4]:f.done?(a=f,[2]):[4,r(f.value)];case 3:g.sent(),g.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return d=u.return,d?[4,u.return()]:[3,8];case 7:d=g.sent(),g.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return c.sent(),[2,a&&a.value];case 3:return i(),[7];case 4:return[2]}})})})}function dx(n){var e=this,t=ci(n,{returnValues:!0});return new ln(function(r,i){return cr(e,void 0,void 0,function(){var s,o,a,l;return Pt(this,function(c){switch(c.label){case 0:if(!t.length)return i(),[2,[]];o=!1,i.then(function(){s(),o=!0}),c.label=1;case 1:c.trys.push([1,,6,8]),c.label=2;case 2:return o?[3,5]:(Promise.all(t.map(function(u){return u.next()})).then(function(u){return s(u)},function(u){return i(u)}),[4,new Promise(function(u){return s=u})]);case 3:return a=c.sent(),a===void 0?[2]:(l=a.map(function(u){return u.value}),a.some(function(u){return u.done})?[2,l]:[4,r(l)]);case 4:return c.sent(),[3,2];case 5:return[3,8];case 6:return i(),[4,Promise.all(t.map(function(u){return u.return&&u.return()}))];case 7:return c.sent(),[7];case 8:return[2]}})})})}function gx(n){var e=this,t=ci(n,{yieldValues:!0,returnValues:!0});return new ln(function(r,i){return cr(e,void 0,void 0,function(){var s,o,a,l,c,u=this;return Pt(this,function(h){switch(h.label){case 0:if(!t.length)return i(),[2,[]];o=[],a=!1,i.then(function(){var f,d;s();try{for(var g=br(o),p=g.next();!p.done;p=g.next()){var m=p.value;m()}}catch(y){f={error:y}}finally{try{p&&!p.done&&(d=g.return)&&d.call(g)}finally{if(f)throw f.error}}a=!0}),h.label=1;case 1:return h.trys.push([1,,5,7]),Promise.all(t.map(function(f){return f.next()})).then(function(f){return s(f)},function(f){return i(f)}),[4,new Promise(function(f){return s=f})];case 2:return l=h.sent(),l===void 0?[2]:(c=l.map(function(f){return f.value}),l.every(function(f){return f.done})?[2,c]:[4,r(c.slice())]);case 3:return h.sent(),[4,Promise.all(t.map(function(f,d){return cr(u,void 0,void 0,function(){var g;return Pt(this,function(p){switch(p.label){case 0:if(l[d].done)return[2,l[d].value];p.label=1;case 1:return a?[3,4]:(Promise.resolve(f.next()).then(function(m){return o[d](m)},function(m){return i(m)}),[4,new Promise(function(m){return o[d]=m})]);case 2:return g=p.sent(),g===void 0?[2,l[d].value]:g.done?[2,g.value]:(c[d]=g.value,[4,r(c.slice())]);case 3:return p.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,h.sent()];case 5:return i(),[4,Promise.all(t.map(function(f){return f.return&&f.return()}))];case 6:return h.sent(),[7];case 7:return[2]}})})})}const Xn=class Xn{constructor(){J(this,"_extraRequestThreshold",262144)}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(e){if(e<0)throw Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=e}};J(Xn,"global",new Xn);let jn=Xn;const px=40,mx=16;function uo(n,e){e=Math.min(Math.max(+e,2),65535);let t=n,r=t;do r+=t=Math.ceil(t/e);while(t!==1);return 40*r}function _x(n,e){if(e<2)throw Error("Node size must be at least 2");if(n===0)throw Error("Number of items must be greater than 0");let t=n,r=t,i=[t];do r+=t=Math.ceil(t/e),i.push(t);while(t!==1);let s=[];for(let a of(t=r,i))s.push(t-a),t-=a;let o=[];for(let a=0;a<i.length;a++)o.push([s[a],s[a]+i[a]]);return o}async function*yx(n,e,t,r){class i{constructor(d,g){J(this,"_level");J(this,"nodes");this._level=g,this.nodes=d}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(d){this.nodes[1]=d}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}let{minX:s,minY:o,maxX:a,maxY:l}=t,c=_x(n,e),u=c[0][0],h=[new i([0,1],c.length-1)];for(;h.length!=0;){let f=h.shift(),d=f.startNodeIdx(),g=d>=u,p=(()=>{let[,_]=c[f.level()],x=Math.min(f.endNodeIdx()+e,_);return g&&x<_?x+1:x})(),m=p-d,y=new DataView(await r(40*d,40*m));for(let _=d;_<p;_++){let x=_-d,w=40*x;if(a<y.getFloat64(w+0,!0)||l<y.getFloat64(w+8,!0)||s>y.getFloat64(w+16,!0)||o>y.getFloat64(w+24,!0))continue;let S=y.getBigUint64(w+32,!0);if(g){let I=(()=>{if(!(_<n-1))return null;{let j=(x+1)*40;return y.getBigUint64(j+32,!0)-S}})(),C=_-u;yield[Number(S),C,Number(I)];continue}let T=jn.global.extraRequestThreshold()/40,R=h[h.length-1];if(R!==void 0&&R.level()==f.level()-1&&S<R.endNodeIdx()+T){R.extendEndNodeIdx(Number(S));continue}let L=(()=>{let I=f.level()-1;return new i([Number(S),Number(S)+1],I)})();R!==void 0&&(R.level(),L.level()),h.push(L)}}}const Bt=new Uint8Array([102,103,98,3,102,103,98,0]),ut=4;class ho{constructor(e,t,r,i,s){J(this,"headerClient");J(this,"header");J(this,"headerLength");J(this,"indexLength");J(this,"nocache");this.headerClient=e,this.header=t,this.headerLength=r,this.indexLength=i,this.nocache=s}static async open(e,t){let r,i=new Ba(e,t),s=2024+(()=>{let c,u=0;for(c=0;c<3;c++)u+=mx**c*px;return u})();if(!new Uint8Array(await i.getRange(0,8,s,"header")).subarray(0,3).every((c,u)=>Bt[u]===c))throw Error("Not a FlatGeobuf file");if((r=new DataView(await i.getRange(8,4,s,"header")).getUint32(0,!0))>10485760||r<8)throw Error("Invalid header size");let o=await i.getRange(12,r,s,"header"),a=lo(new pt(new Uint8Array(o))),l=uo(a.featuresCount,a.indexNodeSize);return new ho(i,a,r,l,t)}async*selectBbox(e){let t=this.lengthBeforeTree(),r=this.headerClient,i=async function(l,c){return r.getRange(t+l,c,0,"index")},s=[],o=[];for await(let l of yx(this.header.featuresCount,this.header.indexNodeSize,e,i)){let[c,u]=l,[,,h]=l;if(h||(h=4),o.length==0){o.push([c,h,u]);continue}let f=o[o.length-1];c-(f[0]+f[1])>jn.global.extraRequestThreshold()&&(s.push(o),o=[]),o.push([c,h,u])}this.headerClient.logUsage("header+index"),o.length>0&&s.push(o);let a=s.flatMap(l=>this.readFeatureBatch(l,this.nocache));yield*ln.merge(a)}lengthBeforeTree(){return Bt.length+ut+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(e){return new Ba(this.headerClient.httpClient,e)}async*readFeatureBatch(e,t){let[r]=e[0],[i,s]=e[e.length-1],o=this.buildFeatureClient(t),a=i+s-r;for(let[l,,c]of e){let u=await this.readFeature(o,l,a);yield{id:c,feature:u},a=0}o.logUsage("feature")}async readFeature(e,t,r){let i,s=t+this.lengthBeforeFeatures();i=new DataView(await e.getRange(s,4,r,"feature length")).getUint32(0,!0);let o=new Uint8Array(await e.getRange(s+4,i,r,"feature data")),a=new Uint8Array(i+ut);a.set(o,ut);let l=new pt(a);return l.setPosition(ut),He.getRootAsFeature(l)}}class Ba{constructor(e,t){J(this,"httpClient");J(this,"bytesEverUsed",0);J(this,"bytesEverFetched",0);J(this,"buffer",new ArrayBuffer(0));J(this,"head",0);if(typeof e=="string")this.httpClient=new Ga(e,t);else if(e instanceof Ga)this.httpClient=e;else throw Error("Unknown source ")}async getRange(e,t,r,i){this.bytesEverUsed+=t;let s=e-this.head,o=s+t;if(s>=0&&o<=this.buffer.byteLength)return this.buffer.slice(s,o);let a=Math.max(t,r);return this.bytesEverFetched+=a,this.buffer=await this.httpClient.getRange(e,a,i),this.head=e,this.buffer.slice(0,t)}logUsage(e){e.split(" ")[0],(100*this.bytesEverUsed/this.bytesEverFetched).toFixed(2)}}class Ga{constructor(e,t){J(this,"url");J(this,"nocache");J(this,"requestsEverMade",0);J(this,"bytesEverRequested",0);this.url=e,this.nocache=t}async getRange(e,t,r){this.requestsEverMade+=1,this.bytesEverRequested+=t;let i={Range:`bytes=${e}-${e+t-1}`};return this.nocache&&(i["Cache-Control"]="no-cache, no-store"),await(await fetch(this.url,{headers:i})).arrayBuffer()}}function xx(n,e,t){if(!n.subarray(0,3).every((u,h)=>Bt[h]===u))throw Error("Not a FlatGeobuf file");let r=new pt(n),i=r.readUint32(Bt.length);r.setPosition(Bt.length+ut);let s=lo(r),o=Bt.length+ut+i,{indexNodeSize:a,featuresCount:l}=s;a>0&&(o+=uo(l,a));let c=[];for(;o<r.capacity();){let u=r.readUint32(o);r.setPosition(o+ut);let h=He.getRootAsFeature(r);c.push(e(c.length,h,s)),o+=ut+u}return c}async function*bx(n,e,t){let r,i=sx(n),s=async d=>await i.slice(d),o=new Uint8Array(await s(8));if(!o.subarray(0,3).every((d,g)=>Bt[g]===d))throw Error("Not a FlatGeobuf file");o=new Uint8Array(await s(4));let a=new pt(o),l=a.readUint32(0);o=new Uint8Array(await s(l));let c=lo(a=new pt(o)),{indexNodeSize:u,featuresCount:h}=c;if(u>0){let d=uo(h,u);await s(d)}let f=0;for(;r=await wx(s,c,e,f++);)yield r}async function*Ex(n,e,t,r,i=!1){let s=await ho.open(n,i);for await(let o of s.selectBbox(e))yield t(o.id,o.feature,s.header)}async function wx(n,e,t,r){let i=new Uint8Array(await n(4,"feature length"));if(i.byteLength===0)return;let s=new pt(i),o=s.readUint32(0);i=new Uint8Array(await n(o,"feature data"));let a=new Uint8Array(o+4);return a.set(i,4),(s=new pt(a)).setPosition(ut),t(r,He.getRootAsFeature(s),e)}function Tx(n,e){return{type:"FeatureCollection",features:xx(n,oo)}}function Sx(n,e){return bx(n,oo)}function Rx(n,e,t,r=!1){return Ex(n,e,oo,t,r)}function vx(n,e,t,r=!1){return n instanceof Uint8Array?Tx(n):n instanceof ReadableStream?Sx(n):Rx(n,e,t,r)}const za=new us({featureProjection:"EPSG:3857"});class Px extends Zr{constructor(e){super({url:e.url,attributions:e.attributions,wrapX:e.wrapX,format:za,strategy:Gu}),this.ressourceURL=e.url,super.setLoader(this.loader)}fgbBoundingBox(e,t){const r=ol(e,t.getCode(),"EPSG:4326");return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}}async loader(e,t,r,i,s){const o=this.fgbBoundingBox(e,r);try{if(o.minX!==-1/0){const a=[],l=vx(this.ressourceURL,o);for await(const c of l){const u=za.readFeature(c);a.push(u)}super.clear(),super.addFeatures(a),i(a)}}catch{s()}}}window.eoxMapAdvancedOlSources={...n0,WMTSCapabilities:Q0,FlatGeoBuf:Px};let bn=null;const Lx=(n,e)=>{const t=r=>{var a;const i=r.map,s=(a=n.value)==null?void 0:a.lonLatCenter,o=i==null?void 0:i.getView().getZoom();s&&!Number.isNaN(s[0])&&!Number.isNaN(s[1])&&!Number.isNaN(o)&&(e.value=[s[0],s[1],o],Ar.value&&(Ar.value=!1))};pl(()=>{var r,i;(i=(r=n.value)==null?void 0:r.map)==null||i.on("moveend",t)}),ml(()=>{var r,i;(i=(r=n.value)==null?void 0:r.map)==null||i.un("moveend",t)})},ka=async(n,e,t)=>{Dt.debug("Creating layers config",n,e,t);const r=[],i={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers",layerControlExpand:!0},layers:[]};for(const h of e){let f;t?f=await h.createLayersJson(new Date(t)):f=await h.createLayersJson(),f.forEach(d=>{d.properties.layerControlExpand=!0,d.properties.layerControlToolsExpand=!0}),i.layers.push(...f)}r.push(i);const s=await Fo.getIndicatorLayers(n),o=Fo.getGeoDBLayer(e);o&&i.layers.push(o);const a={type:"Group",properties:{id:"BaseLayersGroup",title:"Base Layers"},layers:[]},l=s.filter(h=>h.properties.group==="baselayer");if(l.length){let h=0,f=0;for(let d=0;d<l.length;d++){const g=l[d];"visible"in g.properties||(g.properties.visible=!1),g.properties.visible&&(h++,f=d)}h===0&&(l[0].properties.visible=!0),h>0&&l.forEach((d,g)=>{g!==f?d.properties.visible=!1:d.properties.visible=!0}),a.layers.push(...l),a.layers.forEach(d=>{d.properties.layerControlExclusive=!0})}else a.layers.push({type:"Tile",properties:{id:"osm",title:"Background",layerControlExclusive:!0},source:{type:"OSM"}});a.layers.length&&r.push(a);const c={type:"Group",properties:{id:"OverlayGroup",title:"Overlay Layers"},layers:[]},u=s.filter(h=>h.properties.group==="overlay");return u.length&&(c.layers.push(...u),r.unshift(c)),r},$a=(n,e,t,r,i,s,o)=>{Dt.debug("InitMap",n.value,e.value,t.values,r.value);const a=Uh(Bh),l=Sh([e,r],async([c,u],[h,f])=>{var d,g,p,m,y,_,x,w,S,T,R,L;if(c){Dt.debug("Selected Indicator watch triggered",c,u),((d=n==null?void 0:n.value)==null?void 0:d.id)==="main"&&bn!==null&&((g=n==null?void 0:n.value)==null||g.map.setView(bn),bn=null);let I=[];const C=(c==null?void 0:c.id)===(h==null?void 0:h.id)&&u!==f,{selectedCompareStac:j}=Mi(Ni());if(((p=n==null?void 0:n.value)==null?void 0:p.id)==="main"?await Dh(c):j.value!==null&&(bn=((m=n==null?void 0:n.value)==null?void 0:m.map.getView())??null,n.value.sync=s.value),C){I=await ka(c,t,u),Dt.debug("Assigned layers after changing time only",JSON.parse(JSON.stringify(I))),i.value=I,await Ao(()=>{a.emit("time:updated",i.value)});return}I=await ka(c,t,r.value);let z=null;const Y=(_=(y=c==null?void 0:c.extent)==null?void 0:y.temporal)==null?void 0:_.interval;if(Y&&Y.length>0&&Y[0].length>1&&(z=new Date(Y[0][1]),Dt.debug("Indicator load: found stac extent, setting time to latest value",z)),z!==null&&z.toISOString()!==r.value&&(r.value=z.toISOString()),o&&((x=n==null?void 0:n.value)==null?void 0:x.id)==="main"&&(w=c.extent)!=null&&w.spatial.bbox&&!Ar.value){const M=(S=c.extent)==null?void 0:S.spatial.bbox[0],W=[(M==null?void 0:M[0])>-180?M==null?void 0:M[0]:-180,(M==null?void 0:M[1])>-90?M==null?void 0:M[1]:-90,(M==null?void 0:M[2])<180?M==null?void 0:M[2]:180,(M==null?void 0:M[3])<90?M==null?void 0:M[3]:90],ge=(L=n.value)==null?void 0:L.transformExtent(W,"EPSG:4326",(R=(T=n.value)==null?void 0:T.map)==null?void 0:R.getView().getProjection());n.value.zoomExtent=ge}Ar.value&&(Ar.value=!1),Dt.debug("Assigned layers",JSON.parse(JSON.stringify(I))),i.value=I,await Ao(()=>{var M;(M=n.value)==null||M.updateComplete.then(()=>{a.emit("layers:updated",i.value)})})}},{immediate:!0});ml(()=>{l()})},Ax=(n,e)=>{Oh(async()=>{const t=[];for(const r of n)t.push(...await r.getToolTipProperties());e.value=t,Dt.debug("Updated tooltip properties",e.value)})};function Ix(n){return 3*n*n-2*n*n*n}const Cx=[".enabled"],Fx=[".center",".zoom",".layers"],Ox=[".layers"],Mx={__name:"EodashMap",props:{enableCompare:{type:Boolean,default:!1},center:{type:Array,default:()=>[15,48]},zoom:{type:Number,default:4},zoomToExtent:{type:Boolean,default:!0}},setup(n){var g,p,m,y,_;const e=n,t=Er([]),r=vo([((g=hn.value)==null?void 0:g[0])??((p=e.center)==null?void 0:p[0]),((m=hn.value)==null?void 0:m[1])??((y=e.center)==null?void 0:y[1])]),i=vo(((_=hn.value)==null?void 0:_[2])??e.zoom),s=Er([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),o=Er([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),a={duration:1200,easing:Ix},l=Er(null),c=Er(null),{selectedCompareStac:u}=Mi(Ni()),h=Po(()=>e.enableCompare&&u.value?"":"first");Lx(l,hn),pl(()=>{const{selectedCompareStac:x,selectedStac:w}=Mi(Ni());Ch.value=l.value,e.enableCompare&&(Fh.value=c.value),e.enableCompare&&$a(c,x,Mh,Io,o,l,!1),$a(l,w,Co,Io,s,c,e.zoomToExtent)}),Ax(Co,t);const f=Po(()=>({visibility:t.value.length?"visible":"hidden"})),d=x=>{const w=JSON.parse(bh.render(JSON.stringify(t.value),{...Nh.value??{}})),S=w==null?void 0:w.find(T=>T.id===x.key);if(S)return typeof x.value=="object"&&(x.value=JSON.stringify(x.value)),isNaN(Number(x.value))||(x.value=Number(x.value).toFixed(4).toString()),{key:S.title||S.id,value:x.value+" "+(S.appendix||"")}};return(x,w)=>(Rh(),wh("eox-map-compare",{class:"fill-height fill-width overflow-none",".enabled":h.value},[fi("eox-map",{class:"fill-height fill-width overflow-none",slot:"first",ref_key:"eoxMap",ref:l,id:"main",".animationOptions":a,".center":Lo(r),".zoom":Lo(i),".layers":s.value},[fi("eox-map-tooltip",{style:Th(f.value),".propertyTransform":d},null,36)],40,Fx),fi("eox-map",{class:"fill-height fill-width overflow-none",id:"compare",slot:"second",ref_key:"compareMap",ref:c,".layers":o.value},null,40,Ox)],40,Cx))}},ib=Object.freeze(Object.defineProperty({__proto__:null,default:Mx},Symbol.toStringTag,{value:"Module"}));export{ib as E,tb as L,rb as a};
